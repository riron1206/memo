<html>
<head>
  <title>Evernote Export</title>
  <basefont face="メイリオ" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (ja-JP, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: メイリオ;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="2688"/>

<div>
<span><div><span style="font-size: 10pt;">20190324</span></div><div style="z-index:200; position: relative;"><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Pandas</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイルロード</span></div><div><span style="font-size: 10pt;">df_input = pd.read_csv('tmp.tsv', header=None, sep='\t') # タブ区切りでロード</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(submit_dir+'/result.csv'</span><span style="font-size: 10pt; font-weight: bold;">, index_col=0</span><span style="font-size: 10pt;">) # 0番目の列（最初の列）をindexにしてロード</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(submit_dir+'/result.csv'</span><span style="font-size: 10pt; font-weight: bold;">, index_col='AAA'</span><span style="font-size: 10pt;">) # AAA列をindexにしてロード</span></div><div><span style="font-size: 10pt;">df = pd.read_excel('data/src/sample.xlsx') # エクセルロード.最初のシートだけ読まれる</span></div><div><span style="font-size: 10pt;">df = pd.read_excel('data/src/sample.xlsx', sheet_name=1) # 引数sheet_nameで読み込むシートを指定できる。0始まりの番号かシート名で指定する。</span></div><div><span style="font-size: 10pt;">df = pd.read_excel('data/src/sample.xlsx', sheet_name='sheet3')</span></div><div><span style="font-size: 10pt;">df = pd.read_excel('data/src/sample.xlsx', usecols=[0, 1, 3], skiprows=[1], skipfooter=1) # 引数usecolsには読み込む列番号のリスト、引数skiprowsにはスキップする（読み込まない）行番号のリスト、引数skipfooterにはスキップする（読み込まない）末尾の行数を渡す。</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(r'output\out_code_name.csv',</span> <span style="font-size: 10pt; font-weight: bold;">header=[0, 1, 2]) # マルチカラムのcsvロード。0,1,2行がヘッダーでロードされる</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(r'tmp.csv',</span> <span style="font-size: 10pt; font-weight: bold;">na_values=['','NA',-1,9999]</span><span style="font-size: 10pt;">)</span> <span style="font-size: 10pt; font-weight: bold;"># 欠損値を指定してcsvロード</span></div><div><span style="font-size: 10pt;">df= pd.read_csv(&quot;japanese.csv&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">encoding=&quot;SHIFT-JIS&quot;</span><span style="font-size: 10pt;">)</span> <span style="font-size: 10pt; font-weight: bold;"># 文字コード指定してロード</span></div><div><span style="font-size: 10pt;">df_str_col = pd.read_csv('data/src/sample_header_index_dtype.csv', index_col=0,</span> <span style="font-size: 10pt; font-weight: bold;">dtype={'a': float, 'b':  int, 'c':  str})  # データ型指定してロード。</span><span style="font-size: 10pt; font-weight: bold;">dtype={2:  str, 3:  str}のように列番号でも指定できる</span></div><div><span style="font-size: 10pt;">df_names = pd.read_csv('data/src/sample.csv',</span> <span style="font-size: 10pt; font-weight: bold;">names=('A', 'B', 'C', 'D'))  # </span><span style="font-size: 10pt; font-weight: bold;">ヘッダなしCSVを読む場合は</span><span style="font-size: 10pt; font-weight: bold;">namesで</span><span style="font-size: 10pt; font-weight: bold;">列名変更できる。</span><span style="font-size: 10pt; font-weight: bold;">ヘッダありだと機能しない</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイル（pd.read_excel('dirty_data.xlsx')行）を読み込み、</span></div><div><span style="font-size: 10pt; font-weight: bold;">カラム名のクリーンアップ、</span></div><div><span style="font-size: 10pt; font-weight: bold;">欠損データの削除、</span></div><div><span style="font-size: 10pt; font-weight: bold;">カラムの名前の変更、</span></div><div><span style="font-size: 10pt; font-weight: bold;">カラムの1つをdatetime形式に変換する関数を使用して変換</span></div><div><span style="font-size: 10pt;">cleaned_df = (</span></div><div><span style="font-size: 10pt;">    pd.read_excel('dirty_data.xlsx')</span></div><div><span style="font-size: 10pt;">    .clean_names()</span></div><div><span style="font-size: 10pt;">    .remove_empty()</span></div><div><span style="font-size: 10pt;">    .rename_column(&quot;full_time_&quot;, &quot;full_time&quot;)</span></div><div><span style="font-size: 10pt;">    .convert_excel_date(&quot;hire_date&quot;)</span></div><div><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">pd.read_csv のparse_dates で列番号指定すれば、datetimeとして扱いたい列を指定できる</span></font></div><div><span style="font-size: 10pt;">holiday = pd.read_csv(HOLIDAY_FILE,</span></div><div><span style="font-size: 10pt;">                      encoding=&quot;cp932&quot;,</span></div><div><span style="font-size: 10pt;">                      header=None,</span></div><div><span style="font-size: 10pt;">                      dtype={0: str,1:str},</span></div><div><span style="font-size: 10pt;">                      </span><span style="font-size: 10pt; font-weight: bold;">parse_dates=[0]</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">df1 = pd.read_csv('./pandas_date_ex/example1.csv', index_col='Date',</span> <span style="font-size: 10pt; font-weight: bold;">parse_dates=['Date']</span><span style="font-size: 10pt;">)  # 列名でもできる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 日付データの形式を変更してcsvロード（2020年1月2日→2020-01-02のdatetime型に変換）</span></div><div><span style="font-size: 10pt;">dateparse = lambda d: pd.datetime.strptime(d, '%Y年%m月%d日')</span></div><div><span style="font-size: 10pt;"># dateparse = lambda d: pd.datetime.strptime(d, '%Y/%m/%d')</span></div><div><span style="font-size: 10pt;">test_df = pd.read_csv('data-slash.csv',</span></div><div><span style="font-size: 10pt;">                      index_col='日付',  # index_col=0, でもいける</span></div><div><span style="font-size: 10pt;">                      parse_dates=['日付'],  # parse_dates=[0], でもいける</span></div><div><span style="font-size: 10pt;">                      date_parser=dateparse, # 日付のパース方法は上で定義したラムダ式を指定</span></div><div><span style="font-size: 10pt;">                      dtype='float') # データ型にfloatを指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-weight: bold;">category型指定してcsvロード</span></div><div>df_train = pd.read_csv(&quot;../data/bike-sharing-demand/train.csv&quot;,</div><div><span style="font-weight: bold;">                       dtype={'season': 'category',</span></div><div><span style="font-weight: bold;">                              'holiday': 'category',</span></div><div><span style="font-weight: bold;">                              'workingday': 'category',</span></div><div><span style="font-weight: bold;">                              'weather': 'category'}</span>,</div><div>                       parse_dates=['datetime'])</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># コンマ「.」とピリオド「,」の混在したデータフレームの置換</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(r'C:\Users\81908\Documents\999.tmp\softbank_markerspeed.csv',</span></div><div><span style="font-size: 10pt;">                 index_col='日付',</span></div><div><span style="font-size: 10pt;">                 na_values=['','NA','-'])</span></div><div><span style="font-size: 10pt;">print(df.columns)</span></div><div><span style="font-size: 10pt;">print(df.dtypes)</span></div><div><span style="font-size: 10pt;">display(df.head())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">for col in df.columns:</span></div><div><span style="font-size: 10pt;">    _dtype = df[col].dtype</span></div><div><span style="font-size: 10pt;">    if _dtype != 'float64':</span></div><div><span style="font-size: 10pt;">        df[col] = df[col].apply(lambda x: x.replace(&quot;,&quot;, &quot;&quot;) if type(x) is str else float(x))</span></div><div><span style="font-size: 10pt;">df = df.astype('float64')</span></div><div><span style="font-size: 10pt;">display(df.head())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jsonファイルをデータフレームに変換</span></div><div><span style="font-size: 10pt;">pd.read_json('products.json')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># csvファイル出力</span></div><div><span style="font-size: 10pt;">df.to_csv(ofilename, header=False, sep='\t', index=False)</span></div><div><span style="font-size: 10pt;">df.to_csv(csv_path, index=False, encoding=&quot;SHIFT-JIS&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># エクセル(xlsx)</span><span style="font-size: 10pt; font-weight: bold;">ファイル出力</span></font></div><div><span style="font-size: 10pt;">import xlsxwriter</span></div><div><span style="font-size: 10pt;">df.to_excel('data/dst/pandas_to_excel_no_index_header.xlsx', index=False, header=False)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレーム作成</span></div><div><span style="font-size: 10pt;">df_output = pd.DataFrame({'0': fragment, '1': df_input[1]})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームをnumpyに変換</span></div><div><span style="font-size: 10pt;">y = df_train['Score'].values</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストをseriesに変換</span></div><div><span style="font-size: 10pt;">pd.Series(y_list, index=th_list_class_name)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレームにseries詰める</span></font></div><div><span style="font-size: 10pt;">df= pd.DataFrame(columns=['ind', 'ifdoco'])                         </span></div><div><span style="font-size: 10pt;">row = pd.Series([1, 2],</span> <span style="font-size: 10pt; font-weight: bold;">index=df.columns</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">df = df.append(row, ignore_index=True)</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレーム空か判定</span></font></div><div><span style="font-size: 10pt;">if</span> <span style="font-size: 10pt; font-weight: bold;">df.empty</span><span style="font-size: 10pt;">:</span></div><div><span style="font-size: 10pt;">    pass</span></div><div><span style="font-size: 10pt;">if</span> <span style="font-size: 10pt; font-weight: bold;">series.empty</span> <span style="font-size: 10pt;">== False:  </span><span style="font-size: 10pt; font-weight: bold;"># Seriesもemptyで空判定</span></div><div><span style="font-size: 10pt;">    series['A'] = row['B'] + 5</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seriesの欠損値削除してデータフレームとして保持する</span></div><div><span style="font-size: 10pt;">_df = df[['data1']].dropna()  # [[]]だとデータフレームで扱う</span></div><div><span style="font-size: 10pt;">df['data1'] = df['data1'].dropna()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列で</span><span style="font-size: 10pt; font-weight: bold;">欠損ある/欠損ない行取得</span></div><div><span style="font-size: 10pt;">df = df[df['AAA'].isnull()]  # 欠損ある行取得</span></div><div><span style="font-size: 10pt;">df = df[df['AAA'].notnull()]  # 欠損ない行取得</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームに欠損値あるかチェック</span></div><div><span style="font-size: 10pt;">if len(df) - df.count().min():</span></div><div><span style="font-size: 10pt;">    shape_before = df.shape</span></div><div><span style="font-size: 10pt;">    df = df.dropna()</span></div><div><span style="font-size: 10pt;">    print(&quot;INFO: dropna shape: {} -&gt; {}&quot;.format(shape_before, df.shape))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">リストをデータフレームに変換</span></font></div><div><span style="font-size: 10pt;">df = pd.DataFrame(y_label_list)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 余計な空白削除してカンマ区切りの文字列をリスト化</span></div><div><span style="font-size: 10pt;">l = [x.strip() for x in 'one, two, three'.split(',')] # ['one', 'two', 'three']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 空のデータフレームに列追加</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame()</span></div><div><span style="font-size: 10pt;">for column_name, item in df_merge.iteritems(): #</span> <span style="font-size: 10pt; font-weight: bold;">df_merge</span><span style="font-size: 10pt; font-weight: bold;"> を1列づつループ回す</span></div><div><span style="font-size: 10pt;">    df = pd.concat([df, item], axis=1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 列追加はassignでもできる(</span><span style="font-size: 10pt; font-weight: bold;">AAA列が追加される</span><span style="font-size: 10pt; font-weight: bold;">)</span></font></div><div><span style="font-size: 10pt;">df = df.assign(AAA = df['A'] + df['B'])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># bool列追加</span></font></div><div><span style="font-size: 10pt;">df[['is_A']] = (df[['A']] == 'man').astype('bool')</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-weight: bold;"># 条件指定して値入れる</span></div><div>df.loc[df['A'] &lt; 0, 'A'] = -100</div><div>df.loc[~(df['A'] &lt; 0), 'A'] = 100</div><div><br/></div><div><span style="font-weight: bold;"># 同じ行の組み合わせパターンの数集計</span></div><div>col = list(df.columns)  # 前準備：最初の列の列名をリストとして保存</div><div>df = df.isnull()  # 欠損かどうかでbool化</div><div>df = df.assign(count=1)  # count列追加</div><div>pattern = df.groupby(col, as_index=False).sum()  # 同じ行の組み合わせパターンの数集計</div><div>display(pattern)</div><div>print(pattern['count'].sum())</div><div><span style="font-size: 10pt;"><br/></span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># カテゴリ列追加（カテゴリ列はRのfactor型と同じもの=取りえる値が決まっているもの。bool型はTrue/Falseの2種だけだが、カテゴリ型はそれを拡大したもの。</span><span style="font-size: 10pt; font-weight: bold;">カテゴリ列の利点はデータサイズを小さくできる）</span></font></div><div><span style="font-size: 10pt;">df['A_c'] = df['A'].astype('category')</span></div><div><span style="font-size: 10pt;">print(df['A_c'].cat.codes)  # インデックスデータはcodesに格納されている</span></div><div><span style="font-size: 10pt;">print(df['A_c'].cat.categories)  </span> <span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;"># マスタデータはcategoriesに格納されている</span></div><div><br/></div><div><span style="font-size: 10pt; font-weight: bold;"># kmeansでクラスタリングしてラベル列追加</span></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.cluster import KMeans</span></div><div><span style="font-size: 10pt;">from sklearn.preprocessing import StandardScaler</span></div><div><span style="font-size: 10pt;">sc = StandardScaler()</span></div><div><span style="font-size: 10pt;">result = sc.fit_transform(df)  # 標準化</span></div><div><span style="font-size: 10pt;">kmeans = KMeans(n_clusters=4, random_state=0)  # kmeans。4グループにする</span></div><div><span style="font-size: 10pt;">clusters = kmeans.fit(result)</span></div><div><span style="font-size: 10pt; font-weight: bold;">df[&quot;kmn&quot;] = clusters.labels_  # kmeansのラベル列追加</span></div><div><span style="font-size: 10pt;">print(df[&quot;kmn&quot;].unique())</span></div><div><span style="font-size: 10pt;">print(df.head())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 多次元のリストを1次元にしてデータフレームの列に追加する</span></div><div><span style="font-size: 10pt;">label_arr = [[l]*5 for l in df_act_task['label'].values]</span></div><div><span style="font-size: 10pt;">label_arr = np.array(label_arr).flatten() # 1次元化</span></div><div><span style="font-size: 10pt;">df['label_arr'] = label_arr</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 空のデータフレームに行追加</span></div><div><span style="font-size: 10pt;">df_conv_y = pd.DataFrame(columns=['A', 'B'])</span></div><div><span style="font-size: 10pt;">for index, series in df.</span><span style="font-size: 10pt; font-weight: bold;">iterrows</span><span style="font-size: 10pt;">(): #</span> <span style="font-size: 10pt; font-weight: bold;">df を1行づつループ回す</span></div><div><span style="font-size: 10pt;">    df_conv_y = df_conv_y.append(conv_y_series, ignore_index=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># </span> <span style="font-size: 10pt; font-weight: bold;">df を1行づつループ(df.</span><span style="font-size: 10pt; font-weight: bold;">iterrows()より何倍も早いが</span><span style="font-size: 10pt; font-weight: bold;">namedtuple</span><span style="font-size: 10pt; font-weight: bold;">で値返ってくる。</span><span style="font-size: 10pt; font-weight: bold;">[]のほか.でも各要素の値にアクセスできる</span><span style="font-size: 10pt; font-weight: bold;">)</span></div><div><span style="font-size: 10pt;">for row in df.</span><span style="font-size: 10pt; font-weight: bold;">itertuples</span><span style="font-size: 10pt;">(index=False): #</span> <span style="font-size: 10pt; font-weight: bold;">df を1行づつループ回す</span></div><div><span style="font-size: 10pt;">    sum += row.x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># </span> <span style="font-size: 10pt; font-weight: bold;">df を1行づつループ</span></div><div><span style="font-size: 10pt; font-weight: bold;"># valuesでnumpy.arrayにしてからのindexingならほとんど生アクセスに近いので速い</span></div><div><span style="font-size: 10pt;">a = df.a.values</span></div><div><span style="font-size: 10pt;">for idx in range(df.shape[0]):</span></div><div><span style="font-size: 10pt;">    a[idx] # 0.09秒( 90ms)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 統計量確認</span></div><div><span style="font-size: 10pt;">df.describe()</span></div><div><span style="font-size: 10pt;">df.describe().round(1)  # 有効数字1桁だけで表示</span></div><div><span style="font-size: 10pt; font-weight: bold;"># describe()を数字以外の行にも使う</span></div><div><span style="font-size: 10pt;">df.desctibe(include='all')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 統計量</span></div><div><span style="font-size: 10pt;">from statistics import mean, median,variance,stdev</span></div><div><span style="font-size: 10pt;">data = [100,200,300,400,500,500,600,700,800,800]</span></div><div><span style="font-size: 10pt;">m = mean(data)  # 平均</span></div><div><span style="font-size: 10pt;">median = median(data)  # 中央値</span></div><div><span style="font-size: 10pt;">variance = variance(data)  # 分散</span></div><div><span style="font-size: 10pt;">stdev = stdev(data)  # 標準偏差</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># カラムAのグループ別のカラムBの統計量を見る</span></div><div><span style="font-size: 10pt;">df.groupby('カラム名A').describe()['カラム名B']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterでデータフレームのセル色変えれる</span></div><div><span style="font-size: 10pt;">display(df.style.background_gradient(cmap='Pastel1'))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># np.arrayをseriesに変換</span></div><div><span style="font-size: 10pt;">series = pd.Series(y_train_resampled)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># マルチカラムの列取得（</span><span style="font-size: 10pt; font-weight: bold;">&quot;Attributes&quot;, &quot;Symbols&quot;, &quot;Date&quot;の階層のカラム</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df[&quot;Attributes&quot;, &quot;Symbols&quot;, &quot;Date&quot;]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># A列抽出</span></div><div><span style="font-size: 10pt;">df['A'] or df.A or df.loc[:, 'A']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># A列の値が3か6のレコードだけ抽出</span></div><div><span style="font-size: 10pt;">df[df['A'].isin([3, 6])]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># A列の値が3か6ではないレコードだけ抽出</span></div><div><span style="font-size: 10pt;">df[~df['A'].isin([3, 6])]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 行名(index)が &quot;2013-01-01&quot; のレコードを抽出（df.locはindexからレコード取得</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df.loc[&quot;2013-01-01&quot;]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 指定列が最小値になるindexを見つけて</span><span style="font-size: 10pt; font-weight: bold;">レコードを抽出</span></font></div><div><span style="font-size: 10pt;">df.loc[df['Age'].idxmin()]['Name']</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">df[df['Age'] == df['Age'].min()]['Name'].values[0]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 指定列が最大値になるindex</span><span style="font-size: 10pt; font-weight: bold;">を見つけて</span><span style="font-size: 10pt; font-weight: bold;">レコードを抽出</span></font></div><div><span style="font-size: 10pt;">df.loc[df['Age'].idxmax()]['Name']</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">df[df['Age'] == df['Age'].max()]['Name'].values[0]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 上位/下位レコード抽出</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame(data={</span></div><div><span style="font-size: 10pt;">    'Name': ['Bob', 'Mark', 'Josh', 'Anna', 'Peter', 'Dexter'],</span></div><div><span style="font-size: 10pt;">    'Points': [37, 91, 66, 42, 99, 81]</span></div><div><span style="font-size: 10pt;">})</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列の上位3レコード返す</span></div><div><span style="font-size: 10pt;">df.nlargest(3, columns='Points')</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列の上位3レコード返す</span></div><div><span style="font-size: 10pt;">df.nsmallest(3, columns='Points')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">pandasでビニング処理（ビン分割:</span><span style="font-size: 10pt; font-weight: bold;">binning)(数値変数を区間ごとにグループ分けしてカテゴリ変数にする)</span></div><div><span style="font-size: 10pt;">y = [1,7,5,4,6,3]</span></div><div><span style="font-size: 10pt;">binned = pd.cut(y,3,labels=False) # [0,2,1,1,2,0]</span></div><div><span style="font-size: 10pt;">df['cut'] = pd.cut(df['petal_width'], 2, labels=False)  </span><span style="font-size: 10pt; font-weight: bold;"># cut関数は、最小値と最大値から、等間隔に切ってビン分割。bins=2だと平均値で分割</span></div><div><span style="font-size: 10pt;">df['cut2'] = pd.cut(df['petal_width'], [0, 1, 3], labels=False)  </span><span style="font-size: 10pt; font-weight: bold;"># binsをリストを指定すると、リストの要素を境界値として分割される</span></div><div><span style="font-size: 10pt;">df['cut3'] = pd.cut(df['petal_width'], 2, labels=['low', 'high'])  </span><span style="font-size: 10pt; font-weight: bold;"># labels指定すると分割結果をそのラベル名に変換</span></div><div><span style="font-size: 10pt;">df['qcut'] = pd.qcut(df['petal_width'], 2, labels=False)  </span><span style="font-size: 10pt; font-weight: bold;"># qcut関数は、ビンの中の値の数を揃えてビン分割。bins=2だと中央値で分割</span></div><div><span style="font-size: 10pt;">df['qcut2'] = pd.qcut(df['petal_width'], 4, labels=False)  </span><span style="font-size: 10pt; font-weight: bold;"># bins=4だと四分点で分割</span></div><div><span style="font-size: 10pt;">df['qcut3'] = pd.qcut(df['petal_width'], 2, labels=['low', 'high']) </span><span style="font-size: 10pt; font-weight: bold;"> # labels指定すると分割結果をそのラベル名に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pd.cut()は指定列をbinsでしきい値で分割し、labelsでカテゴリ変数に変換できる</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame(data={</span></div><div><span style="font-size: 10pt;">    'Name': ['Bob', 'Mark', 'Josh', 'Anna', 'Peter', 'Dexter'],</span></div><div><span style="font-size: 10pt;">    'Points': [37, 91, 66, 42, 99, 81]</span></div><div><span style="font-size: 10pt;">})</span></div><div><span style="font-size: 10pt;">pd.cut(df['Points'], bins=[0, 50, 100], labels=['Fail', 'Pass'])</span></div><div><span style="font-size: 10pt;"># 0 Fail</span></div><div><span style="font-size: 10pt;"># 1 Pass</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 指定文字含む列名をリストに変換して検索</span></font></div><div><span style="font-size: 10pt;">l_in = [s for s in df_all_header.columns.to_list() if 'user_attrs' in s]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列のユニークな値のnp.array()を返す</span></div><div><span style="font-size: 10pt;">df['state'].unique()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">列の</span><span style="font-size: 10pt; font-weight: bold;">ユニークな値の数を返す</span></div><div><span style="font-size: 10pt;">df['カラム名'].nunique()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列削除</span></div><div><span style="font-size: 10pt;">df = df.drop(['A', 'B']</span><span style="font-size: 10pt; font-weight: bold;">, axis=1</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">_df = df.drop(df.columns[[0]], axis=1) # 列番号から列削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行削除</span></div><div><span style="font-size: 10pt;">df = df_pred_score.drop('SMILES', axis=0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列マージ。fillnaで欠損を空文字にしている</span></div><div><span style="font-size: 10pt;">df_label['set'] = df_label['set_x'].fillna('') + df_label['set_y'].fillna('')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列名をリストとして取得</span></div><div><span style="font-size: 10pt;">df.columns.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 行名</span><span style="font-size: 10pt; font-weight: bold;">をリストとして</span><span style="font-size: 10pt; font-weight: bold;">取得</span></font></div><div><span style="font-size: 10pt;">df.index.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 置換</span></div><div><span style="font-size: 10pt;">df.DEC_VAL_PRE = df.DEC_VAL_PRE.str.replace('μ', 'u')</span></div><div><span style="font-size: 10pt;">df.Threshold = df.Threshold.str.replace(' ', '') # 半角の空白置換</span></div><div><span style="font-size: 10pt;">df.Threshold = df.Threshold.str.replace('　', '') # 全角の空白置換</span></div><div><span style="font-size: 10pt;">[j_l.replace('positive','1').replace('negative','0') for j_l in jpg_labels] # 複数条件置換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 正規表現で列置換</span></div><div><span style="font-size: 10pt;">df['決算期'] = df['決算期'].map(lambda x: re.sub('-\d{2}-', '-' , x))</span></div><div><span style="font-size: 10pt;">df['決算期'] = df['決算期'].map(lambda x: re.sub(&quot;\*$&quot;, '', x))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># index名変更</span></div><div><span style="font-size: 10pt;">df.index.name = 'data1'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># index, 列名全て変更</span></div><div><span style="font-size: 10pt;">df.index = [1, 2, 3]</span></div><div><span style="font-size: 10pt;">df_label.index = df_label['SERIES_NO'].values</span></div><div><span style="font-size: 10pt;">df.columns = ['a', 'b', 'c']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列のみ列名変更</span></div><div><span style="font-size: 10pt;">df = df.rename(columns={'D':d, 'M':m})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># indexの列名をwinesに変更</span></div><div><span style="font-size: 10pt;">df = df.rename_axis('wines', axis='rows')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">行名indexでソート</span></font></div><div><span style="font-size: 10pt;">df = df.sort_index()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の順番を列名の降順にする</span></div><div><span style="font-size: 10pt;">df_label = df_label.sort_index(axis=1, ascending=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列番号から列の順番入れ替え</span></div><div><span style="font-size: 10pt;">df = df.iloc[:,[-1]+list(range(0,len(task_name_list)))]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列名から列の順番入れ替え</span></div><div><span style="font-size: 10pt;">df = df[['D','C','B','A']]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の順番を逆順にする</span></div><div><span style="font-size: 10pt;">df = df.loc[:,df.columns[::-1]] # データフレームの場合</span></div><div><span style="font-size: 10pt;">series  = series[series.index[::-1]] # シリーズの場合</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列を複数の列に分割（str.split(): 区切り文字で分割）</span></div><div><span style="font-size: 10pt;">col = 'class_criteria'</span></div><div><span style="font-size: 10pt;">df_task = pd.concat([df_task, df_task[col].str.split('=', expand=True)], axis=1).drop(col, axis=1) # col列を分割した列として0,1という列が出来る</span></div><div><span style="font-size: 10pt;">df_task = df_task.rename(columns={0:'threshold_operator', 1:'threshold_value'}) # 0,1列の列名変更</span></div><div><span style="font-size: 10pt;">_df_div = pd.DataFrame(df_divide['分割比率'].str.split('：').to_list())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 列の不要な文字削除</span></font></div><div><span style="font-size: 10pt;">df_task['threshold_operator'] = df_task['threshold_operator'].str.strip('y') # 前後の'y'だけが消される</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 最初の行を列ヘッダーに変換</span></div><div><span style="font-size: 10pt;">df_concat = df_concat.rename(columns=df_concat.iloc[0], copy=False).iloc[1:].reset_index(drop=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列だけ抽出</span></div><div><span style="font-size: 10pt;">df_label = df_label.</span><span style="font-size: 10pt; font-weight: bold;">loc[:</span><span style="font-size: 10pt;">, ['img_path', 'set']+NPI_task_name_list+GAR_task_name_list] #  列名から</span></div><div><span style="font-size: 10pt;">df_label = df_label.iloc[:, [0,2]] #  列番号から０列と2列抽出</span></div><div><span style="font-size: 10pt;">df_label = df_label.iloc[:, 0] #  列番号から０列抽出。列名はなくなる。df_label.iloc[:, [0]]にすると列名のこる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の行だけ抽出</span></div><div><span style="font-size: 10pt;">df_label = df_label.</span><span style="font-size: 10pt; font-weight: bold;">loc</span><span style="font-size: 10pt;">[['img_path', 'set']+NPI_task_name_list+GAR_task_name_list,:] #  index名から</span></div><div><span style="font-size: 10pt;">df_label = df_label.iloc[[0,2],] #  行番号から</span></div><div><span style="font-size: 10pt;">df = reviews.loc[0:100, ['country', 'variety']] # 上から100行 'country', 'variety'列だけ</span></div><div><span style="font-size: 10pt;">df = df.query('DEC_VAL_PRE != &quot;-&quot; or DEC_VAL_REL != &quot;NaN&quot;')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレーム</span><span style="font-size: 10pt; font-weight: bold;">全体をランダムに並び替える（シャッフルする）</span></font></div><div><span style="font-size: 10pt;">_df = df.sample(frac=1, random_state=0)  # sample()でサンプリング。frac=1なので全レコードサンプリング。, random_stateは無くてもよい</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定のid列についてサンプリング</span></div><div><span style="font-size: 10pt;">sample_id = pd.Series(df['id'].unique()).sample(frac=0.5)  # sample()でサンプリング。frac=0.5なので半分のレコードだけサンプリング</span></div><div><span style="font-size: 10pt;">df_sample = df[df['id'].isin(sample_id)]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime</span><span style="font-size: 10pt; font-weight: bold;">型の</span><span style="font-size: 10pt; font-weight: bold;">列の年/月/日/時刻/分/秒/曜日 取得</span></font></div><div><span style="font-size: 10pt;">df['datetime'] = pd.to_datetime(df['datetime'], format='%Y-%m-%d %H:%M:%S')  # datetime型に変換</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.year  # 年を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.month  # 月を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.day  # 日を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.dayofweek  # 曜日（0=日曜日、1＝月曜日）を数値で取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.hour  # 時刻の時を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.minute  # 時刻の分を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.second  # 時刻の秒を取得</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.strftime('%Y-%m-%d %H:%M:%S')  # 指定したフォーマットの文字列に変換</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime型の列から指定した年、月、日、時間の行だけ取る</span></span></div><div><span style="font-size: 10pt;">df['datetime'].apply(lambda x: x if x.year == 2020 else None).dropna()  # 2020年の行</span></div><div><span style="font-size: 10pt;">df['datetime'].apply(lambda x: x if x.month == 2 else None).dropna()  # 2月の行</span></div><div>df['datetime'].apply(lambda x: x if x.day == 1 else None).dropna()  # 1日の行</div><div>df['datetime'].apply(lambda x: x if x.hour == 11 else None).dropna()  # 11時の行</div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime</span><span style="font-size: 10pt; font-weight: bold;">型の</span><span style="font-size: 10pt; font-weight: bold;">列の日時差の計算</span></font></div><div><span style="font-size: 10pt;">df['datetime'] = pd.to_datetime(df['datetime'], format='%Y-%m-%d %H:%M:%S')  # datetime型に変換</span></div><div><span style="font-size: 10pt;">df['datetime2'] = pd.to_datetime(df['datetime2'], format='%Y-%m-%d %H:%M:%S')  # datetime型に変換</span></div><div><span style="font-size: 10pt;">df['datetime'].dt.year - df['datetime2'].dt.year  # 年の差分を計算（月以下の日時要素は考慮しない）</span></div><div><span style="font-size: 10pt;">(df['datetime'].dt.year * 12 + df['datetime'].dt.month) - (df['datetime2'].dt.year * 12 + df['datetime2'].dt.month)  # 月の差分を取得（日以下の日時要素は考慮しない）</span></div><div><span style="font-size: 10pt;">(df['datetime'] - df['datetime2']).astype('timedelta64[D]')  # 日単位で差分を計算</span></div><div><span style="font-size: 10pt;">(df['datetime'] - df['datetime2']).astype('timedelta64[h]')  # 時単位で差分を計算</span></div><div><span style="font-size: 10pt;">(df['datetime'] - df['datetime2']).astype('timedelta64[m]')  # 分単位で差分を計算</span></div><div><span style="font-size: 10pt;">(df['datetime'] - df['datetime2']).astype('timedelta64[s]')  # 秒単位で差分を計算</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 日時の連続値を生成</span></div><div><span style="font-size: 10pt;">pd.</span><span style="font-size: 10pt; font-weight: bold;">date_range</span><span style="font-size: 10pt;">(start='1/1/2017', end='1/5/2017', freq='D')  # 一日毎の連続値</span></div><div><span style="font-size: 10pt;">pd.</span><span style="font-size: 10pt; font-weight: bold;">date_range</span><span style="font-size: 10pt;">(start='1/1/2017 10:00:00', end='1/1/2017 14:00:00', freq='H')  # 一時間毎の連続値</span></div><div><span style="font-size: 10pt;">pd.</span><span style="font-size: 10pt; font-weight: bold;">date_range</span><span style="font-size: 10pt;">(start='1/1/2017', periods=5,  freq='D')  # 開始と個数指定</span></div><div><span style="font-size: 10pt;">pd.</span><span style="font-size: 10pt; font-weight: bold;">date_range</span><span style="font-size: 10pt;">(end='1/1/2017', periods=5,  freq='D')  # 終了と個数指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime型の列を期間範囲指定して特定の行だけ抽出</span></font></div><div><span style="font-size: 10pt;">import datetime</span></div><div><span style="font-size: 10pt;">df['日付_datetime'] = pd.to_datetime(df['日付'])  # datetime型に型変換</span></div><div><span style="font-size: 10pt;">df = df[df['日付_datetime'] &gt; datetime.datetime(2019,5,3)]</span></div><div><span style="font-size: 10pt;">df = df.query('&quot;2016-10-13&quot; &lt;= date &lt;= &quot;2016-11-13&quot;')  # queryならsqlっぽくかける</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime型の列にn日足す</span></font></div><div><span style="font-size: 10pt;">import pandas.tseries.offsets as offsets</span></div><div><span style="font-size: 10pt;">df['datetime'] = df['datetime'] + offsets.Day(-90)  # 90日前にする</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 文字列をdatetime型に変換</span></div><div><span style="font-size: 10pt;">df2['日時'] = pd.to_datetime(df2['日時'], format='%Y/%m月%d日-%H:%M') # フォーマットを指定して変換</span></div><div><span style="font-size: 10pt;">df3['日付'] = pd.to_datetime(df3['年'].astype(str)+'-'+ df3['月'].astype(str)+'-'+ df3['日'].astype(str)) # 各列連結してdatetime型に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># インデックスをDatetimeIndexに変換。</span><span style="font-size: 10pt; font-weight: bold;">インデックスをdatetime型にすると時系列データを処理する様々な機能が使えるようになる</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">df.index = pd.to_datetime(df.index) </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の形式をyyyymmの文字型に変更する</span></div><div><span style="font-size: 10pt;">df['year_month'] = df['_date'].apply(lambda x: pd.to_datetime(x, format='%Y-%m-%d').strftime(&quot;%Y%m&quot;))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 日付の形式がばらばら（2020/04/12 や 2020年4月12日 など）の列の形式をそろえる</span></div><div><span style="font-size: 10pt;"># 数値として取り込まれたレコードのindex</span></div><div><span style="font-size: 10pt;">is_digit = df['登録日'].astype('str').str.isdigit()</span></div><div><span style="font-size: 10pt;"># 2020年4月12日のようなデータは1900/01/01からの日数（数値）として変換される（うるう年は考慮されないが）ので、1900/01/01に足し算する</span></div><div><span style="font-size: 10pt;">from_digit = pd.to_timedelta(df.loc[is_digit]['登録日'].astype('float'), unit='D') + pd.to_datetime('1900/01/01')</span></div><div><span style="font-size: 10pt;">from_str = df.loc[~is_digit]['登録日']</span></div><div><span style="font-size: 10pt;">df['登録日'] = pd.concat([from_digit, from_str])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 対数変換</span></font></div><div><span style="font-size: 10pt;">df = df.apply(np.log)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 対数逆変換</span></font></div><div><span style="font-size: 10pt;">df = df.apply(np.exp)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 列を対数化</span></font></div><div><span style="font-size: 10pt;">df['log10'] = df['value'].apply(lambda x: np.log10(x + 1))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">正規表現用いたindexから</span><span style="font-size: 10pt; font-weight: bold;">特定の行だけ抽出</span></div><div><span style="font-size: 10pt;">df＝df.filter(</span><span style="font-size: 10pt; font-weight: bold;">regex</span><span style="font-size: 10pt;">='^index_*',</span> <span style="font-size: 10pt; font-weight: bold;">axis=0</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 正規表現用いた列名から</span><span style="font-size: 10pt; font-weight: bold;">特定の列だけ抽出</span></font></div><div><span style="font-size: 10pt;">df＝df.filter(</span><span style="font-size: 10pt; font-weight: bold;">regex</span><span style="font-size: 10pt;">='^col_*')</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">df＝df.filter(</span><span style="font-size: 10pt; font-weight: bold;">regex</span><span style="font-size: 10pt;">='^col_*',</span> <span style="font-size: 10pt; font-weight: bold;">axis=1</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列についてor条件で指定した値が含まれている行を返す</span></div><div><span style="font-size: 10pt;">df[df['Grade'].</span><span style="font-size: 10pt; font-weight: bold;">isin</span><span style="font-size: 10pt;">(['A', 'B'])]</span></div><div><span style="font-size: 10pt;">top_oceania_wines = reviews[ (reviews['country'].isin(['Australia', 'New Zealand']))</span> <span style="font-size: 10pt; font-weight: bold;">&amp;</span> <span style="font-size: 10pt;">(reviews['points'] &gt;= 95)]  # and条件つなげるのは&amp;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の文字列を含む部分一致（正規表現つかえる）</span></div><div><span style="font-size: 10pt;">df[df['pre_y'].str.contains('&lt;=')]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 特定の文字列を含まない行</span><span style="font-size: 10pt; font-weight: bold;">部分一致</span></font></div><div><span style="font-size: 10pt;">df[~df['columnA'].str.contains('moji', na = False)]</span></div><div><span style="font-size: 10pt;">df = df[~df['target'].str.contains('〜')] </span></div><div><span style="font-size: 10pt;">df = df[~df['target'].str.contains('.', regex=False)]  # 正規表現無効にして検索</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 列の各要素の数列挙. </span><span style="font-size: 10pt; font-weight: bold;">Seriesで値返す</span></font></div><div><span style="font-size: 10pt;">df['isFraud'].value_counts()  </span></div><div><span style="font-size: 10pt;">#0    6354407</span></div><div><span style="font-size: 10pt;">#1       8213</span></div><div><span style="font-size: 10pt;">#Name: isFraud, dtype: int64</span></div><div><span style="font-size: 10pt;">↑pd.Series(x_list).value_counts() と同じこと</span></div><div><span style="font-size: 10pt;">また、groupbyでもかける</span></div><div><span style="font-size: 10pt;">df.groupby('isFraud').size()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># np.where(条件, Trueの時返す値, Falseの時返す値) で列の条件分岐</span></div><div><span style="font-size: 10pt;"># 20以上であれば、C列をA列として設定</span></div><div><span style="font-size: 10pt;"># 20件未満であれば、C列をB列として設定</span></div><div><span style="font-size: 10pt;">df['D'] =</span> <span style="font-size: 10pt; font-weight: bold;">np.where(df['C'] - 1 &gt;= 20, df['A'], df['B'])</span></div><div><span style="font-size: 10pt;">df = df.apply(lambda row:</span> <span style="font-size: 10pt; font-weight: bold;">np.where(row['C'] - 1 &gt;= 20, row['A'], row['B'])</span><span style="font-size: 10pt;">, axis=1)</span></div><div><span style="font-size: 10pt;">df['E'] =</span> <span style="font-size: 10pt; font-weight: bold;">np.where(df['C'] - df['D'] &gt;= 20, 1, 0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">np.where(df['id'] is np.nan, 0, 1) のように、np.nanはnp.whereでは使うと警告出る。この場合は以下のようにしたらいける</span></div><div><span style="font-size: 10pt;">df['flg'] = 1</span></div><div><span style="font-size: 10pt;">df.loc[df['id'].isnull(), 'flg'] = 0</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># テストデータの予測値を二値に変換する</span></div><div><span style="font-size: 10pt;">pred_label = np.where(pred &gt; 0.5, 1, 0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-weight: bold;"># 層別(カテゴリ)化 標高を『1000未満』『1000以上』という2つのカテゴリに分ける</span></div><div>df['alt'] = np.where(df['alt'] &gt;= 1000, &quot;1&quot;, &quot;0&quot;)</div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># グループ単位で集約</span></font></div><div><span style="font-size: 10pt;">df =</span> <span style="font-size: 10pt; font-weight: bold;">df.groupby('id').size().reset_index() </span><span style="font-size: 10pt;"> # reset_index()したらグループ化解除される</span></div><div><span style="font-size: 10pt;">df.columns = ['id', 'count']</span></div><div><span style="font-size: 10pt;">もしくは</span></div><div><span style="font-size: 10pt;">df =</span> <span style="font-size: 10pt; font-weight: bold;">df.groupby('id').size().reset_index().rename(columns={0: 'count'})</span></div><div><span style="font-size: 10pt;">もしくは</span></div><div><span style="font-size: 10pt;">df = df.groupby('id').</span><span style="font-size: 10pt; font-weight: bold;">agg</span><span style="font-size: 10pt;">({'id_1': 'count', 'id_2': 'nunique'}).reset_index()  #</span> <span style="font-size: 10pt; font-weight: bold;">aggで集計処理(</span><span style="font-size: 10pt; font-weight: bold;">id_1列はカウント、id_2列はユニークな数)をまとめて実行</span></div><div><span style="font-size: 10pt;">df.columns = ['id', 'id_1_count', 'id_2_nunique']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># グループ単位で合計</span></div><div><span style="font-size: 10pt;">df =</span> <span style="font-size: 10pt; font-weight: bold;">df.groupby('id').sum().reset_index() </span> <span style="font-size: 10pt;"># reset_index()したらグループ化解除される</span></div><div><span style="font-size: 10pt;">df.columns = ['id', 'sum']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># グループ単位で合計した列を元のデータフレームに追加する</span></div><div><span style="font-size: 10pt;">_df = df.groupby('id')['value'].sum().reset_index().rename(columns={'value': 'value_by_id_sum'})</span></div><div><span style="font-size: 10pt;">df = pd.merge(df, _df, on='id')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># groupby を使うと、デフォルトでグループラベルが index になる。index にしたく無い場合は as_index=False を指定する。</span></div><div><span style="font-size: 10pt;">df = df.groupby(['city', 'food'],</span> <span style="font-size: 10pt; font-weight: bold;">as_index=False</span><span style="font-size: 10pt;">).mean()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># id列でgroupbyして、グループ単位でA列でソートする</span></div><div><span style="font-size: 10pt;">df = df.groupby('id').apply(lambda x: x.sort_values(by='A')).reset_index(drop=True)  # reset_index()ではid列が重複してエラーになるので注意</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># .groupsでgroupby によってどのように DataFrame が分割されたかを見れる（デバック用）</span></div><div><span style="font-size: 10pt;">df.groupby('city').groups</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># groupby()はforで回せる</span></div><div><span style="font-size: 10pt;">for name, df in df.groupby('col'):  # nameは'col'の代表値になる</span></div><div><span style="font-size: 10pt;">    if name == 'xxx':</span></div><div><span style="font-size: 10pt;">        print(df)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># price列についてグループ化（値が15.0の行を1くくりにするみたいに）して、その各グループ（くくり）について、points列の最大値をseriesでだす</span></div><div><span style="font-size: 10pt;">best_rating_per_price = reviews.groupby('price')['points'].max()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># df.groupby('columns_name').agg()でグループ化したくくりの統計量（最小値や最大値）出せる(aggだとDataFrame型を返す)</span></div><div><span style="font-size: 10pt;">df_price_extremes = reviews.groupby('variety').price.agg([min, max])</span></div><div><span style="font-size: 10pt;">df_price_extremes = reviews.groupby('variety')['price'].min() # min()の関数使うとseriesを返す</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の優先順位指定して値の降順ソート</span></div><div><span style="font-size: 10pt;">sorted_varieties = price_extremes.sort_values(by=['min', 'max'], ascending=False)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 2列使ってグループ化して同じ値の行を数える。集計値を降順ソート</span></div><div><span style="font-size: 10pt;">country_variety_counts = reviews.groupby(['country', 'variety']).size().sort_values(ascending=False)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># n件前の列追加</span><span style="font-size: 10pt; font-weight: bold;">（ソートしてからshiftしているから、インデックスぐちゃぐちゃの状態でもいける）</span></font></div><div><span style="font-size: 10pt;">df['before'] = pd.Series(</span></div><div><span style="font-size: 10pt;">    df.groupby('id').apply(lambda x: x.sort_values(by='A', ascending=True))  # id列でグループ化してA列でソート</span></div><div><span style="font-size: 10pt;">    ['value'].</span><span style="font-size: 10pt; font-weight: bold;">shift(2)  # value列だけにしてを2件下にずらす</span></div><div><span style="font-size: 10pt;">    .reset_index(drop=True)  # グループ化解除+idの列を削除</span></div><div><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># n</span><span style="font-size: 10pt; font-weight: bold;">件ごとの</span><span style="font-size: 10pt; font-weight: bold;">合計列追加（sql使った方が短く書ける。ソートしてから合計計算しているから、インデックスぐちゃぐちゃの状態でもいける）</span></font></div><div><span style="font-size: 10pt;">df['sum'] = pd.Series(</span></div><div><span style="font-size: 10pt;">    df.groupby('id').apply(lambda x: x.sort_values(by='A', ascending=True))  # id列でグループ化してA列でソート</span></div><div><span style="font-size: 10pt;">    ['value']</span><span style="font-size: 10pt; font-weight: bold;">.rolling(3, min_periods=3).sum()  # value列のwindow3件にまとめ、その合計値を計算。</span><span style="font-size: 10pt; font-weight: bold;">rolling:データを区切る関数=Window関数</span></div><div><span style="font-size: 10pt;">    .reset_index(drop=True)  # グループ化解除+idの列を削除</span></div><div><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># n件ごとの平均列追加</span><span style="font-size: 10pt; font-weight: bold;">（ソートしてから合計計算しているから、インデックスぐちゃぐちゃの状態でもいける）</span></font></div><div><span style="font-size: 10pt;">df['avg'] = pd.Series(</span></div><div><span style="font-size: 10pt;">    df.groupby('id').apply(lambda x: x.sort_values(by='A', ascending=True))</span></div><div><span style="font-size: 10pt;">    ['value']</span><span style="font-size: 10pt; font-weight: bold;">.rolling(3, min_periods=1).mean()  # value列のwindow3件にまとめ、その平均値を計算。min_periodsを1に設定し、1件以上あった場合には計算するよう設定</span></div><div><span style="font-size: 10pt;">    .reset_index(drop=True)</span></div><div><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 2列連結</span></div><div><span style="font-size: 10pt;">df['sex_age'] = df[['sex', 'age']]</span><span style="font-size: 10pt; font-weight: bold;">.apply(lambda x: f'{x[0]}_{x[1]}', axis=1)  # apply(, axis=1)で各行に適用</span></div><div><span style="font-size: 10pt;">df['sex_age'] = df[['sex', 'age']].</span><span style="font-size: 10pt; font-weight: bold;">apply(lambda x: f'{x[0]}_{int(np.floor(x[1] / 10) * 10)}', axis=1)  # 年齢を10,20刻みにする場合</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 月の数字を季節に変換</span></div><div><span style="font-size: 10pt;">def to_season(month_num):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; 月の数字を季節に変換する関数 &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    season = 'winter'</span></div><div><span style="font-size: 10pt;">    if 3 &lt;= month_num &lt;= 5:</span></div><div><span style="font-size: 10pt;">        season = 'spring'</span></div><div><span style="font-size: 10pt;">    elif 6 &lt;= month_num &lt;= 8:</span></div><div><span style="font-size: 10pt;">        season = 'summer'</span></div><div><span style="font-size: 10pt;">    elif 9 &lt;= month_num &lt;= 11:</span></div><div><span style="font-size: 10pt;">        season = 'autumn'</span></div><div><span style="font-size: 10pt;">    return season</span></div><div><span style="font-size: 10pt;">df['datetime'] = pd.to_datetime(df['datetime'], format='%Y-%m-%d %H:%M:%S')</span></div><div><span style="font-size: 10pt;">df['season'] = pd.Categorical(df['datetime'].dt.month.apply(to_season),</span></div><div><span style="font-size: 10pt;">                                           categories=['spring', 'summer', 'autumn', 'winter'])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 順序のあるカテゴリ型に変換</span></font></div><div><span style="font-size: 10pt;">df['season'] = pd.Categorical(df['datetime'].dt.month.apply(to_season),</span></div><div><span style="font-size: 10pt;">                                           categories=['spring', 'summer', 'autumn', 'winter'],</span> <span style="font-size: 10pt; font-weight: bold;">ordered=True</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームdeep copy</span></div><div><span style="font-size: 10pt;">df_deep = df.copy()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 各カラムのデータ型を表示</span></div><div><span style="font-size: 10pt;">df.dtypes</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の型変換</span></div><div><span style="font-size: 10pt;">df[var_lst] = df[var_lst].astype(int)</span></div><div><span style="font-size: 10pt;">df[var_lst] = df[var_lst].astype(float)</span></div><div><span style="font-size: 10pt;">df[var_lst] = df[var_lst].astype('bool')  # ブール型に変換</span></div><div><span style="font-size: 10pt;">df.points.astype('float64')</span></div><div><span style="font-size: 10pt;">df.points.astype(str) # 文字列型に変更</span></div><div><span style="font-size: 10pt;">df[var_lst] = df[var_lst].astype('category')  # カテゴリ型に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 数値列のカテゴリ化(年齢を10代,20代のようにカテゴリ列にする)</span></div><div><span style="font-size: 10pt;">df['age_rank'] = (np.floor(df['age'] / 10) * 10).astype('category')  # np.floorは小数点切り捨て</span></div><div><span style="font-size: 10pt;">df['age_rank'] = pd.Categorical(np.floor(df['age']/10)*10)  # pd.Categoricalでもカテゴリ変数に変換できる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># floatにできないデータは欠損にして、列をfloat型に変換する関数</span></div><div><span style="font-size: 10pt;">def _to_float(x):</span></div><div><span style="font-size: 10pt;">    try:</span></div><div><span style="font-size: 10pt;">        return float(x)</span></div><div><span style="font-size: 10pt;">    except Exception as e:</span></div><div><span style="font-size: 10pt;">        return x</span></div><div><span style="font-size: 10pt;">df['A'] = df['A'].apply(_to_float).dropna()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># indexのデータ型を表示</span></div><div><span style="font-size: 10pt;">df.index.dtype</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Date_index列をindexにする</span></div><div><span style="font-size: 10pt;">df = df.set_index('Date_index')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># state</span><span style="font-size: 10pt; font-weight: bold;">列をindexにし、state列は残す</span></font></div><div><span style="font-size: 10pt;">df.set_index('state', drop=False)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 2列の</span><span style="font-size: 10pt; font-weight: bold;">データフレームを辞書に変換</span></font></div><div><span style="font-size: 10pt;">dict_class = df_dict_class.set_index('classes_ids').to_dict()['unicode']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 辞書を</span><span style="font-size: 10pt; font-weight: bold;">データフレームに変換</span></font></div><div><span style="font-size: 10pt;">pd.DataFrame(dic, index=['i',]) # indexを指定しないとエラーになるので i としておく</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 文字型の列を数値に変換</span></div><div><span style="font-size: 10pt;">data['ローン審査'] = data['ローン審査'].map({'NG': 0, 'OK': 1})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレーム→辞書</span></div><div><span style="font-size: 10pt;">print(df)</span></div><div><span style="font-size: 10pt;">    id    value</span></div><div><span style="font-size: 10pt;">0    0     10.2</span></div><div><span style="font-size: 10pt;">1    1      5.7</span></div><div><span style="font-size: 10pt;">df.set_index('id').to_dict()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレーム→numpy</span></div><div><span style="font-size: 10pt;">array = df.as_matrix()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 昇順ソート（降順はascending=False）</span></div><div><span style="font-size: 10pt;">df = df.sort_values(by=['項目1'], ascending=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 複数列指定してソート ↓は'項目2'列は降順</span></div><div><span style="font-size: 10pt;">df = df.sort_values(by=['項目1', '項目2'], ascending=[True, False])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># シリーズ(series)の降順ソート</span></div><div><span style="font-size: 10pt;">df_value_counts = df_label['SERIES_NO'].value_counts().sort_values(ascending=False)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seriesの名前変更</span></font></div><div><span style="font-size: 10pt;">ts = df['終値']</span></div><div><span style="font-size: 10pt;">ts.index.name = 'date'  # index名変更</span></div><div><span style="font-size: 10pt;">ts.name = 'close'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># -1をnanに置換</span></div><div><span style="font-size: 10pt;">df_label = df_label.replace(-1.0, np.nan)</span></div><div><span style="font-size: 10pt;">df_label['col'] = df_label['col'].replace(-1.0, np.nan)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームに欠損値入れる場合は None/np.nan/math.nan を入れる</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame([{'A' : [1, 2, None, np.nan, math.nan]}])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームの各要素の欠損値を判定（False:欠損以外、True:欠損）. isnul()はisna()のエイリアス（別名）</span></div><div><span style="font-size: 10pt;">df.isnull() or df.isna() # 元オブジェクやトと同じサイズ（行数・列数）のTrue/Falseのオブジェクト返す</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列や行について欠損値を判定（False:欠損以外、True:欠損）</span></div><div><span style="font-size: 10pt;">df['e'].isnull() # [False, False, …] # 列名指定</span></div><div><span style="font-size: 10pt;">df['e'].isna() # [False, False, …] # 列名指定</span></div><div><span style="font-size: 10pt;">df.iloc[2].isnull() # [False, False, …] # 行index指定</span></div><div><span style="font-size: 10pt;">df.iloc[2].isna() # [False, False, …] # 行index指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損確認</span></div><div><span style="font-size: 10pt;">df.isnull().any()  # </span><span style="font-size: 10pt; font-weight: bold;">欠損値持つ列確認</span></div><div><span style="font-size: 10pt;">df.isnull().any(axis=1)  # </span><span style="font-size: 10pt; font-weight: bold;">欠損値持つ行確認</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 全要素欠損値の列判定</span></div><div><span style="font-size: 10pt;">df.isnull.all() # all()で列全体に適用</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 全要素欠損値の行判定</span></div><div><span style="font-size: 10pt;">df.isnull.all(axis=1) # all(axis=1)で列全体に適用</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行・列ごとに欠損値をひとつでも含むか判定</span></div><div><span style="font-size: 10pt;">df.isnull().any() # 列について</span></div><div><span style="font-size: 10pt;">df.isnull().any(axis=1) # 行について</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値でないレコード確認</span></div><div><span style="font-size: 10pt;">pd.notnull(df) # [True, True, …]</span></div><div><span style="font-size: 10pt;">pd.notnull(df['e']) # [True, True, …]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># how='all'を指定するとすべての値が欠損値の行削除。dropnaはnanは削除するがNoneは消さないので注意</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna(how='all') </span> <span style="font-size: 10pt;"># Noneをnanにしてからdropna</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna(how='all', axis=1)</span> <span style="font-size: 10pt;">#</span><span style="font-size: 10pt; font-weight: bold;"> </span><span style="font-size: 10pt;">すべての値が欠損値の列削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># どこかに欠損値が一つ以上入っている行削除</span></div><div><span style="font-size: 10pt;">df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna()</span></div><div><span style="font-size: 10pt;">df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna(how='any') </span> <span style="font-size: 10pt;"># dropna()もdropna(how='any')も同じ</span></div><div><span style="font-size: 10pt;">df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna(how='any', axis=1)</span> <span style="font-size: 10pt;"># どこかに欠損値が一つ以上入っている</span><span style="font-size: 10pt; font-weight: bold;">列削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># nanおよび-inf値を削除</span></div><div><span style="font-size: 10pt;">df= df[~df.isin([np.nan, np.inf, -np.inf]).any(1)]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列に欠損値がある行を削除する</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan)</span><span style="font-size: 10pt; font-weight: bold;">.dropna(subset=['age'])</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan).dropna(subset=['age', 'name']) # 指定した列のいずれかで欠損ある行削除</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan).dropna(subset=['age', 'name'], how='all') # 指定した列すべてが欠損ある行削除</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan).dropna(subset=[1, 4], axis=1) # subsetで指定した行indexのいずれかに欠損ある列を削除</span></div><div><span style="font-size: 10pt;">df = df.replace('None', np.nan).dropna(subset=[1, 4], axis=1, how='all') # subsetで指定した行indexすべて欠損ある列を削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損ある行と欠損なし行を分ける</span></div><div><span style="font-size: 10pt;">df_non_nan = df.dropna(subset=['A'])  # 欠損していないデータの抽出</span></div><div><span style="font-size: 10pt;">df_nan = df.loc[df.index.difference(df_non_nan.index), :]  # 欠損しているデータの抽出</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値を0で置き換える</span></div><div><span style="font-size: 10pt;">distance_matrix</span></div><div><span style="font-size: 10pt;">df = df['col'].replace('None', np.nan).</span><span style="font-size: 10pt; font-weight: bold;">fillna(&quot;aaa&quot;)</span> <span style="font-size: 10pt;"># col列の欠損値をaaaに置き換える</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値を最小値で置き換える</span></div><div><span style="font-size: 10pt;">df = df.fillna(df.min())</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値を平均で置き換える</span></div><div><span style="font-size: 10pt;">df = df.fillna(df.mean())</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値を最大値で置き換える</span></div><div><span style="font-size: 10pt;">df = df.fillna(df.max())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列が欠損値の行だけ表示</span></div><div><span style="font-size: 10pt;">df[df.country.isnull()]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定列が欠損値ではない行だけ表示</span></div><div><span style="font-size: 10pt;">df[df.a.isnull() == False]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 各列の欠損値のレコード数確認</span></div><div><span style="font-size: 10pt;">df_active.isnull().sum())</span></div><div><span style="font-size: 10pt;">display(pd.DataFrame(df.isnull().sum()).T)  # データフレームで見た方が見やすい</span></div><div><span style="font-size: 10pt;">print(len(df) - df.count())  # これでも欠損の数わかる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># col列の特定の値を置換する</span></div><div><span style="font-size: 10pt;">df['col'].replace(&quot;@kerinokeefe&quot;, &quot;@kerino&quot;) # 完全一致</span></div><div><span style="font-size: 10pt;">df_task[col] = df_task[col].replace('y&lt;', 'y&gt;', regex=True) # 部分一致は, regex=True が必要</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列の値をすべてNaNにする</span></div><div><span style="font-size: 10pt;">df_pred_sub_edit['labels'][ df_pred_sub_edit['image_id'].isin(less_image_ids) ] = np.nan</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># np.nanを含むfloat型の列をint型変換（pd.read_csvでロードすると欠損値があるのでfloatに戻るが）</span></div><div><span style="font-size: 10pt;">df_act_v2['class_label'] = df_act_v2['class_label'].fillna(-1)</span></div><div><span style="font-size: 10pt;">df_act_v2['class_label'] = df_act_v2['class_label'].astype(int)</span></div><div><span style="font-size: 10pt;">df_act_v2['class_label'] = df_act_v2['class_label'].astype(str)</span></div><div><span style="font-size: 10pt;">df_act_v2['class_label'] = df_act_v2['class_label'].replace('-1', np.nan)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 条件に応じて値代入。labels列の値変更</span></div><div><span style="font-size: 10pt;">for l in df_old_labels_null['image_id'].values:</span></div><div><span style="font-size: 10pt;">    df.loc[df.image_id == l, 'labels'] = np.nan</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># forの中でデータフレーム更新する場合はdf.at[,]= でないと更新されない。locとかじゃダメだった</span></div><div><span style="font-size: 10pt;">for _ind, _row in df.iterrows():</span></div><div><span style="font-size: 10pt;">    df.</span><span style="font-size: 10pt; font-weight: bold;">at</span><span style="font-size: 10pt;">[_ind, 'A'] = 'IFDOCO'</span></div><div><span style="font-size: 10pt;">    df.</span><span style="font-size: 10pt; font-weight: bold;">at</span><span style="font-size: 10pt;">[_ind, 'B'] = '成行'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行を下にずらす</span></div><div><span style="font-size: 10pt;">df.shift(1)   # index=0の行がNaNになり、index=1にindex=0の行が入る</span></div><div><span style="font-size: 10pt;">df.shift(-1)  # index=-1(最後)の行がNaNになり、index=-2にindex=-1の行が入る</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 重複した行を削除してindex振り直し</span></div><div><span style="font-size: 10pt;">df = df.drop_duplicates().reset_index(drop=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 平均</span></div><div><span style="font-size: 10pt;">median_points = reviews['points'].mean()</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 中央値</span></div><div><span style="font-size: 10pt;">median_points = reviews['points'].median()</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 一意</span></div><div><span style="font-size: 10pt;">countries = reviews['country'].unique()</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 度数</span></div><div><span style="font-size: 10pt;">reviews_per_country = reviews['country'].value_counts()</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 最大値のindex取得</span></div><div><span style="font-size: 10pt;">df['col1'].idxmax()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列の外れ値削除（1%以下99%以上のデータ除く）</span></div><div><span style="font-size: 10pt;">p01 = x['col'].quantile(0.01)</span></div><div><span style="font-size: 10pt;">p99 = x['col'].quantile(0.99)</span></div><div><span style="font-size: 10pt;">x['col'] = x['col'].clip(p01, p99, axis=1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレームに関数適用. </span><span style="font-size: 10pt; font-weight: bold;">df.apply(lambda x: ) や </span><span style="font-size: 10pt; font-weight: bold;">df['カラム名'].apply(lambda x: ) が基本形</span></font></div><div><span style="font-size: 10pt;">f_maxmin = lambda x: max(x) - min(x)</span></div><div><span style="font-size: 10pt;">df = df.apply(f_maxmin) # 各列に関数適用</span></div><div><span style="font-size: 10pt;">df = df.apply(f_maxmin, axis=1) # 各行に関数適用</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 特定の列に関数適用. df[‘col’].map(lambda x: )でもいける</span></div><div><span style="font-size: 10pt;">f_maxmin = lambda x: max(x) - min(x)</span></div><div><span style="font-size: 10pt;">df[col+'_float'] = df[col].map(f_maxmin)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">各行に関数適用</span><span style="font-size: 10pt; font-weight: bold;">.</span> <span style="font-size: 10pt; font-weight: bold;">df.apply( ,</span> <span style="font-size: 10pt; font-weight: bold;">axis=1</span><span style="font-size: 10pt; font-weight: bold;">) or</span> <span style="font-size: 10pt; font-weight: bold;">df.apply( ,</span> <span style="font-size: 10pt; font-weight: bold;">axis='columns'</span><span style="font-size: 10pt; font-weight: bold;">) </span><span style="font-size: 10pt; font-weight: bold;">にして、</span><span style="font-size: 10pt; font-weight: bold;">applyに渡す第一引数を1レコードにする</span></div><div><span style="font-size: 10pt;">def func(</span><span style="font-size: 10pt; font-weight: bold;">row</span><span style="font-size: 10pt;">, tmp):</span></div><div><span style="font-size: 10pt;">    return row['A'] + row['B'] + row['C'] + tmp</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame({'A':[1,2,3],'B':[10,20,30],'C':[100,200,300]})</span></div><div><span style="font-size: 10pt;">df['D'] = df.apply(func, tmp=10</span><span style="font-size: 10pt; font-weight: bold;">, axis=1</span><span style="font-size: 10pt;">) # df['D']:121, 232, 343</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">def stars(</span><span style="font-size: 10pt; font-weight: bold;">row</span><span style="font-size: 10pt;">):</span></div><div><span style="font-size: 10pt;">    if row.country == 'Canada':</span></div><div><span style="font-size: 10pt;">        return 3</span></div><div><span style="font-size: 10pt;">    elif row.points &gt;= 95:</span></div><div><span style="font-size: 10pt;">        return 3</span></div><div><span style="font-size: 10pt;">    elif row.points &gt;= 85:</span></div><div><span style="font-size: 10pt;">        return 2</span></div><div><span style="font-size: 10pt;">    else:</span></div><div><span style="font-size: 10pt;">        return 1</span></div><div><span style="font-size: 10pt;">star_ratings = df.apply(stars</span><span style="font-size: 10pt; font-weight: bold;">, axis='columns'</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3レコードごとの移動平均計算</span></div><div><span style="font-size: 10pt;">df['Open'].rolling(window=3).mean()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3レコードごとの移動最大値計算</span></div><div><span style="font-size: 10pt;">df['Open'].rolling(window=3).max()</span></div><div><span style="font-size: 10pt;">df['Open'].rolling(window=3, min_periods=2).max()  # min_periodsは移動値計算す開始するデータの個数。この場合2レコード先に進んでからしか値計算せず、0,1レコード目はNaNになる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># indexを</span><span style="font-size: 10pt; font-weight: bold;">連番に振り直し</span></font></div><div><span style="font-size: 10pt;">df_label = df_label.reset_index() # drop=True を指定しなければ、旧インデックスがデータ列に移動</span></div><div><span style="font-size: 10pt;">df.reset_index(drop=True, inplace=True) # inplace=True で、オブジェクトを直接書きかえられます</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># multiindexで特定のindexだけ列に戻す</span></div><div><span style="font-size: 10pt;">df_r_1 = df_m.reset_index(level='level_1')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># indexを列にする </span></div><div><span style="font-size: 10pt;">df = df.reset_index()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 結合</span></div><div><span style="font-size: 10pt;">df_label = pd.merge(df_NPI_label, df_GAR_label, on=['smi', 'SERIES_NO', 'img_path']) </span></div><div><span style="font-size: 10pt;">df_label = pd.merge(df_NPI_label, df_GAR_label, on=['smi', 'SERIES_NO', 'img_path'], how='left') # 左外部結合</span></div><div><span style="font-size: 10pt;">df_label = pd.merge(df_NPI_label, df_GAR_label, on=['smi', 'SERIES_NO', 'img_path'], how='outer') # 完全外部結合</span></div><div><span style="font-size: 10pt;">pd.merge(df_ab, df_ac_, left_on='a', right_on='a_').drop(columns='a_') # 列名それぞれ指定。指定した2列残るから1列消す</span></div><div><span style="font-size: 10pt;">pd.merge(</span><span style="font-size: 10pt; font-weight: bold;">df.query('_num == 1')</span><span style="font-size: 10pt;">,</span> <span style="font-size: 10pt; font-weight: bold;">df2.query('is_business == True')</span><span style="font-size: 10pt;">, on='hotel_id', how='inner')  # 必要なレコードだけqueryで取り出してからmergeした方が早い</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 全結合:</span><span style="font-size: 10pt; font-weight: bold;">cross join</span><span style="font-size: 10pt; font-weight: bold;">（全てのコンビネーションの行の結果セットを取得する。 [ 左のテーブルのレコード数 ] x [ 右のテーブルのレコード数 ] になる</span></font></div><div><span style="font-size: 10pt;">df['join_key'] = 0  # cross joinのためにすべて同じ値の結合キーを準備</span></div><div><span style="font-size: 10pt;">df2['join_key'] = 0  # cross joinのためにすべて同じ値の結合キーを準備</span></div><div><span style="font-size: 10pt;">df_cross = pd.merge(df[['id', 'join_key']], df2, on='join_key')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># indexをキーにしてデータフレーム結合(join). joinはmergeと同じことしている</span></div><div><span style="font-size: 10pt;">df_combined = df.set_index(&quot;MeetID&quot;).join(df2.set_index(&quot;MeetID&quot;))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレーム縦積み（縦</span><span style="font-size: 10pt; font-weight: bold;">方向の連結</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df = df1.append(df2) or df = pd.concat([df1, df2], ignore_index=True)</span></div><div><span style="font-size: 10pt;">df_concat = pd.concat([df1, df2]) # df1はA,B,C列、df2はC,D列のみ</span></div><div><span style="font-size: 10pt;">print(df_concat)</span></div><div><span style="font-size: 10pt;">#          A    B   C    D</span></div><div><span style="font-size: 10pt;"># ONE     A1   B1  C1  NaN</span></div><div><span style="font-size: 10pt;"># TWO     A2   B2  C2  NaN</span></div><div><span style="font-size: 10pt;"># TWO    NaN  NaN  C2   D2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 空変数にforでデータフレーム縦積み（縦</span><span style="font-size: 10pt; font-weight: bold;">方向の連結</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df_concat = None</span></div><div><span style="font-size: 10pt;">for npy in l_conf_npy:</span></div><div><span style="font-size: 10pt;">    df = make_result_df(npy)</span></div><div><span style="font-size: 10pt;">    if df_concat is None:</span></div><div><span style="font-size: 10pt;">        df_concat = df</span></div><div><span style="font-size: 10pt;">    else:</span></div><div><span style="font-size: 10pt;">        df_concat = pd.concat([df_concat, df], ignore_index=True)</span></div><div><span style="font-size: 10pt;">    # df_concat = df if df_concat is None else pd.concat([df_concat, df], ignore_index=True)  # 上の4行三項演算子なら1行で書ける</span></div><div><span style="font-size: 10pt;">   </span></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">データフレーム</span> <span style="font-size: 10pt; font-weight: bold;">横方向の連結</span></div><div><span style="font-size: 10pt;">pd.concat([df1, df4], axis=1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">文字列の列同士の結合（連結）</span></font></div><div><span style="font-size: 10pt;">raw_train_df_id['unicode_id'].str.cat(raw_train_df_id['unicode'], sep='_')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の連結</span></div><div><span style="font-size: 10pt;">df['new'] = df['name'] + df['state']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームを4行ずつseriesとしてforで回す</span></div><div><span style="font-size: 10pt;">for x, y in zip(df[n:n+4]['x'], df[n:n+4]['y']):</span></div><div><span style="font-size: 10pt;">    d = math.sqrt((x - X_means[i]) ** 2 + (y - Y_means[i]) ** 2)</span></div><div><span style="font-size: 10pt;">    d += d</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ピボットテーブル（クロス集計表）→平均値が算出される</span></div><div><span style="font-size: 10pt;">data = {'Date':['Jan-1', 'Jan-1', 'Jan-1', 'Jan-2', 'Jan-2', 'Jan-2'],</span></div><div><span style="font-size: 10pt;">        'User':['Emily', 'John', 'Nick', 'Kevin', 'Emily', 'John'],</span></div><div><span style="font-size: 10pt;">        'Method':['Card', 'Card', 'Cash', 'Card', 'Cash', 'Cash'],</span></div><div><span style="font-size: 10pt;">        'Price':[100, 250, 200, 460, 200, 130]}</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame(data)</span></div><div><span style="font-size: 10pt;">df.pivot_table(values='Price', index=['Date', 'Method'], columns=['User'])</span></div><div><span style="font-size: 10pt;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/Image.png" type="image/png" data-filename="Image.png" title="Attachment"/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">ピボットテーブルとか</span><span style="font-size: 10pt; font-weight: bold;">マルチインデックスのデータフレームで特定の値の行だけ指定列を横断して取得</span></div><div><span style="font-size: 10pt;">pivot.xs('Card', level='Method')</span></div><div><span style="font-size: 10pt;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/Image [1].png" type="image/png" data-filename="Image.png" title="Attachment"/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#### pivot_tavbleの例 ####</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('titanic')  # タイタニック号のデータ</span></div><div><span style="font-size: 10pt;">display(df.head(3))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># columnsで指定した列の要素ごとに平均値計算</span></div><div><span style="font-size: 10pt; font-weight: bold;"># valueが集計を行う対象の列データ</span></div><div><span style="font-size: 10pt; font-weight: bold;"># indexがクロス集計表のindexにする列。この列の要素数分行ができる</span></div><div><span style="font-size: 10pt; font-weight: bold;"># columnsがクロス集計表のcolumnsにする列。この列の要素数分列ができる</span></div><div><span style="font-size: 10pt; font-weight: bold;"># aggfuncが集計方法、デフォルトはmean</span></div><div><span style="font-size: 10pt;">df_pivot = pd.pivot_table(df,</span> <span style="font-size: 10pt; font-weight: bold;">values</span><span style="font-size: 10pt;">=&quot;age&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">index</span><span style="font-size: 10pt;">=&quot;survived&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">columns</span><span style="font-size: 10pt;">=&quot;embarked&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">aggfunc</span><span style="font-size: 10pt;">='mean')</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># indexやcolumnsはリストにすると多層にできる。マルチインデックスになる</span></div><div><span style="font-size: 10pt;">df_pivot = pd.pivot_table(df,values=&quot;age&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">index=[&quot;pclass&quot;,&quot;embarked&quot;]</span><span style="font-size: 10pt;">, columns=&quot;survived&quot;)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;">df_pivot = pd.pivot_table(df,values=&quot;age&quot;, index=[&quot;embarked&quot;],</span> <span style="font-size: 10pt; font-weight: bold;">columns=[&quot;survived&quot;, &quot;pclass&quot;]</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データの個数をカウント:aggfunc='count'</span></div><div><span style="font-size: 10pt;"># valuesを指定しないとこのようにインデックスとカラムラベルに選択されていないデータ全てを対象にピボットテーブルが作成されます</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(index='survived', columns='embarked',</span> <span style="font-size: 10pt; font-weight: bold;">aggfunc='count'</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;"># valuesを指定</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(values='age', index='survived', columns='embarked', aggfunc='count')</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;"># margins=Trueなら、列ごとと行ごとの合計を表示</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(values='age', index='survived', columns='embarked', aggfunc='count',</span> <span style="font-size: 10pt; font-weight: bold;">margins=True</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(values=&quot;age&quot;, index='survived', columns='embarked',</span> <span style="font-size: 10pt; font-weight: bold;">aggfunc=lambda x: len(x)</span><span style="font-size: 10pt;">)  # aggfunc='count'と同じ</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># aggfuncは関数リストで渡せる</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(values=&quot;age&quot;, index='survived', columns='embarked',</span> <span style="font-size: 10pt; font-weight: bold;">aggfunc=['count', 'mean']</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;"># numpyの平均と標準偏差</span></div><div><span style="font-size: 10pt;">df_pivot = df.pivot_table(values=&quot;age&quot;, index='survived', columns='embarked', aggfunc=[np.mean, np.std])</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># fill_value=0で欠損値0埋めできる</span></div><div><span style="font-size: 10pt;">df_pivot = pd.pivot_table(df, values=&quot;age&quot;, index=&quot;deck&quot;, columns=&quot;embarked&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">fill_value=0</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># dropna=Falseで欠損値があるデータも表示させる</span></div><div><span style="font-size: 10pt;">df_pivot = pd.pivot_table(df, values=&quot;age&quot;, index=&quot;deck&quot;, columns=&quot;embarked&quot;,</span> <span style="font-size: 10pt; font-weight: bold;">dropna=False</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><span style="font-size: 10pt;">####################</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 集計したpivotテーブルから前から6列だけを取り出して縦積み</span></div><div><span style="font-size: 10pt; font-weight: bold;">df_pivot = df_month_cid.pivot_table(index=['customer_id'], columns='yyyymm', values='count').reset_index()</span></div><div><span style="font-size: 10pt;">df_reg = None</span></div><div><span style="font-size: 10pt;">customer_ids = df_pivot['customer_id']</span></div><div><span style="font-size: 10pt;">df_pivot = df_pivot.drop(['customer_id'], axis=1)</span></div><div><span style="font-size: 10pt;">cols = sorted(df_month_cid['yyyymm'].unique())</span></div><div><span style="font-size: 10pt;">for i in range(len(cols) - 6):</span></div><div><span style="font-size: 10pt;">    </span><span style="font-size: 10pt; font-weight: bold;">dftmp = df_pivot[cols[i:i+7]]</span></div><div><span style="font-size: 10pt;">    dftmp.columns = [*[f'count_{i}month_ago' for i in [6, 5, 4, 3, 2, 1]], *['count_pred']]</span></div><div><span style="font-size: 10pt;">    dftmp['customer_id'] = customer_ids</span></div><div><span style="font-size: 10pt;">    dftmp['yyyymm'] = cols[i+6]</span></div><div><span style="font-size: 10pt;">    df_reg = dftmp if df_reg is None else pd.concat([df_reg, dftmp], ignore_index=True)</span></div><div><span style="font-size: 10pt;">display(df_reg.shape, df_reg.head())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># meltはpivot_tableの逆変換ができる(整然データ)</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('iris')</span></div><div><span style="font-size: 10pt; font-weight: bold;">df = df.melt(id_vars='species')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame({'月': ['1月', '2月', '3月'],</span></div><div><span style="font-size: 10pt;">                   '京都': [110, 115, 144],</span></div><div><span style="font-size: 10pt;">                   '大阪': [263, 283, 309],</span></div><div><span style="font-size: 10pt;">                   '奈良': [12, 13, 21],</span></div><div><span style="font-size: 10pt;">                  })</span></div><div><span style="font-size: 10pt;">display(df)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># df.meltは複数行に渡るデータ(ピボットテーブルのような集計表)を1列（縦積み）に並べ替える=集計表を縦積み(tidy-data:整然データ)にする</span></div><div><span style="font-size: 10pt; font-weight: bold;"># id_varsが縦積みにする列。var_nameは縦積みした表の列名。value_nameは縦積みした表の値についての列名</span></div><div><span style="font-size: 10pt;">df_melt =</span> <span style="font-size: 10pt; font-weight: bold;">df.melt(id_vars='月', var_name='地域', value_name='人数')  # df.melt(id_vars='月') でもいける</span></div><div><span style="font-size: 10pt; font-weight: bold;">display(df_melt)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># meltの逆変換はpivot=縦積み(tidy-data)を集計表にする</span></div><div><span style="font-size: 10pt; font-weight: bold;">df_pivot = df_melt.pivot(values='人数', index='月', columns='地域').reset_index()</span></div><div><span style="font-size: 10pt; font-weight: bold;">df_pivot.columns.name = None  # reset_indexしただけでは「月」が「地域」に入っておかしなことになる</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># meltはcolumn名を新たに加えた通常の列に展開することによって表を変形</span></div><div><span style="font-size: 10pt; font-weight: bold;"># stackはcolumn名をindexの新たな階層に展開することによって表を変形する。このことがmeltとstackの主な違い</span></div><div><span style="font-size: 10pt;">df2 = df.set_index('月')</span></div><div><span style="font-size: 10pt;">display(df2)</span></div><div><span style="font-size: 10pt;">df2_stack = df2</span><span style="font-size: 10pt; font-weight: bold;">.stack()  # stackはmeltのように縦積みになるがseries型になる</span></div><div><span style="font-size: 10pt;">display(df2_stack)</span></div><div><span style="font-size: 10pt;">display(df2_stack.</span><span style="font-size: 10pt; font-weight: bold;">unstack())  # unstackはstackをもとのデータフレームに戻す</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># meltは複数の列でもリストで指定すれば縦積みにできる</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame({'月': ['1月', '2月', '3月'],</span></div><div><span style="font-size: 10pt;">                   '年': ['2020', '2019', '2018'],</span></div><div><span style="font-size: 10pt;">                   '京都': [110, 115, 144],</span></div><div><span style="font-size: 10pt;">                   '大阪': [263, 283, 309],</span></div><div><span style="font-size: 10pt;">                   '奈良': [12, 13, 21],</span></div><div><span style="font-size: 10pt;">                  })</span></div><div><span style="font-size: 10pt;">display(df)</span></div><div><span style="font-size: 10pt;">df_melt = df.melt(</span><span style="font-size: 10pt; font-weight: bold;">id_vars=['月', '年'</span><span style="font-size: 10pt;">], var_name='地域', value_name='人数')  </span><span style="font-size: 10pt; font-weight: bold;"># df.melt(id_vars=['月', '年']) でもいける</span></div><div><span style="font-size: 10pt;">display(df_melt)</span></div><div><span style="font-size: 10pt;">df_pivot = df_melt.</span><span style="font-size: 10pt; font-weight: bold;">pivot_table(values='人数', index=['月', '年'], columns='地域').reset_index()  # pivotだと重複データによりエラーになる</span></div><div><span style="font-size: 10pt;">df_pivot.columns.name = None  # reset_indexしただけでは「月」が「地域」に入っておかしなことになる</span></div><div><span style="font-size: 10pt;">display(df_pivot)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">df.pivot()、df.pivot_table()ほぼ同じ</span></font></div><div><span style="font-size: 10pt;">→df.pivot_table()はaggfuncで集計したデータに適用する関数指定できるが、valuesが数値しか適用できない。集計関数適用されるので重複データあってエラーにならない</span></div><div><span style="font-size: 10pt;">→df.pivotはaggfuncは指定できないが、valuesは文字列でも集計(平均とるのでその値そのまま出す)できる。ただし、indexに重複データあるような集計になるとエラーになる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームの縦積みは、各データフレームをlist詰めてconcatすれば一気にできる</span></div><div><span style="font-size: 10pt;">list_concat_df = [pd.read_csv(csv_file) for csv_file in glob.glob('./*csv')]</span></div><div><span style="font-size: 10pt;">df = pd.concat(list_concat_df, ignore_index=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># sqliteファイルロードしてselect</span></div><div><span style="font-size: 10pt;">import sqlite3</span></div><div><span style="font-size: 10pt;">conn = sqlite3.connect('../input/pitchfork-data/database.sqlite')</span></div><div><span style="font-size: 10pt;">music_reviews = pd.read_sql_query(&quot;SELECT * FROM artists&quot;, conn)  # pd.read_sql(&quot;SELECT * FROM artists&quot;, conn) やpd.read_sql_table(&quot;SELECT * FROM artists&quot;, conn) でもいいみたい</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 相関係数（Pearson's r）</span><span style="font-size: 10pt; font-weight: bold;">計算</span></font></div><div><span style="font-size: 10pt;">s1=pd.Series([4, 6, 0, 8, 6, 2, 0, 3, 3, 5])</span></div><div><span style="font-size: 10pt;">s2=pd.Series([4, 6, 3, 7, 8, 4, 6, 9, 0, 0])</span></div><div><span style="font-size: 10pt;">res = s1.corr(s2)   # numpy.float64 に格納される</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># pandasの標準偏差は不変標準偏差（</span><span style="font-size: 10pt; font-weight: bold;">一部のデータから全体の状況を推定するときの標準偏差</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">pd.Series(range(10)).std()  # 3.0276503540974917 // pandasのstdの結果（不偏標準偏差）</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">※numpyの標準偏差は母標準偏差（データがすべてある（母集団からだした）ときの標準偏差）</span></div><div><span style="font-size: 10pt;">np.array(range(10)).std()  # 2.8722813232690143 // numpyのstdの結果（母標準偏差）</span></div><div><span style="font-size: 10pt;">np.array(range(10)).std(ddof=1)  # ddof=1つけたら不偏標準偏差になる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># シリーズのi→i+1番目要素の増加率を計算する</span></div><div><span style="font-size: 10pt;">val = pd.Series([100,120,110,150,160])</span></div><div><span style="font-size: 10pt;">val.</span><span style="font-size: 10pt; font-weight: bold;">pct_change</span><span style="font-size: 10pt;">()</span></div><div><span style="font-size: 10pt;"># 0         NaN</span></div><div><span style="font-size: 10pt;"># 1    0.200000</span></div><div><span style="font-size: 10pt;"># 2   -0.083333</span></div><div><span style="font-size: 10pt;"># 3    0.363636</span></div><div><span style="font-size: 10pt;"># 4    0.066667</span></div><div><span style="font-size: 10pt;"># dtype: float64</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># shiftで1行をずらして(shift(1):i番目の行がi+1番目の行になる)、pct_change()と同じように、i→i+1番目の要素の増加率を計算する</span></div><div><span style="font-size: 10pt;">df = (df['profit'] - df['profit'].shift(1)) / df['profit'].shift(1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">## 特定の列でソートして CSV に出力し、Excel で眺める時に使うpandasのテクニック</span></div><div><span style="font-size: 10pt; font-weight: bold;"># timestamp列でソートして先頭を出力</span></div><div><span style="font-size: 10pt;">df = df.sort_values(by='date_col')</span></div><div><span style="font-size: 10pt;">df.iloc[:500].to_csv(’tmp.csv’)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># user_id列の値をランダムに100件選んで、該当する行をすべて出力する場合</span></div><div><span style="font-size: 10pt;">users = df[’user_id’].unique()</span></div><div><span style="font-size: 10pt;">users = np.random.choice(users, 100)</span></div><div><span style="font-size: 10pt;">df.set_index(’user_id’).loc[users].to_csv(’tmp.csv’)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># target列=0のレコード50、target列=1のレコード50選んで、交互に出力する場合（※交互になっているものを Excel 上で見比べることで、意外なパターンに気づくこともあります。）</span></div><div><span style="font-size: 10pt;">neg_users = df.query(’target == 0’)[’user_id’].unique()</span></div><div><span style="font-size: 10pt;">neg_users = np.random.choice(neg_users, 50)</span></div><div><span style="font-size: 10pt;">pos_users = df.query(’target == 1’)[’user_id’].unique()</span></div><div><span style="font-size: 10pt;">pos_users = np.random.choice(pos_users, 50)</span></div><div><span style="font-size: 10pt;"># 交互にならべる</span></div><div><span style="font-size: 10pt;">users = np.empty(100)</span></div><div><span style="font-size: 10pt;">users[0::2] = neg_users</span></div><div><span style="font-size: 10pt;">users[1::2] = pos_users</span></div><div><span style="font-size: 10pt;">df.set_index(’user_id’).loc[users].to_csv(’tmp.csv’)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 数値変数を順位へ変換</span></div><div><span style="font-size: 10pt;">x = [10,20,30,0,40,40]</span></div><div><span style="font-size: 10pt;">rank = pd.Series(x).rank() # [2,3,4,1,5.5,5.5]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># pandas</span><span style="font-size: 10pt; font-weight: bold;">でラベルをonehot化</span></font></div><div><span style="font-size: 10pt;">all_y = pd.concat([train_y, test_y])</span></div><div><span style="font-size: 10pt;">all_y =</span> <span style="font-size: 10pt; font-weight: bold;">pd.get_dummies(all_y, columns=['col1', 'col2']) # onehotにする列はcolumnsで指定。</span><span style="font-size: 10pt; font-weight: bold;">pd.get_dummies(all_y, columns=['col1', 'col2'], drop_first=True)とすると最初のダミー列削除する（この場合はcol2だけになる）→drop_firstは2値分類で一方の列いらんときとかに使う</span></div><div><span style="font-size: 10pt;">#train_yとtest_y再分割</span></div><div><span style="font-size: 10pt;">train_y = all_y.iloc[:train_y.shape[0], :].reset_index(drop=True)</span></div><div><span style="font-size: 10pt;">test_y = all_y.iloc[train_y.shape[0]:, :].reset_index(drop=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-weight: bold;">#  列ダミー変数にする</span></div><div>def dummy_df(df, col: str):</div><div>    &quot;&quot;&quot;指定列をダミー変数にする&quot;&quot;&quot;</div><div>    import pandas as pd</div><div>    dummy = pd.get_dummies(df[col], drop_first=True)</div><div>    df = pd.concat([df, dummy], axis=1)</div><div>    return df.drop([col], axis=1)</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ランダムに100件選んで、該当する列の値変更</span></div><div><span style="font-size: 10pt;">_df = pd.DataFrame(y_train)</span></div><div><span style="font-size: 10pt;">_ids = np.random.choice(_df.index, 100)</span></div><div><span style="font-size: 10pt;"># 0列目の値変更</span></div><div><span style="font-size: 10pt;">_df.loc[_ids,0] = -1.0</span></div><div><span style="font-size: 10pt;">y_train = np.array(_df)</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-weight: bold;"># 欠損値を列の中央値で補間</span></div><div>def impute_nan_df(df, strategy='median'):  # strategy='mean' でも可能</div><div>    &quot;&quot;&quot;欠損値を列の中央値などで補間&quot;&quot;&quot;</div><div>    import numpy as np</div><div>    from sklearn.impute import SimpleImputer  # SimpleImputer は列方向にしか補間できない（行方向は無理）</div><div>    imr = SimpleImputer(missing_values=np.nan,  # 欠損値=NaN</div><div>                        strategy=strategy,    # medianなら中央値で補間、meanなら平均値で補間</div><div>                        )</div><div>    num_cols = [col for col in df.columns if df[col].dtype.name not in ['object', 'category', 'bool']]  # 数値列の列名だけにする</div><div>    df_num = df[num_cols]</div><div>    imputed_data = imr.fit_transform(df_num)</div><div>    df_imputed = pd.DataFrame(imputed_data, columns=df_num.columns)</div><div><br/></div><div>    if df.columns.to_list() != num_cols:</div><div>        # 除いた数値列以外の列もつける</div><div>        other_cols = set(df.columns.to_list()) - set(num_cols)</div><div>        df_other = df[other_cols]</div><div>        df = pd.concat([df_imputed, df_other], axis=1)</div><div>    else:</div><div>        df = df_imputed</div><div>    return df</div><div><br/></div><div><span style="font-weight: bold;"># SVMで外れ値の検出</span></div><div>def outlier_svm_df(df, nu=0.05, is_plot=True):</div><div>    &quot;&quot;&quot;</div><div>    データフレームの数値列のみSVMで外れ値となる行計算</div><div>    データフレームに正常値(1),異常値(-1)の列追加してreturn</div><div>    &quot;&quot;&quot;</div><div>    from sklearn import svm</div><div>    import matplotlib.pyplot as plt</div><div>    clf = svm.OneClassSVM(nu=nu)  # nuは学習エラーを指定するもので、小さいほど異常値かどうかの判定基準が複雑になる傾向にあります</div><div><br/></div><div>    if len(df) - df.count().min() &gt; 0:  # 欠損値あるかチェック</div><div>        shape_before = df.shape</div><div>        df = df.dropna()  # 欠損あるとエラーになるので削除しておく</div><div>        print(&quot;INFO: dropna shape. {} -&gt; {}&quot;.format(shape_before, df.shape))</div><div><br/></div><div>    num_cols = [col for col in df.columns if df[col].dtype.name not in ['object', 'category', 'bool']]  # 数値列の列名だけにする</div><div>    df_num = df[num_cols]</div><div>    clf.fit(df_num)</div><div>    df['predict'] = clf.predict(df_num)  # 外れ値計算結果の列作成</div><div><br/></div><div>    if is_plot:</div><div>        # 正常値(1),異常値(-1)の数をplot</div><div>        v_counts = df['predict'].value_counts()</div><div>        v_counts.plot.bar()</div><div>        plt.show()</div><div><br/></div><div>    return df</div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Pandasでの可視化</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pandasのグラフ可視化でチャート綺麗に書くおまじない</span></div><div><span style="font-size: 10pt;">import matplotlib</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">plt.style.use('ggplot')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pngで保存</span></div><div><span style="font-size: 10pt;">ax = df.plot()</span></div><div><span style="font-size: 10pt;">fig = ax.get_figure()</span></div><div><span style="font-size: 10pt;">fig.savefig('test.png')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># pandasのグラフサイズ大きくする</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">df.plot(figsize=(10, 10))</span></div><div><span style="font-size: 10pt;">or</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">fig, ax = plt.subplots(figsize=(10, 3))  </span><span style="font-size: 10pt; font-weight: bold;"># subplotでfigsize指定</span></font></div><div><span style="font-size: 10pt;">df.plot(ax=ax)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt; font-weight: bold;">fig = plt.figure(figsize=(10, 8))  #</span> <span style="font-size: 10pt; font-weight: bold;">figure</span><span style="font-size: 10pt; font-weight: bold;">でfigsize指定</span></div><div><span style="font-size: 10pt;">ax = fig.add_subplot(1, 1, 1)</span></div><div><span style="font-size: 10pt;">df.plot(title='aaa', ax=ax)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt; font-weight: bold;">plt.rcParams[&quot;figure.figsize&quot;] = [8,4]  # matplotのグラフサイズのデフォルト値変更</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pandasのグラフ並べる</span></div><div><span style="font-size: 10pt;">fig, ax = plt.subplots(1, 2, figsize=(10, 3))  # 2行1列で並べる</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[0])</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[1])</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">fig, ax = plt.subplots(2, 2, figsize=(10, 3))  # 2行2列で並べる</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[0, 0])</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[1, 0])</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[0, 1])</span></div><div><span style="font-size: 10pt;">df.plot(ax=ax[1, 1])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 折れ線グラフ:</span><span style="font-size: 10pt; font-weight: bold;">df.plot()</span></font></div><div><span style="font-size: 10pt;">df.plot()</span></div><div><span style="font-size: 10pt;">df.plot(kind='line')  # kindはグラフの種類指定。lineは折れ線</span></div><div><span style="font-size: 10pt;">df.plot.line()  # kindはドットでつないでもいける</span></div><div><span style="font-size: 10pt;">df.plot(x=df.columns[0])  # x軸指定する場合</span></div><div><span style="font-size: 10pt;">df.plot(y=df.columns[0])  # y軸指定する場合</span></div><div><span style="font-size: 10pt;">df['#Passengers'].plot(figsize=(8, 2))  # seriesでも</span></div><div><span style="font-size: 10pt;">df1['aaa'].plot(marker='x', ax=ax)  # マーカー指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 散布図:df.plot.</span><span style="font-size: 10pt; font-weight: bold;">scatter()</span></font></div><div><span style="font-size: 10pt;">df.plot.scatter(x='sepal_length', y='petal_length', alpha=0.5) </span> <span style="font-size: 10pt; font-weight: bold;"># x,yの指定必須。x,yは数値列でないとエラー</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 棒グラフ</span><span style="font-size: 10pt; font-weight: bold;">:</span><span style="font-size: 10pt; font-weight: bold;">df.plot.bar()</span></font></div><div><span style="font-size: 10pt;">df.plot(kind='bar')</span></div><div><span style="font-size: 10pt;">df.plot.bar(alpha=0.6, figsize=(12,12))</span></div><div><span style="font-size: 10pt;">df.plot(kind='bar', alpha=0.6, figsize=(12,12))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># series.</span><span style="font-size: 10pt; font-weight: bold;">value_counts()で計算した度数(series)を棒グラフ化</span></font></div><div><span style="font-size: 10pt;">count = y_train.value_counts()# y_trainはseries</span></div><div><span style="font-size: 10pt;">count.plot.bar()</span></div><div><span style="font-size: 10pt;">plt.title(u'y_train.value_counts()', size=16)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"># 横棒グラフ:df.plot.barh()</span></span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">df = df_pred_score.loc[:,df_pred_score.columns[::-1]].T # 列名逆順にしておく必要がある。デフォルトは下から並ぶので</span></span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">df.iloc[:-2,0].plot.barh(alpha=0.6)</span></span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">or</span></span></div><div style="box-sizing: border-box; margin: 0px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="box-sizing: border-box; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">df.iloc[:-2,0].plot(kind='barh', alpha=0.6)</span></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># df.plot.barhの横棒グラフの先端に数値書く</span></div><div><span style="font-size: 10pt;">nega_posi.plot.barh(alpha=0.6, figsize=(figsize[0],figsize[1]), color='red')</span></div><div><span style="font-size: 10pt;">for i,v in enumerate(nega_posi.values):</span></div><div><span style="font-size: 10pt;">    plt.text(v, i, str(np.round(v, decimals=2)), color='red', fontweight='bold')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 各列の値の積み上げ棒グラフ:df.plot.bar(, stacked=True)</span></div><div><span style="font-size: 10pt;">df_monthly.plot.bar(y=['ad', 'ba', 'se'], alpha=0.6, figsize=(12,3), stacked=True, cmap='Blues')</span></div><div><span style="font-size: 10pt;">plt.title(u'積み上げ型の棒グラフ', size=16)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">plt.bar(x, df['y1'])</span></div><div><span style="font-size: 10pt;">plt.bar(x, df['y2'], bottom=y1)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ヒストグラム:df.plot.hist()</span></div><div><span style="font-size: 10pt;">df[['Class']].hist(figsize = (10, 5))  # データフレームでplot.hist()することで列名が凡例になる。df['Class'].plot.hist()でもエラー出ないが凡例でない</span></div><div><span style="font-size: 10pt;">df.plot(bins=50, alpha=0.5, figsize=(16,4), kind='hist')  # alphaは色の濃さ</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># y軸logスケールで</span><span style="font-size: 10pt; font-weight: bold;">度数のヒストグラム</span></font></div><div><span style="font-size: 10pt;">df.plot.hist(logy=True)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">fig, ax = plt.subplots(figsize = (15, 5))</span></div><div><span style="font-size: 10pt;">raw_train_df[['unicode_id']].hist(ax=ax, bins=df_unicode.shape[0], bottom=0.1)</span></div><div><span style="font-size: 10pt;">ax.set_yscale('log')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 箱ひげグラフ:df.plot.box()</span></div><div><span style="font-size: 10pt;">df.plot.box()</span></div><div><span style="font-size: 10pt;">df.plot.(kind='box')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># カーネル密度推定（データの</span><span style="font-size: 10pt; font-weight: bold;">確率密度関数を推定</span><span style="font-size: 10pt; font-weight: bold;">）:df.plot.kde() or df.plot.density()</span></font></div><div><span style="font-size: 10pt;">df.plot.kde() or df.plot.density()</span></div><div><span style="font-size: 10pt;">df.plot(kind='kde') or df.plot(kind='density')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 折れ線+塗りつぶし:df.plot.area()</span></font></div><div><span style="font-size: 10pt;">df.plot.area()</span></div><div><span style="font-size: 10pt;">df.plot(kind='area')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 円グラフ:df['num_col'].plot.pie() ※1列でしかできない。データフレーム全体指定するとエラー</span></font></div><div><span style="font-size: 10pt;">df['num_col'].plot.pie()</span></div><div><span style="font-size: 10pt;">df.plot.pie(kind='pie', y=df.columns[0])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 散布図:df.plot.scatter(x=df['num_col1'], y=df['num_col2']) ※散布図はx,yの指定必須</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># グラフ重ねる（matplotlibのsubplotsのaxと同じ）</span></div><div><span style="font-size: 10pt;">ax1 = df.plot(kind='hist')  # ヒストグラムとカーネル密度を重ねてplot</span></div><div><span style="font-size: 10pt;">df.plot(kind='kde', ax=ax1, secondary_y=True)  # secondary_yを使ってy2軸を使用</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># その他df.plot()のオプション引数</span></font></div><div><a href="https://own-search-and-study.xyz/2016/08/03/pandas%E3%81%AEplot%E3%81%AE%E5%85%A8%E5%BC%95%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%99/" style="font-size: 10pt;">https://own-search-and-study.xyz/2016/08/03/pandas%E3%81%AEplot%E3%81%AE%E5%85%A8%E5%BC%95%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%99/</a></div><div><span style="font-size: 10pt; font-weight: bold;">df.plot(figsize=(10, 10))  # グラフのサイズを指定するときに使うパラメータ（幅、高さ）。単位はインチ</span></div><div><span style="font-size: 10pt;">df.plot(use_index=False)  # index列をx軸に使用するかを指定するパラメータ。デフォルトはTrue。Falseを指定すると、indexを単純に連番に設定したグラフになる</span></div><div><span style="font-size: 10pt;">df.plot(title='test')  # タイトル指定</span></div><div><span style="font-size: 10pt;">df.plot(grid=True)  # グリッド線表示</span></div><div><span style="font-size: 10pt;">df.plot(legend=False)  # 凡例表示/非表示。デフォルトはTrue</span></div><div><span style="font-size: 10pt;">df.plot(style=['-', '--', '-.', ':'])  # 線の書式を指定。順番に、solid, dashed, dashdot, dottedを指定</span></div><div><span style="font-size: 10pt;">df.plot(subplots=True)  # 1つのグラフに全plot書かずに1グラフ1plotで個別表示したいときに指定。subplotsがTrueの際に使えるパラメータ（sharex, sharey, layout）がある</span></div><div><span style="font-size: 10pt;">df.plot(subplots=True, sharex=True)  # x軸の目盛りそろえるか。デフォルトはTrue</span></div><div><span style="font-size: 10pt;">df.plot(subplots=True, sharey=True)  # y軸の目盛りそろえるか。デフォルトはFalse</span></div><div><span style="font-size: 10pt;">df.plot(subplots=True, layout=(2, 2))  # 各plotの配置指定。デフォルトは縦積み</span></div><div><span style="font-size: 10pt;">df.plot(xticks=[0, 50, 100, 150])  # x軸の目盛りを指定。目盛りをlistで渡して使用</span></div><div><span style="font-size: 10pt;">df.plot(yticks=[0, 3, 8])  # y軸の目盛りを指定。目盛りをlistで渡して使用</span></div><div><span style="font-size: 10pt;">df.plot(logx=True)  # x軸を対数目盛りにする</span></div><div><span style="font-size: 10pt;">df.plot(logy=True)  # y軸を対数目盛りにする</span></div><div><span style="font-size: 10pt;">df.plot(loglog=True)  # x、y軸を両方対数目盛りにする</span></div><div><span style="font-size: 10pt;">df.plot(xlim=[0, 50])  # x軸の範囲を指定</span></div><div><span style="font-size: 10pt;">df.plot(ylim=[0, 50])  # y軸の範囲を指定</span></div><div><span style="font-size: 10pt;">df.plot(rot=90)  # x軸の目盛り（ラベル名）を回転。ラベル名が長すぎて重なり縦書きにしたい場合使える</span></div><div><span style="font-size: 10pt;">df.plot(fontsize=20)  # x軸とy軸の目盛りのフォントを指定</span></div><div><span style="font-size: 10pt;">df.plot(colormap='viridis')  # カラーマップ指定</span></div><div><span style="font-size: 10pt;">df.plot(xerr=0.5)  # 指定した値だけx軸方向にエラーバーを付加</span></div><div><span style="font-size: 10pt;">df.plot(yerr=0.5)  # 指定した値だけy軸方向にエラーバーを付加</span></div><div><span style="font-size: 10pt;">df.plot(kind='area', stacked=True)  # kindでbarかareaを指定したとき、積み上げ表示にしたいときにTrueを指定</span></div><div><span style="font-size: 10pt;">df.plot(table=df.ix[0:10].T, xlim=[0, 10], xticks=[])  # グラフの下に表を付け足す。xticksは表示しないように設定しないと表と被る</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">データフレームから集合棒グラフplot</span></font></div><div><span style="font-size: 10pt;">df = pd.DataFrame()</span></div><div><span style="font-size: 10pt;">for t in task_name_list:</span></div><div><span style="font-size: 10pt;">    series_count = df_label[t].value_counts()</span></div><div><span style="font-size: 10pt;">    series_count = series_count[[-1,0,1]]</span></div><div><span style="font-size: 10pt;">    df[t] = series_count</span></div><div><span style="font-size: 10pt;">print(df.T)</span></div><div><span style="font-size: 10pt;">df.T.plot(kind='bar', figsize=(16,4))</span></div><div><span style="font-size: 10pt;"># ↓関数にしたの</span></div><div><span style="font-size: 10pt;">def plot_df_hist(df_label, outdir, task_name_list, title='NPI', figsize=(8,4)):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; データフレーム各列のヒストグラムplot &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    #df_label.hist( figsize=figsize, bins=5, range=(-1,1))</span></div><div><span style="font-size: 10pt;">    df = pd.DataFrame()</span></div><div><span style="font-size: 10pt;">    for t in task_name_list:</span></div><div><span style="font-size: 10pt;">        series_count = df_label[t].value_counts()</span></div><div><span style="font-size: 10pt;">        series_count = series_count[[-1,0,1]]</span></div><div><span style="font-size: 10pt;">        df[t] = series_count</span></div><div><span style="font-size: 10pt;">    df.T.plot(kind='bar', figsize=figsize)</span></div><div><span style="font-size: 10pt;">    plt.savefig(os.path.join(outdir, title+'.png'), bbox_inches=&quot;tight&quot;)# label見切れ対策 bbox_inches=&quot;tight&quot;</span></div><div><span style="font-size: 10pt;">    plt.title(title)</span></div><div><span style="font-size: 10pt;">    plt.show() # グラフの表示</span></div><div><span style="font-size: 10pt;">    plt.close('all') # 繰り返しplt.figure()を実行時に出る警告対策</span></div><div><span style="font-size: 10pt;">    plt.clf() # グラフの設定クリア</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">#</span><span style="font-size: 10pt; font-weight: bold;"> データフレームの各列をplot(折れ線グラフ)してpngで保存</span></div><div><span style="font-size: 10pt;">def save_df_plot(col, df, output_dir):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; データフレームの各列をplotしてpngで保存 &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    import matplotlib</span></div><div><span style="font-size: 10pt;">    import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">    plt.style.use('ggplot')</span></div><div><span style="font-size: 10pt;">    df[col].plot()</span></div><div><span style="font-size: 10pt;">    plt.xlabel('epoch')</span></div><div><span style="font-size: 10pt;">    plt.ylabel(col)</span></div><div><span style="font-size: 10pt;">    plt.savefig(os.path.join(output_dir, col+'.png'), bbox_inches=&quot;tight&quot;)</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><span style="font-size: 10pt;">for col in df_hist.columns:</span></div><div><span style="font-size: 10pt;">    save_df_plot(col, df_hist, output_dir)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">データフレームから</span><span style="font-size: 10pt; font-weight: bold;">でバブルチャート。バブルの大きさは s キーワードで指定</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame({'x':x, 'y':y, 'area':area})</span></div><div><span style="font-size: 10pt;">df.plot.scatter(x='x', y='y', s=df['area'], figsize=(15, 6))</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 棒グラフの例</span></font></div><div><span style="font-size: 10pt;">def plot_jpg_len(_dir):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;指定ディレクトリのjpgファイルの数を棒グラフで可視化&quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    label_dir_paths = sorted(glob.glob(str(pathlib.Path(_dir) / '*')))</span></div><div><span style="font-size: 10pt;">    len_label_paths = [len(glob.glob(p + '/*jpg')) for p in label_dir_paths]</span></div><div><span style="font-size: 10pt;">    df = pd.DataFrame({'label':[pathlib.Path(p).name for p in label_dir_paths],</span></div><div><span style="font-size: 10pt;">                       'len':len_label_paths})</span></div><div><span style="font-size: 10pt;">    df = df.set_index('label')</span></div><div><span style="font-size: 10pt;">    df.plot.bar()</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">pandas_highcharts</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">※jupyter labでないとグラフでない</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 株価の時系列データplot</span></div><div><span style="font-size: 10pt;">from pandas_highcharts.display import display_charts</span></div><div><span style="font-size: 10pt;">display_charts(df[['close']], chart_type='stock')  # データフレームで渡さないとだめ</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">pandas-profiling</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># csvファイルのサマリーhtml出力</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">import pandas_profiling</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(’../input/titanic/train.csv’)</span></div><div><span style="font-size: 10pt;">profile = df.profile_report()</span></div><div><span style="font-size: 10pt;">profile.to_file(’profile.html’)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■matplotlib</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibテストコード</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;"># グラフをipython notebook内に表示</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">x = np.arange(-2*3.14, 2*3.14, 0.1)</span></div><div><span style="font-size: 10pt;">y = np.cos(x)</span></div><div><span style="font-size: 10pt;">plt.plot(x, y)</span></div><div><span style="font-size: 10pt;">plt.show()      # グラフの表示</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibでよく使うもの</span></div><div><span style="font-size: 10pt;">plt.figure(figsize=(10,8)) # グラフのサイズ変更</span></div><div><span style="font-size: 10pt;">plt.xlabel('X軸ラベル') # x軸にラベルをつける</span></div><div><span style="font-size: 10pt;">plt.ylabel('Y軸ラベル') # y軸にラベルをつける</span></div><div><span style="font-size: 10pt;">plt.title('title') # 図にタイトルをつける</span></div><div><span style="font-size: 10pt;">plt.plot(x, y, label='ラベル') # plotにラベルをつける</span></div><div><span style="font-size: 10pt;">plt.legend() # 凡例をつける</span></div><div><span style="font-size: 10pt;">plt.xticks(np.arange(-3, 4, 0.5)) # x軸に任意の目盛りをつける</span></div><div><span style="font-size: 10pt;">plt.yticks([0, 5, 10, 20]) # y軸に任意のticksをつける</span></div><div><span style="font-size: 10pt;">plt.axis('off') # x,y軸を消す</span></div><div><span style="font-size: 10pt;">plt.tight_layout() # 軸のラベルとタイトルがかぶるの避ける</span></div><div><span style="font-size: 10pt;">plt.grid(True) # グリッド先消す</span></div><div><span style="font-size: 10pt;">plt.cla()  # 現在の軸をクリア</span></div><div><span style="font-size: 10pt;">plt.clf()  # 現在の図をクリア</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># グラフ表示させない</span></div><div><span style="font-size: 10pt;">matplotlib.use('Agg')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># x,y軸の数値（目盛り）消す</span></font></div><div>ax1.axes.xaxis.set_visible(False)  # axでもpltでもいける</div><div>plt.axes.yaxis.set_visible(False)  # y軸消す</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-weight: bold; font-size: 10pt;"># </span><span style="font-weight: bold;">枠線を消す</span></div><div>ax = plt.gca() # get current axis</div><div>ax.spines[&quot;right&quot;].set_color(&quot;none&quot;)  # 右消し</div><div>ax.spines[&quot;left&quot;].set_color(&quot;none&quot;)   # 左消し</div><div>ax.spines[&quot;top&quot;].set_color(&quot;none&quot;)    # 上消し</div><div>ax.spines[&quot;bottom&quot;].set_color(&quot;none&quot;) # 下消し</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 画像保存(pythonモジュール内では描画できないときはplt.savefigではなくplt.imsave)</span></div><div><span style="font-size: 10pt;">image = plt.imread('Lophophora.jpg')</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">plt.savefig(&quot;result.png&quot;, bbox_inches='tight', pad_inches=0)  # </span><span style="font-size: 10pt; font-weight: bold;">bbox_inchesなどは余白削除オプション</span></font></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt; font-weight: bold;">plt.imsave('ロフォフォラ.jpg', image)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><b># matplotlibの処理終わったらメモリ解放するため、最後に以下の2行をいれること</b></font></div><div><font style="font-size: 10pt;">　<font color="#FF0000">入れないとfor文でループしてるとメモリリーク(メモリあふれること)する</font></font></div><div><font color="#FF0000">　plt.clf() → plt.close()でないと機能しないので注意</font></div><div><font style="font-size: 10pt;">　※参考:</font> <a href="https://qiita.com/Masahiro_T/items/bdd0482a8efd84cdd270">https://qiita.com/Masahiro_T/items/bdd0482a8efd84cdd270</a></div><div><b>plt.clf()</b></div><div><b>plt.close()</b></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibのフォント名確認</span></div><div><span style="font-size: 10pt;">import matplotlib.font_manager</span></div><div><span style="font-size: 10pt;">fonts = matplotlib.font_manager.findSystemFonts()</span></div><div><span style="font-size: 10pt;">[matplotlib.font_manager.FontProperties(fname=f).get_name() for f in fonts]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibの日本語化</span></div><div><span style="font-size: 10pt;"># 上のmatplotlibのフォント名検索して指定する</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">plt.rcParams[&quot;font.family&quot;] = 'Yu Gothic'   # </span><span style="font-size: 10pt; font-weight: bold;">Yu Gothic指定すれば日本語出せる</span></font></div><div><span style="font-size: 10pt;"># グラフをipython notebook内に表示</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">x = np.arange(-2*3.14, 2*3.14, 0.1)</span></div><div><span style="font-size: 10pt;">y = np.cos(x)</span></div><div><span style="font-size: 10pt;">plt.plot(x, y)</span></div><div><span style="font-size: 10pt;">plt.title('日本語')</span></div><div><span style="font-size: 10pt;">plt.show()      # グラフの表示</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibの図のデフォルト値変更</span></div><div><span style="font-size: 10pt;"># plt.rcParams[&quot;調整したいパラメータ&quot;] = (値)でデフォルト設定をオーバーライドできる</span></div><div><a href="https://qiita.com/aurueps/items/d04a3bb127e2d6e6c21b" style="font-size: 10pt;">https://qiita.com/aurueps/items/d04a3bb127e2d6e6c21b</a></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">plt.rcParams[&quot;figure.figsize&quot;] = [8,4]</span><span style="font-size: 10pt; font-weight: bold;">      # 図の縦横のサイズ([横(inch),縦(inch)])。デフォルトは[6.4, 4.8]</span></div><div><span style="font-size: 10pt;">plt.rcParams[&quot;figure.dpi&quot;] = 150            # dpi(dots per inch)。デフォルトは100.0</span></div><div><span style="font-size: 10pt;"># print(plt.rcParams)  # で設定値見れる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># チャート綺麗に書くおまじない</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">plt.style.use('ggplot')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 画像保存時の凡例見切れ対策</span></div><div><span style="font-size: 10pt;">plt.savefig(os.path.join(outdir, title+'.png'), bbox_inches=&quot;tight&quot;)# label見切れ対策 bbox_inches=&quot;tight&quot;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># plt.subplots の例</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">np.random.seed(0)</span></div><div><span style="font-size: 10pt;">values = 33.73 * np.random.randn(10000) + 170.69</span></div><div><span style="font-size: 10pt; font-weight: bold;">fig, ax = plt.subplots(facecolor=&quot;w&quot;)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># subplot全体のグラフにタイトルつける</span></div><div><span style="font-size: 10pt; font-weight: bold;">fig.suptitle(&quot;distribution&quot;)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># ヒストグラムを描画する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.hist(values, bins=50)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># x 軸のラベルを設定する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.set_xlabel(&quot;height (cm)&quot;)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># y 軸のラベルを設定する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.set_ylabel(&quot;frequency&quot;)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># タイトルを設定する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.set_title(&quot;stature distribution&quot;)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># x軸の範囲を2～3に設定</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.set_xlim(2, 3)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># y軸の範囲を0～100に設定</span></div><div><span style="font-size: 10pt; font-weight: bold;">ax.set_ylim(0, 100)</span></div><div><span style="font-size: 10pt; font-weight: bold;"># x 軸、y 軸のラベル及びタイトルを取得する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">print(&quot;get_xlabel()&quot;, ax.get_xlabel())  # get_xlabel() height (cm)</span></div><div><span style="font-size: 10pt; font-weight: bold;">print(&quot;get_ylabel()&quot;, ax.get_ylabel())  # get_ylabel() frequency</span></div><div><span style="font-size: 10pt; font-weight: bold;">print(&quot;get_title()&quot;, ax.get_title())  # get_title() stature distribution</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">figsize=(w, h)</span><span style="font-size: 10pt; font-weight: bold;">はグラフのサイズ指定。タプルで（横幅，高さ）をインチ数で指定</span></div><div><span style="font-size: 10pt; font-weight: bold;"># この場合100画素 x 100画素のグラフが表示される</span></div><div><span style="font-size: 10pt;">fig, axes = plt.subplots(</span><span style="font-size: 10pt; font-weight: bold;">figsize</span><span style="font-size: 10pt;">=(1, 1), dpi=100)</span></div><div><span style="font-size: 10pt;">axes.plot(x, y1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># plt.subplots でグラフ並べる</span></div><div><span style="font-size: 10pt;">fig, ax = plt.subplots(2, 2, figsize=(6, 4))</span></div><div><span style="font-size: 10pt;"># 左上</span></div><div><span style="font-size: 10pt;">ax[0, 0].plot(x, y1)</span></div><div><span style="font-size: 10pt;"># 右上</span></div><div><span style="font-size: 10pt;">ax[0, 1].plot(x, y2)</span></div><div><span style="font-size: 10pt;"># 左下</span></div><div><span style="font-size: 10pt;">ax[1, 0].plot(x, y3)</span></div><div><span style="font-size: 10pt;"># 右下</span></div><div><span style="font-size: 10pt;">ax[1, 1].plot(x, y4)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">matplotlibの</span><span style="font-size: 10pt; font-weight: bold;">散布図</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">df = pd.read_csv('train.csv')</span></div><div><span style="font-size: 10pt;">plt.scatter(df['Age'], df['Fare'], alpha=0.3)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibのバブルチャート. sがバブルの大きさ(半径ではない)</span></div><div><span style="font-size: 10pt;">plt.scatter(x, y, s=area, c=colors, alpha=0.5)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibのヒストグラム</span></div><div><span style="font-size: 10pt;">plt.hist(df['Age'], bin=100)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibの箱ひげグラフ</span></div><div><span style="font-size: 10pt;">plt.boxplot(df['Age'])</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># matplotlibの棒グラフ</span></font></div><div><span style="font-size: 10pt;">plt.figure(figsize=(12, 6))</span></div><div><span style="font-size: 10pt;">plt.bar(df['Date'], df['Volume'])</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><span style="font-size: 10pt;">plt.clf()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotで縦棒plot</span></div><div><span style="font-size: 10pt;">plt.vlines(higher, 0, 0.003, linestyle='dashed', linewidth=0.5)  # vertical line</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotでplotする色指定</span></div><div><span style="font-size: 10pt;">N = 100 # 変えたい色の数</span></div><div><span style="font-size: 10pt;">np.random.seed(0) # 乱数シード固定</span></div><div><span style="font-size: 10pt;">colors = np.random.rand(N) # color番号（0-1の小数）</span></div><div><span style="font-size: 10pt;">plt.scatter(x, y, s=area, c=colors, alpha=0.5)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">import matplotlib</span></div><div><span style="font-size: 10pt;">colors= list(matplotlib.colors.cnames.keys()) # color番号（0-1の小数）</span></div><div><span style="font-size: 10pt;">plt.scatter(x, y, s=area, c=colors, alpha=0.5)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">from matplotlib import pyplot as plt</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">cmap = plt.get_cmap(&quot;tab20&quot;) or </span><span style="font-size: 10pt; font-weight: bold;">cmap</span><span style="font-size: 10pt; font-weight: bold;">= plt.cm.get_cmap('prism')</span></font></div><div><span style="font-size: 10pt;">colors = cmap(0) # (0.12156862745098039, 0.4666666666666667, 0.7058823529411765, 1.0) みたいな色情報</span></div><div><span style="font-size: 10pt;">plt.scatter(x, y, s=area, c=colors, alpha=0.5)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># rgb色情報欲しい場合はmatplotlib.colors を使う</span></div><div><span style="font-size: 10pt;">#</span> <a href="https://blog.imind.jp/entry/2019/05/10/031150" style="font-size: 10pt;">https://blog.imind.jp/entry/2019/05/10/031150</a></div><div><span style="font-size: 10pt;">import matplotlib</span></div><div><span style="font-size: 10pt; font-weight: bold;">cmap = matplotlib.colors.BASE_COLORS  # 8色</span></div><div><span style="font-size: 10pt; font-weight: bold;">cmap = matplotlib.colors.TABLEAU_COLORS  # 10色</span></div><div><span style="font-size: 10pt; font-weight: bold;">cmap = matplotlib.colors.CSS4_COLORS  # 148色</span></div><div><span style="font-size: 10pt;">for idx, (color, rgb) in enumerate(cmap.items()):</span></div><div><span style="font-size: 10pt;">    print(idx, (color, rgb))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># ランダムな(r, g, b)の値取得</span></font></div><div><span style="font-size: 10pt;">def get_random_color(seed=1):</span></div><div><span style="font-size: 10pt;">    import random</span></div><div><span style="font-size: 10pt;">    random.seed(seed)</span></div><div><span style="font-size: 10pt;">    r = random.randint(0,255)</span></div><div><span style="font-size: 10pt;">    g = random.randint(0,255)</span></div><div><span style="font-size: 10pt;">    b = random.randint(0,255)</span></div><div><span style="font-size: 10pt;">    return tuple([r,g,b])</span></div><div><span style="font-size: 10pt;">for i in range(10):</span></div><div><span style="font-size: 10pt;">    print(get_random_color(seed=i))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># rgbを</span><span style="font-size: 10pt; font-weight: bold;">6桁のコードに変換</span></font></div><div><span style="font-size: 10pt;">def rgb_to_hex(rgb):</span></div><div><span style="font-size: 10pt;">    return '%02x%02x%02x' % rgb</span></div><div><span style="font-size: 10pt;">rgb_to_hex((255, 255, 255))  # ffffff</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotlibで円を描く</span></div><div><span style="font-size: 10pt;"># Libraries</span></div><div><span style="font-size: 10pt;">import matplotlib.patches as patches</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;"># Data</span></div><div><span style="font-size: 10pt;">df=pd.DataFrame({'x': range(1,101), 'y': np.random.randn(100)*15+range(1,101) })</span></div><div><span style="font-size: 10pt;"># Plot</span></div><div><span style="font-size: 10pt;">fig1 = plt.figure()</span></div><div><span style="font-size: 10pt;">ax1 = fig1.add_subplot(111)</span></div><div><span style="font-size: 10pt;">ax1.plot( 'x', 'y', data=df, linestyle='none', marker='o')</span></div><div><span style="font-size: 10pt;"># Annotation</span></div><div><span style="font-size: 10pt;">ax1.add_patch(</span></div><div><span style="font-size: 10pt;">patches.Circle(</span></div><div><span style="font-size: 10pt;">(40, 35),           # (x,y)</span></div><div><span style="font-size: 10pt;">30,                    # radius</span></div><div><span style="font-size: 10pt;">alpha=0.3, facecolor=&quot;green&quot;, edgecolor=&quot;black&quot;, linewidth=1, linestyle='solid'</span></div><div><span style="font-size: 10pt;">))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">######## matplotlibのグラフをpdfで保存する ########</span></div><div><span style="font-size: 10pt;"># PdfPagesをimport(覚える必要なし，コピペで使い回す)</span></div><div><span style="font-size: 10pt;">from matplotlib.backends.backend_pdf import PdfPages</span></div><div><span style="font-size: 10pt;"># pdfインスタンス作成．この時点でファイルができる</span></div><div><span style="font-size: 10pt;">pdf = PdfPages('savefig.pdf')</span></div><div><span style="font-size: 10pt;">#------グラフ作成--------</span></div><div><span style="font-size: 10pt;">fig, axes = plt.subplots()</span></div><div><span style="font-size: 10pt;">axes.plot(x, y1, label='first')</span></div><div><span style="font-size: 10pt;">axes.plot(x, y2, label='second')</span></div><div><span style="font-size: 10pt;">axes.plot(x, y1+y2, label='first + second')</span></div><div><span style="font-size: 10pt;">axes.legend(loc=0)</span></div><div><span style="font-size: 10pt;">#-----------------------</span></div><div><span style="font-size: 10pt;">#pdfに保存</span></div><div><span style="font-size: 10pt;">pdf.savefig(fig)</span></div><div><span style="font-size: 10pt;">#close処理（一応やる）</span></div><div><span style="font-size: 10pt;">pdf.close()</span></div><div><span style="font-size: 10pt;">###############################################</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># numpyの画像可視化</span></font></div><div><span style="font-size: 10pt;">def plot_images(images_arr: np.ndarray, y_onehots: np.ndarray):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    ラベルをタイトルにしてnumpyの画像を並べて表示</span></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        images_arr:[5,hight,width,3]のnumpy画像</span></div><div><span style="font-size: 10pt;">        y_onehots:[5,n]のラベル</span></div><div><span style="font-size: 10pt;">    Usage:</span></div><div><span style="font-size: 10pt;">        train_image_generator = ImageDataGenerator(rescale=1./255)</span></div><div><span style="font-size: 10pt;">        train_data_gen = train_image_generator.flow_from_directory(batch_size=batch_size,…)</span></div><div><span style="font-size: 10pt;">        sample_training_images, y_onehots = next(train_data_gen)</span></div><div><span style="font-size: 10pt;">        plot_images(sample_training_images[:5], y_onehots)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    fig, axes = plt.subplots(1, 5, figsize=(20,20))</span></div><div><span style="font-size: 10pt;">    axes = axes.flatten()</span></div><div><span style="font-size: 10pt;">    for img, y, ax in zip (images_arr, y_onehots, axes):</span></div><div><span style="font-size: 10pt;">        ax.imshow(img)</span></div><div><span style="font-size: 10pt;">        ax.set_title(y)</span></div><div><span style="font-size: 10pt;">        ax.axis('off')</span></div><div><span style="font-size: 10pt;">    plt.tight_layout()</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; text-decoration: underline;">■</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">seaborn</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 代表的なデータ取得</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('titanic')  # タイタニック号のデータ</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('iris')  # アイリスのデータ</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('tips')  # ホテルのチップ代のデータ</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornのグラフ1行2列でsubplotで並べる</span></div><div><span style="font-size: 10pt;">fig, ax =</span> <span style="font-size: 10pt; font-weight: bold;">plt.subplots(1, 2</span><span style="font-size: 10pt;">, figsize=(10,20))</span></div><div><span style="font-size: 10pt;">sns.regplot(x='total_bill', y='size', data=tips_df,</span> <span style="font-size: 10pt; font-weight: bold;">ax=ax[0]</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">sns.countplot(x='size', data=tips_df,</span> <span style="font-size: 10pt; font-weight: bold;">ax=ax[1]</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(10,20))</span></div><div><span style="font-size: 10pt;">sns.regplot(x='total_bill', y='size', data=tips_df, ax=ax1)</span></div><div><span style="font-size: 10pt;">sns.countplot(x='size', data=tips_df, ax=ax2)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornのグラフ2行3列でsubplotで並べる</span></div><div><span style="font-size: 10pt;">def plot_dist_col(col, target='survived'):</span></div><div><span style="font-size: 10pt;">    fig, ax =</span> <span style="font-size: 10pt; font-weight: bold;">plt.subplots(2, 3</span><span style="font-size: 10pt;">, figsize=(20,10))</span></div><div><span style="font-size: 10pt;">    fig.suptitle(col)</span></div><div><span style="font-size: 10pt;">    if df[col].dtype.name not in ['object', 'category', 'bool']:</span></div><div><span style="font-size: 10pt;">        sns.distplot(df[col].dropna(), ax=</span><span style="font-size: 10pt; font-weight: bold;">ax[0, 0]</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">    sns.countplot(data=df, x=col, hue=target, ax=ax[0, 1])</span></div><div><span style="font-size: 10pt;">    sns.barplot(x=df[target], y=df[col], ax=ax[0, 2])</span></div><div><span style="font-size: 10pt;">    sns.boxplot(x=df[target], y=df[col], ax=ax[1, 0])</span></div><div><span style="font-size: 10pt;">    sns.violinplot(x=df[target], y=df[col], ax=ax[1, 1])</span></div><div><span style="font-size: 10pt;">    if df[col].dtype.name not in ['bool']:</span></div><div><span style="font-size: 10pt;">        sns.swarmplot(x=df[target], y=df[col], data=df, size=4, ax=ax[1, 2])</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><span style="font-size: 10pt;">plot_dist_col('pclass')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornでグラフのサイズを指定する</span></font></div><div><span style="font-size: 10pt;">fig,</span> <span style="font-size: 10pt; font-weight: bold;">ax</span> <span style="font-size: 10pt;">=</span> <span style="font-size: 10pt; font-weight: bold;">plt.subplots(figsize=(8, 3))</span></div><div><span style="font-size: 10pt;">sns.lineplot(x=&quot;timepoint&quot;, y=&quot;signal&quot;, hue=&quot;region&quot;, data=fmri,</span> <span style="font-size: 10pt; font-weight: bold;">ax=ax</span><span style="font-size: 10pt;">)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt; font-weight: bold;">plt.figure(figsize=(8, 3))</span></div><div><span style="font-size: 10pt;">sns.lineplot(x=&quot;timepoint&quot;, y=&quot;signal&quot;, hue=&quot;region&quot;, data=fmri)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornのヒストグラム</span><span style="font-size: 10pt; font-weight: bold;">（連続値の1変数の分布）</span><span style="font-size: 10pt; font-weight: bold;">: sns.distplot(df['col'])</span></font></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">sns.set() # seabornのスタイルで描画する</span></div><div><span style="font-size: 10pt;">df['age'] = df['age'].dropna()  # 欠損あるとエラーになるので削除しておく</span></div><div><span style="font-size: 10pt;">sns.distplot(df['Age'])</span></div><div><span style="font-size: 10pt;">sns.distplot(df['Age'], bins=10)  # bin指定できる</span></div><div><span style="font-size: 10pt;">sns.distplot(df['Age'], kde=False)  # kdeで確率密度の曲線ありなしを指定できる。デフォルトはあり</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">連続値の</span><span style="font-size: 10pt; font-weight: bold;">1変数又は2変数の分布をkde（確率密度）で可視化</span></div><div><span style="font-size: 10pt;">sns.kdeplot(df[df.columns[0]], df[df.columns[1]], shade=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornの散布図（</span><span style="font-size: 10pt; font-weight: bold;">連続値の2変数の相関</span><span style="font-size: 10pt; font-weight: bold;">）: sns.</span><span style="font-size: 10pt; font-weight: bold;">jointplot</span><span style="font-size: 10pt; font-weight: bold;">(x=df['col1'], y=df['col2'])</span></font></div><div><span style="font-size: 10pt;">sns.jointplot(x=df['Age'], y=df['Fare'])</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">sns.jointplot(data=df, x='Age', y='Fare')</span></div><div><span style="font-size: 10pt;">sns.jointplot(x=df['Age'], y=df['Fare'], kind='reg')  # kindで”reg”を指定した場合。線形回帰線が追加される。sns.regplot()とほぼ同じ</span></div><div><span style="font-size: 10pt;">sns.jointplot(x=df['Age'], y=df['Fare'], kind='kde')  #kindで”kde”を指定した場合。等高線になる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornで散布図</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">連続値の2変数の相関</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">+近似直線: sns.regplot(x=df['col1'], y=df['col2'])</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">※ デフォルトの信頼区間は95%:sns.regplot(, ci=95)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">seabornの</span><span style="font-size: 10pt; font-weight: bold;">散布図</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">連続値の2変数の相関</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">並べてplot</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">sns.set()</span></div><div><span style="font-size: 10pt;">fig = plt.figure(figsize=(14,9))</span></div><div><span style="font-size: 10pt;">for i in np.arange(len(df_list)):  # 3が最大</span></div><div><span style="font-size: 10pt;">    ax = fig.add_subplot(1,3,i+1)</span></div><div><span style="font-size: 10pt;">    df = df_list[i]</span></div><div><span style="font-size: 10pt;">    df = df[df['y_true'] != -1] # 欠損ラベル=-1.0 以外の行だけにす</span></div><div><span style="font-size: 10pt;">    sns.regplot(x=df['y_pred'], y=df['y_true'], ci=95) # 散布図 母平均が95%の確率でその範囲にある「95%信頼区間」付き</span></div><div><span style="font-size: 10pt;">#グラフを整えて表示</span></div><div><span style="font-size: 10pt;">plt.tight_layout()</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># データフレームカラムのヒストグラムと各カラム総当たり散布図</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">連続値の2変数の相関</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">: sns.pairplot(df)</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">※ 当たり前だが全て数値型のカラムでないとエラーになる</span></div><div><span style="font-size: 10pt; font-weight: bold;">※ 機械学習で各特徴量の関係を見るのに使える!!!!!!!</span></div><div><span style="font-size: 10pt;">sns.pairplot(df)</span></div><div><span style="font-size: 10pt;">sns.pairplot(iris,</span> <span style="font-size: 10pt; font-weight: bold;">hue</span><span style="font-size: 10pt;">=&quot;species&quot;)</span><span style="font-size: 10pt;-en-paragraph:true;"> </span><span style="font-size: 10pt;">  </span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;"># hueは目的変数で</span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;">種類ごとに</span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;">plot</span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;">点色分けする。</span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;">species</span><span style="font-size: 10pt; font-weight: bold;-en-paragraph:true;">列がカテゴリ変数の時</span></div><div><span style="font-size: 10pt;">sns.pairplot(df, hue='Survived', kind='scatter', plot_kws={'alpha':0.5})  # kindで総当たりするグラフの種類変えれる。kinf='scatter'はデフォルトの散布図</span></div><div><span style="font-size: 10pt;">sns.pairplot(df[['Age', 'Fare', 'Pclass', 'Survived']], hue='Survived', plot_kws={'alpha':0.5}) # 比較したいカラムだけ指定してpairplot</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornの折れ線グラフ</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">連続値の2変数の変化</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">: sns.lineplot(x=df['col1'], y=df['col2']) </span></font></div><div><span style="font-size: 10pt; font-weight: bold;">※ 当たり前だがx,yどちらも数値型でないとエラーになる</span></div><div><span style="font-size: 10pt;">plt.figure(figsize=(12, 6))</span></div><div><span style="font-size: 10pt;">sns.lineplot(x=df.index, y=df[&quot;Close&quot;])  # sns.lineplot(data=df, x=df.index, y=&quot;Close&quot;) でもいける</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornでカテゴリ列を集計した</span><span style="font-size: 10pt; font-weight: bold;">棒グラフ</span><span style="font-size: 10pt; font-weight: bold;">（離散</span><span style="font-size: 10pt; font-weight: bold;">値1変数の</span><span style="font-size: 10pt; font-weight: bold;">個数の分布 </span><span style="font-size: 10pt; font-weight: bold;">や 離散値vs離散値の個数の分布</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">作成: sns.countplot(df['col'])</span></font></div><div><span style="font-size: 10pt;">sns.countplot(df['age'])</span></div><div><span style="font-size: 10pt;">sns.countplot(data=df, x='age')</span></div><div><span style="font-size: 10pt;">sns.countplot(data=df, x='Sex', order=['man', 'woman'])  # orderで棒グラフの順番指定</span></div><div><span style="font-size: 10pt;">sns.countplot(data=df, x='Sex', hue='Survived')  #</span><span style="font-size: 10pt; font-weight: bold;"> </span><span style="font-size: 10pt;">hueは目的変数の指定。dfのSex列をSurvivedのカテゴリごとに集計してplot</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">sns.countplot(df['type']) # df.value_counts()と同じ感じ</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornで数値列の平均値の棒グラフ</span><span style="font-size: 10pt; font-weight: bold;">（離散</span><span style="font-size: 10pt; font-weight: bold;">値1変数の平均 や </span><span style="font-size: 10pt; font-weight: bold;">離散値vs離散値の平均</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">: sns.barplot(y=df['col'])</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">※ seabornではその列の平均からのエラーバーも描かれる</span></div><div><span style="font-size: 10pt;">sns.barplot(y=df['Age'])  # Age列の平均値の棒1本だけplot</span></div><div><span style="font-size: 10pt;">sns.barplot(x=df['Survived'], y=df['Age'])  # xをカテゴリ列、yを平均値見たい列にすることでカテゴリごとの平均値の棒グラフ出せる</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">sns.barplot(x='Survived', y='Age', data=df)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">sns.barplotで無理やりカウントプロットの</span><span style="font-size: 10pt; font-weight: bold;">棒グラフ</span><span style="font-size: 10pt; font-weight: bold;">（離散</span><span style="font-size: 10pt; font-weight: bold;">値1変数の</span><span style="font-size: 10pt; font-weight: bold;">個数の分布 </span><span style="font-size: 10pt; font-weight: bold;">や 離散値vs離散値の個数の分布</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">にする（sns.countplot(</span><span style="font-size: 10pt; font-weight: bold;">chars</span><span style="font-size: 10pt; font-weight: bold;">['char'])と同じこと）</span></div><div><span style="font-size: 10pt;">sns.set(style=&quot;whitegrid&quot;)</span></div><div><span style="font-size: 10pt;">plt.figure(figsize=(22,20))</span></div><div><span style="font-size: 10pt;">ax = sns.barplot(y=&quot;char&quot;, x=&quot;count&quot;, data=chars.sort_values(by=['count'], ascending=False).head(100))</span></div><div><span style="font-size: 10pt;">ax.set_title(&quot;Character frequency in images (top 100)&quot;)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornの箱ひげグラフ</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">1変数</span><span style="font-size: 10pt; font-weight: bold;">の分布 </span><span style="font-size: 10pt; font-weight: bold;">や </span><span style="font-size: 10pt; font-weight: bold;">離散</span><span style="font-size: 10pt; font-weight: bold;">値vs1変数の分布</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">: sns.boxplot(y=df['col'])</span></font></div><div><span style="font-size: 10pt;">sns.boxplot(x='Pclass', y='Age', data=df)</span></div><div><span style="font-size: 10pt;">sns.boxplot(data=df, y='Close') # y軸だけでもいける</span></div><div><span style="font-size: 10pt;">sns.boxplot(y=df['Close']) # y軸だけでもいける</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># </span><span style="font-size: 10pt; font-weight: bold;">seabornのバイオリンプロット</span><span style="font-size: 10pt; font-weight: bold;">（</span><span style="font-size: 10pt; font-weight: bold;">1変数</span><span style="font-size: 10pt; font-weight: bold;">の分布 </span><span style="font-size: 10pt; font-weight: bold;">や </span><span style="font-size: 10pt; font-weight: bold;">離散</span><span style="font-size: 10pt; font-weight: bold;">値vs1変数の分布</span><span style="font-size: 10pt; font-weight: bold;">）</span><span style="font-size: 10pt; font-weight: bold;">: sns.violinplot(y=df['col'])</span></div><div><span style="font-size: 10pt;">sns.violinplot(y=df_profit['Profit'])  # dataの指定なくてもいける</span></div><div><span style="font-size: 10pt;">sns.violinplot(data=df, y='Close') # y軸だけでもいける</span></div><div><span style="font-size: 10pt;">sns.violinplot(x='Pclass', y='Age', data=df)  # xをカテゴリ列、yをバイオリンプロットとして見たい列にすることでカテゴリごとのバイオリンプロット出せる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">seabornのバイオリンプロットの各plot点表示: sns.swarmplot(y=df['col'])</span></font></div><div><span style="font-size: 10pt;">sns.swarmplot(x='Pclass', y='Age', data=df, size=4)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">特定の列で集約して可視化として、</span><span style="font-size: 10pt; font-weight: bold;">バイオリンプロット作成（横幅が太い領域ほど、たくさんのサンプルがあるということを意味）</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">df = pd.read_csv(’../input/titanic/train.csv’)</span></div><div><span style="font-size: 10pt;">sns.violinplot(data=df, x='Survived', y='Fare')</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">## seabornによるboxplotとviolinplot の例 ##</span></div><div><span style="font-size: 10pt;"># データ作成</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">from sklearn.datasets import make_classification</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">x, y = make_classification(n_samples=1000, n_features=2, n_redundant=0, n_informative=2,n_clusters_per_class=2, n_classes=2)</span></div><div><span style="font-size: 10pt;">data = np.c_[np.c_[x, y], np.random.binomial(2, .5, len(x))]</span></div><div><span style="font-size: 10pt;">data = pd.DataFrame(data).rename(columns={0:'A', 1:'B', 2:'sex', 3:'types'})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># 箱ひげグラフ</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">sns.boxplot(x='types', y=&quot;A&quot;, hue='sex', data=data, palette=&quot;PRGn&quot;)</span></div><div><span style="font-size: 10pt;">sns.despine(offset=10, trim=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># unpivotする</span></div><div><span style="font-size: 10pt;">data_batch = pd.melt(data, id_vars = ['types', 'sex'], value_vars = data.columns[:-2].tolist())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># violinplot</span></div><div><span style="font-size: 10pt;">data_batch_A = data_batch[data_batch.variable=='A']</span></div><div><span style="font-size: 10pt;">sns.violinplot(x = 'types',  y = 'value', hue = 'sex', data = data_batch_A, split=True)</span></div><div><span style="font-size: 10pt;">sns.despine(offset=10, trim=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornでヒートマップでplot: sns.heatmap(df)</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">flights = sns.load_dataset('flights')</span></div><div><span style="font-size: 10pt;">flights_pivot = flights.pivot_table(index='month', columns='year', values='passengers')</span></div><div><span style="font-size: 10pt;">sns.heatmap(flights_pivot, cmap='coolwarm', annot=True) # annotで数値も表示する</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># seabornでヒートマップ+階層型クラスタリングによるデンドログラム（樹形図）: sns.</span><span style="font-size: 10pt; font-weight: bold;">clustermap(df.corr())</span></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">※</span><span style="font-size: 10pt; font-weight: bold;">相関関係等の可視化に非常に有効</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornで混同行列plot</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">from sklearn.metrics import confusion_matrix</span></div><div><span style="font-size: 10pt;">sns.heatmap(confusion_matrix(y_test, y_pred),</span></div><div><span style="font-size: 10pt;">            annot=True, fmt=&quot;d&quot;, cbar = False, cmap = plt.cm.Blues, vmax = X_test.shape[0]//16)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornで画素値のヒストグラムplot</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">sns.distplot(img.reshape(-1), kde=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># seabornでグラフ並べる(属性ごとに一気にグラフにする):sns.Facetgrid()</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">df_flights = sns.load_dataset('flights')</span></div><div><span style="font-size: 10pt; font-weight: bold;">grid = sns.FacetGrid(df_flights, col=&quot;year&quot;, hue=&quot;year&quot;, col_wrap=4, size=5)  # hueがあると色がきれいになる。col_wrap=4で4列グラフを並べる</span></div><div><span style="font-size: 10pt; font-weight: bold;">grid.map(sns.pointplot, 'month', 'passengers')  #</span> <span style="font-size: 10pt; font-weight: bold;">sns.distplotとかでもいける。</span><span style="font-size: 10pt; font-weight: bold;">month列が横軸、passengers列が縦軸になる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.factorplot：</span><span style="font-size: 10pt; font-weight: bold;">複数の離散変数（カテゴリ変数）と1つ以下の連続変数の分布を可視化するグラフ。violinplot等、かなりユニークなものが多い。引数のkindを与えることで複数のグラフが描ける。新しいseabornではsns.catplot()らしい #</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># sns.lineplot()っぽいグラフ</span></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, col='species') # デフォルトはlineplot:kind='point'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># sns.barplot(data=df, x='species', y='petal_length') と同じこと（x:離散値、y:連続値）</span></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', kind='bar')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.barplot(data=df, x='species', y='petal_length', hue='test') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値、hue:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', hue='test', kind='bar')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.countplot(data=df, x='species') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', kind='count')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.countplot(data=df, x='species', hue='test') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、hue:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', hue='test', kind='count')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.boxplot(data=df, x='species', y='petal_length') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', kind='box')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.boxplot(data=df, x='species', y='petal_length', hue='test') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値、hue:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', hue='test', kind='box')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.violinplot(data=df, x='species', y='petal_length') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', kind='violin')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.violinplot(data=df, x='species', y='petal_length', hue='test') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値、hue:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', hue='test', kind='violin')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.swarmplot(data=df, x='species', y='petal_length') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', kind='swarm')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sns.</span><span style="font-size: 10pt; font-weight: bold;">swarm</span><span style="font-size: 10pt; font-weight: bold;">plot(data=df, x='species', y='petal_length', hue='test') と同じこと</span><span style="font-size: 10pt; font-weight: bold;">（x:離散値、y:連続値、hue:離散値）</span></font></div><div><span style="font-size: 10pt;">sns.factorplot(data=df, x='species', y='petal_length', hue='test', kind='swarm')  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">  </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><hr/></div><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■plotly</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># plotlyとipywidgetsでヒストグラムのbin対話的に変える</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">from ipywidgets import interact, IntSlider, RadioButtons, Dropdown</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">import plotly.offline as offline</span></div><div><span style="font-size: 10pt;">import plotly.graph_objs as go</span></div><div><span style="font-size: 10pt;">offline.init_notebook_mode()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">bins = IntSlider(min=10, max=1000, step=1, value=0)</span></div><div><span style="font-size: 10pt;"># = RadioButtons(options=['1', '2', '3'])</span></div><div><span style="font-size: 10pt;">data_type = Dropdown(options=['1', '2', '3'])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">@interact(bins=bins, data_type=data_type)</span></div><div><span style="font-size: 10pt;">def plot_hist(bins, data_type):</span></div><div><span style="font-size: 10pt;">    # 平均 50, 標準偏差 10 の正規乱数を1,000件生成</span></div><div><span style="font-size: 10pt;">    np.random.seed(seed=32)</span></div><div><span style="font-size: 10pt;">    x = np.random.normal(50, int(data_type)*10, 1000)</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    # plotly Histogram</span></div><div><span style="font-size: 10pt;">    data = [go.Histogram(x=x, nbinsx=bins)]</span></div><div><span style="font-size: 10pt;">    offline.iplot(data, filename=data_type+'histogram')</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    # matplotlib Histogram</span></div><div><span style="font-size: 10pt;">    plt.hist(x, bins=bins)</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># plotlyで棒グラフplot。</span><span style="font-size: 10pt; font-weight: bold;">ipywidgetsでデータ対話的に変える</span></font></div><div><span style="font-size: 10pt;">def plotly_bar(x,y):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; plotlyで棒グラフplot &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    %matplotlib inline</span></div><div><span style="font-size: 10pt;">    import plotly.offline as offline</span></div><div><span style="font-size: 10pt;">    import plotly.graph_objs as go</span></div><div><span style="font-size: 10pt;">    offline.init_notebook_mode()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    data = [go.Bar(x=x, y=y)]</span></div><div><span style="font-size: 10pt;">    offline.iplot(data, filename='bar')</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">from ipywidgets import interact, IntSlider, RadioButtons, Dropdown</span></div><div><span style="font-size: 10pt;">#data_type = RadioButtons(options=['1', '2', '3'])</span></div><div><span style="font-size: 10pt;">data_type = Dropdown(options=['1', '2', '3'])</span></div><div><span style="font-size: 10pt;">@interact(data_type=data_type)</span></div><div><span style="font-size: 10pt;">def main(data_type):</span></div><div><span style="font-size: 10pt;">    if data_type == '1':</span></div><div><span style="font-size: 10pt;">        y = df_count_th1['count']</span></div><div><span style="font-size: 10pt;">        x = df_count_th1['class']</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    elif data_type == '2':</span></div><div><span style="font-size: 10pt;">        y = df_count_th2['count']</span></div><div><span style="font-size: 10pt;">        x = df_count_th2['class']</span></div><div><span style="font-size: 10pt;">        </span></div><div><span style="font-size: 10pt;">    elif data_type == '3':</span></div><div><span style="font-size: 10pt;">        y = df_count_th3['count']</span></div><div><span style="font-size: 10pt;">        x = df_count_th3['class']</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    plotly_bar(x,y)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># matplotkibやpandasのグラフをplotlyで表示(seabornは変換できない)</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt; font-weight: bold;">import plotly.offline</span></div><div><span style="font-size: 10pt; font-weight: bold;">plotly.offline.init_notebook_mode() # matplotlibのPlotly化</span></div><div><span style="font-size: 10pt;">fig = plt.figure(figsize=(10, 7))</span></div><div><span style="font-size: 10pt;">ax = fig.add_axes([0.1, 0.1, 0.9, 0.9])  # add_axes([0,0,1,1])等とするが、()の中の数字は順に、左下のx座標、左下のy座標、横の長さ、縦の長さを表す。その数字は0~1の範囲で、1はfigure領域の最大値を示している。</span></div><div><span style="font-size: 10pt;"># df.plot(ax=ax, marker=&quot;o&quot;, legend=False) # マーカーつけて凡例消す。pandasのplotの場合はdf.plot(ax=ax)</span></div><div><span style="font-size: 10pt;">ax.plot([0,1,2,3,4,5],[0,1,4,9,16,25])  # matplotlibのグラフの場合はax.plot</span></div><div><span style="font-size: 10pt;">ax.grid()</span></div><div><span style="font-size: 10pt; font-weight: bold;">plotly.offline.iplot_mpl(fig) # matplotlibのPlotly化</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><span style="font-size: 10pt;">↓でもいける。fig作って渡せば変換してくれる</span></div><div><span style="font-size: 10pt;">fig = plt.figure(figsize=(10, 7))</span></div><div><span style="font-size: 10pt;">plt.plot([0,1,2,3,4,5],[0,1,4,9,16,25])</span></div><div><span style="font-size: 10pt;">import plotly.offline</span></div><div><span style="font-size: 10pt;">plotly.offline.init_notebook_mode()</span></div><div><span style="font-size: 10pt;">plotly.offline.iplot_mpl(fig)  # matplotlibのPlotly化</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■A</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">ltair</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># インタラクティブな散布図と棒グラフの例</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">import altair as alt</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">df = sns.load_dataset('iris')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># selection_interval()関数を使用して区間選択</span></div><div><span style="font-size: 10pt;">brush = alt.selection_interval()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># 散布図</span></div><div><span style="font-size: 10pt;">points = alt.Chart(df).mark_point().encode(</span></div><div><span style="font-size: 10pt;">    x='sepal_length',</span></div><div><span style="font-size: 10pt;">    y='sepal_width',</span></div><div><span style="font-size: 10pt;">    color=alt.condition(brush, 'species', alt.value('lightgray'))  # 選択外の点の色をライトグレーにする</span></div><div><span style="font-size: 10pt;">).add_selection(brush)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># 棒グラフ</span></div><div><span style="font-size: 10pt;">bars = alt.Chart(df).mark_bar().encode(</span></div><div><span style="font-size: 10pt;">    x='sepal_length',</span></div><div><span style="font-size: 10pt;">    color='species'</span></div><div><span style="font-size: 10pt;">).transform_filter(brush)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># 棒グラフ</span></div><div><span style="font-size: 10pt;">bars2 = alt.Chart(df).mark_bar().encode(</span></div><div><span style="font-size: 10pt;">    x='sepal_width',</span></div><div><span style="font-size: 10pt;">    color='species'</span></div><div><span style="font-size: 10pt;">).transform_filter(brush)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># &amp;でつなげば対応付けしてくれる</span></div><div><span style="font-size: 10pt;">points &amp; bars &amp; bars2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■ディレクトリ/ファイル操作</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">ディレクトリ作成</span></font></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">os.makedirs(conf_out_dir, exist_ok=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイル/フォルダ/ディレクトリの存在確認</span></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">if os.path.exists('Python') == True:</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># ディレクトリ削除。中に</span><span style="font-size: 10pt; font-weight: bold;">ファイル存在しても削除する</span></font></div><div><span style="font-size: 10pt;">shutil.rmtree('./dir')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定ディレクトリの下位ファイルを全件移動</span></div><div><span style="font-size: 10pt;">after_paths = [shutil.move(p, after_dir) for p in glob.glob(before_dir+'/*')]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定ディレクトリのファイル/ディレクトリをリストで保持</span></div><div><span style="font-size: 10pt;">list1 = os.listdir('/tmp') # ['tmp.jpg', 'tmp.txt']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイルコピー. 第二引数がコピー先</span></div><div><span style="font-size: 10pt;">shutil.copy('./orig.txt', './copy.txt')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># ファイル削除</span></font></div><div><span style="font-size: 10pt;">os.remove('temp/file.txt')</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Numpy</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 乱数固定!!! Data augmentation の結果再現する時必要</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import random</span></div><div><span style="font-size: 10pt;">np.random.seed(7)</span></div><div><span style="font-size: 10pt;">random.seed(7)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayの要素を文字列に変換</span></div><div><span style="font-size: 10pt;">np.array([1, 2, 3], dtype=str)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># numpy空かどうか</span></div><div><span style="font-size: 10pt;">ys=np.array([])</span></div><div><span style="font-size: 10pt;">ys.shape == (0,) # True</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayの型変換</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">arr_int = arr.astype(np.int)</span></div><div><span style="font-size: 10pt;">arr_int = arr.astype(np.int32)</span></div><div><span style="font-size: 10pt;">arr_int = arr.astype(np.int64)</span></div><div><span style="font-size: 10pt;">arr_float = arr.astype(np.float)</span></div><div><span style="font-size: 10pt;">arr_float = arr.astype(np.float32)</span></div><div><span style="font-size: 10pt;">arr_float = arr.astype(np.float64)</span></div><div><span style="font-size: 10pt;">arr_str = arr.astype(np.str)</span></div><div><span style="font-size: 10pt;">arr_bool = arr.astype(np.bool)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 空の配列作成</span></font></div><div><span style="font-size: 10pt;">arr = np.empty((2, 3))  # 2</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">×3の２次元配列</span><span style="font-size: 10pt;">。初期値はfloat型の乱数</span></div><div><span style="font-size: 10pt;">arr = np.zeros((3,4)) # ３×４の２次元配列。初期値は0.0</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">共通要素を返す(積集合)</span></font></div><div><span style="font-size: 10pt;">a = np.array([9, 3, 4, 8, 4])</span></div><div><span style="font-size: 10pt;">b = np.array([0, 7, 3, 4, 0])</span></div><div><span style="font-size: 10pt;">print(np.intersect1d(a, b))  # [3 4]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 内積</span></div><div><span style="font-size: 10pt;">a.dot(b) or a@b(python3.5以上)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行列縦方向に連結</span></div><div><span style="font-size: 10pt;">np.r_[a, b]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行列横方向に連結</span></div><div><span style="font-size: 10pt;">np.c_[a, b]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行列の次元増やす</span></div><div><span style="font-size: 10pt;">a = a.reshape[a.shape[0], -1]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># NumPyの数え上げ(要素のカウント)</span></div><div><span style="font-size: 10pt;">a2 = np.array([0, 1, 2, 4 , 2, 4, 4])</span></div><div><span style="font-size: 10pt;"># np.uniqueは存在しない値をスルー</span></div><div><span style="font-size: 10pt;">u, c = np.unique(a2, return_counts=True)</span></div><div><span style="font-size: 10pt;">print(dict(zip(u, c)))</span></div><div><span style="font-size: 10pt;"># {0: 1, 1: 1, 2: 2, 4: 3}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># N次元配列を1次元配列に変換</span></div><div><span style="font-size: 10pt;">arr = arr.flatten()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># TrueかFalseの要素100個作る</span></div><div><span style="font-size: 10pt;">np.array(rand.uniform(0.0,1.0,100) &lt; 0.5)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 0.0か1.0の要素100個作る</span></div><div><span style="font-size: 10pt;">rand = np.random.RandomState(seed=71)</span></div><div><span style="font-size: 10pt;">np.array([1.0 if i &gt; 0.5 else 0.0 for i in rand.uniform(0.0,1.0,100)])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">0.0-1.0の要素等間隔に1000個作る。</span><span style="font-size: 10pt; font-weight: bold;">np.linspace:等間隔な数列を生成</span></div><div><span style="font-size: 10pt;">train_y_prob = np.linspace(0,1.0,1000)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 0.0-1.0の要素N個生成</span></div><div><span style="font-size: 10pt;">rand = np.random.RandomState(seed=71)</span></div><div><span style="font-size: 10pt;">train_pred_prob = np.clip(train_y_prob * np.exp(rand.standard_normal(train_y_prob.shape))*0.3, 0.0, 1.0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayに0あるか</span></div><div><span style="font-size: 10pt;">np.all(x) # x=np.array([1,2,3,4]) ならTrue, x=np.array([0,2,3,4]) ならFalse</span></div><div><span style="font-size: 10pt;">np.any(x) # x=np.array([1,2]) ならTrue, x=np.array([0,0]) ならFalse</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 欠損値(nan)を0.0に置換</span></div><div><span style="font-size: 10pt;">x = np.linspace(0,5,6)</span></div><div><span style="font-size: 10pt;">x[2] = np.nan  # array([ 0.,  1., nan,  3.,  4.,  5.])</span></div><div><span style="font-size: 10pt;">x =</span> <span style="font-size: 10pt; font-weight: bold;">np.nan_to_num</span><span style="font-size: 10pt;">(x, nan=0.0)  # #array([ 0.,  1., 0.,  3.,  4.,  5.])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># nan判定</span></div><div><span style="font-size: 10pt;">np.isnan(x) # x=np.array([1,np.nan,np.inf]) なら[ False True False]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># nanとinf判定</span></div><div><span style="font-size: 10pt;">np.isfinite(x) # x=np.array([1,np.nan,np.inf]) なら[ True False False]</span></div><div><span style="font-size: 10pt;">np.isinf(x) # x=np.array([1,np.nan,np.inf]) なら[ False False True]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 複素数、実数、スカラー判定</span></div><div><span style="font-size: 10pt;">x = np.array([1+1j, 1+0j, 4.5, 3, 2, 2j])</span></div><div><span style="font-size: 10pt;">np.iscomplex(x) # [ True False False False False True]</span></div><div><span style="font-size: 10pt;">np.isreal(x) # [False True True True True False]</span></div><div><span style="font-size: 10pt;">np.isscalar(3.1) # True</span></div><div><span style="font-size: 10pt;">np.isscalar([3.1]) # False</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 2つ(x,y)のarrayがほぼ同じ値か判定</span></div><div><span style="font-size: 10pt;">x = np.array([1e10,1e-7])</span></div><div><span style="font-size: 10pt;">y = np.array([1.00001e10,1e-8])</span></div><div><span style="font-size: 10pt;">print(np.allclose(x,y)) # False</span></div><div><span style="font-size: 10pt;">x = np.array([1e10,1e-8])</span></div><div><span style="font-size: 10pt;">y = np.array([1.00001e10,1e-9])</span></div><div><span style="font-size: 10pt;">print(np.allclose(x,y)) # True</span></div><div><span style="font-size: 10pt;">x = np.array([1.0, np.nan])</span></div><div><span style="font-size: 10pt;">y = np.array([1.0, np.nan])</span></div><div><span style="font-size: 10pt;">print(np.allclose(x,y, equal_nan = True))# True. np.nanはequal_nan = Trueが必要</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 2つ(x,y)のarrayの各要素同士比較</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">x = np.array([3, 5])</span></div><div><span style="font-size: 10pt;">y = np.array([2, 5])</span></div><div><span style="font-size: 10pt;">print(np.greater(x,y)) # &gt; [ True False]</span></div><div><span style="font-size: 10pt;">print(np.greater_equal(x,y)) # &gt;=  [ True True]</span></div><div><span style="font-size: 10pt;">print(np.less(x,y)) # &lt; [False False]</span></div><div><span style="font-size: 10pt;">print(np.less_equal(x,y)) # &lt;= [False True]</span></div><div><span style="font-size: 10pt;">if (x == y).all(): [False]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 全て0のarray作成</span></div><div><span style="font-size: 10pt;">np.zeros(10) # [0. 0. 0. 0. 0. 0. 0. 0. 0. 0.]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 全て1のarray作成</span></div><div><span style="font-size: 10pt;">print(np.ones(10)) # [1. 1. 1. 1. 1. 1. 1. 1. 1. 1.]</span></div><div><span style="font-size: 10pt;">print(np.ones(10)*5) # [5. 5. 5. 5. 5. 5. 5. 5. 5. 5.]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 30から70までの整数のarray作成</span></div><div><span style="font-size: 10pt;">np.arange(30,71) # [30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 0から70までの偶数のarray作成</span></div><div><span style="font-size: 10pt;">np.arange(0,71,2) # [ 0 2 4 6 8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48 50 52 54 56 58 60 62 64 66 68 70]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3×3単位行列作成</span></div><div><span style="font-size: 10pt;">np.array([[1,0,0],[0,1,0],[0,0,1]]))</span></div><div><span style="font-size: 10pt;">np.identity(3)</span></div><div><span style="font-size: 10pt;">np.eye(3) </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 正規乱数生成</span></div><div><span style="font-size: 10pt;">np.random.normal(0,1,1) # [-0.24839915]</span></div><div><span style="font-size: 10pt;">np.random.normal(0,1,3) # [-0.24839915 0.82790774 1.40854111]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 4以上10未満の3 x 3の配列の整数乱数</span></div><div><span style="font-size: 10pt;">arr = np.random.randint(4, 10, (3, 3))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">15〜55の範囲の値を持つarrayを作成し、最初と最後を除くすべての値を出力</span></font></div><div><span style="font-size: 10pt;">x = np.arange(15,55)</span></div><div><span style="font-size: 10pt;">x[1:-1]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3X4のarrayを作成</span></div><div><span style="font-size: 10pt;">x = np.arange(10,22).reshape(3,4)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayの行数、列数</span></div><div><span style="font-size: 10pt;">np.arange(10,22).reshape(3,4).shape # (3, 4)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># forでarrayの要素表示</span></div><div><span style="font-size: 10pt;">for i in np.nditer(x):</span></div><div><span style="font-size: 10pt;">    print(i)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 等間隔な数列生成</span></div><div><span style="font-size: 10pt;">x = np.arange(5,50+5,5) # [ 5 10 15 20 25 30 35 40 45 50]</span></div><div><span style="font-size: 10pt;">x = np.linspace(10,49,5) # [10. 19.75 29.5 39.25 49. ]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 0〜20の値を持つベクトルを作成し、9〜15の範囲の数値の符号を変更</span></div><div><span style="font-size: 10pt;">x = np.arange(0,20)</span></div><div><span style="font-size: 10pt;">x[(x &gt;= 9) &amp; (x &lt;= 15)] *= -1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 区間内のランダムな整数を返す</span></div><div><span style="font-size: 10pt;">x = np.random.randint(0,11,5) # [9 6 2 5 6]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># array同士掛け算</span></div><div><span style="font-size: 10pt;">x = np.array([1,2])</span></div><div><span style="font-size: 10pt;">y = np.array([2,4])</span></div><div><span style="font-size: 10pt;">x*y # [2 8]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 「::n」でn番目ごとに要素を得る</span></div><div><span style="font-size: 10pt;">x = np.zeros((4,4))</span></div><div><span style="font-size: 10pt;">x[::2, 1::2] = 1 # 0,2行目かつ1,3列の要素だけ1にする</span></div><div><span style="font-size: 10pt;">x[1::2, ::2] = 1 # 1,3行目かつ0,2列の要素だけ1にする</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 合計</span></div><div><span style="font-size: 10pt;">np.sum(x)</span></div><div><span style="font-size: 10pt;">np.sum(x,axis=0)# 列の合計</span></div><div><span style="font-size: 10pt;">np.sum(x,axis=1)# 行の合計</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 内積</span></div><div><span style="font-size: 10pt;">np.dot(x,y)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 既存の配列と同じ大きさのarray作成</span></div><div><span style="font-size: 10pt;">x = np.array([[2,3],[4,5]])</span></div><div><span style="font-size: 10pt;">r = np.empty_like(x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 行列の各行にベクトルを加える</span></div><div><span style="font-size: 10pt;">x = np.array([[2,3],[4,5]])</span></div><div><span style="font-size: 10pt;">y = np.array([1,0])</span></div><div><span style="font-size: 10pt;">r = np.empty_like(x)# 既存の配列と同じ大きさのarray作成</span></div><div><span style="font-size: 10pt;">for i in range(2):</span></div><div><span style="font-size: 10pt;">r[i,:] = x[i,:]+y</span></div><div><span style="font-size: 10pt;">print(r) # [[3 3] [5 5]]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># np横積み</span></div><div><span style="font-size: 10pt;">np.stack([arr1, arr2], axis=0) # array([1,8],[2,9])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># np縦積み</span></div><div><span style="font-size: 10pt;">np.stack([arr1, arr2], axis=1) </span></div><div><span style="font-size: 10pt;"># array([1,2],</span></div><div><span style="font-size: 10pt;">#           [8,9])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayをバイナリファイルに保存/ロード</span></div><div><span style="font-size: 10pt;">x = np.array([1,2])</span></div><div><span style="font-size: 10pt;">np.save('tmp_array.npy',x)</span></div><div><span style="font-size: 10pt;">x2 = np.load('tmp_array.npy')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayを圧縮形式（.npz形式）で1つのファイルに保存して読み込む</span></div><div><span style="font-size: 10pt;">x = np.arange(0,10).reshape(2,5)</span></div><div><span style="font-size: 10pt;">y = np.random.random((3,3))</span></div><div><span style="font-size: 10pt;">np.savez('tmp_array.npz', x = x, y = y)</span></div><div><span style="font-size: 10pt;">with np.load('tmp_array.npz') as d:</span></div><div><span style="font-size: 10pt;">    x2 = d['x']</span></div><div><span style="font-size: 10pt;">    y2 = d['y']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayをテキストファイルに保存して読み込む</span></div><div><span style="font-size: 10pt;">x = np.array([[2,5],[6,9]])</span></div><div><span style="font-size: 10pt;">header = 'col1 col2'</span></div><div><span style="font-size: 10pt;">np.savetxt('tmp_array.txt', x, fmt=&quot;%d&quot;, header=header)# fmtは表示桁指定</span></div><div><span style="font-size: 10pt;">print(np.loadtxt('tmp_array.txt'))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayを文字列に変換し、配列としてロード</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">x = np.array([1,2,3])</span></div><div><span style="font-size: 10pt;">x_byte = x.tostring()</span></div><div><span style="font-size: 10pt;">x2 = np.fromstring(x_byte, dtype = x.dtype)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 画像→numpy</span></div><div><span style="font-size: 10pt;">from PIL import Image</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">im = np.array(Image.open('cat.jpg'))</span></div><div><span style="font-size: 10pt;">im = np.array(Image.open('cat.jpg').convert('L')) # グレースケール画像に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># numpy画像保存</span></div><div><span style="font-size: 10pt;">from PIL import Image</span></div><div><span style="font-size: 10pt;"># imageを3次元のnumpyとする</span></div><div><span style="font-size: 10pt;">image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)  # opencvでロードした場合はRGBに変換必要</span></div><div><span style="font-size: 10pt;">pil_img = Image.fromarray(image.astype(np.uint8))</span></div><div><span style="font-size: 10pt;">pil_img.save(os.path.join(args['output_dir'], pathlib.Path(image).stem + '_blur.png'))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># One-hotベクトルを整数値のベクトルにnumpyでデコード</span></div><div><span style="font-size: 10pt;">y = np.array([[1,0,0],[0,1,0],[0,0,1]])</span></div><div><span style="font-size: 10pt;">np.argmax(y, axis=1) # [0,1,2]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># arrayの次元数</span></div><div><span style="font-size: 10pt;">np.arange(3).ndim # 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># numpyの一致</span><span style="font-size: 10pt; font-weight: bold;">（配列全体の一致を調べる場合は.all()）</span></font></div><div><span style="font-size: 10pt;">test_data = np.array([1,2,3])</span></div><div><span style="font-size: 10pt;">actual = np.array([1,2,3])</span></div><div><span style="font-size: 10pt;">print(test_data == actual)</span></div><div><span style="font-size: 10pt;"># [out] &gt;&gt; [True, True, True]</span></div><div><span style="font-size: 10pt;">print((test_data == actual).all())</span></div><div><span style="font-size: 10pt;"># [out] &gt;&gt; True</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 対数とる</span></div><div><span style="font-size: 10pt;">x = np.log(np.array([1.0,10.0]))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 1加えた後対数とる(log(x+1))</span></div><div><span style="font-size: 10pt;">x = np.log1p(np.array([1.0,10.0]))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 絶対値の対数とる(log(|x|))</span></div><div><span style="font-size: 10pt;">x = np.array([1.0,10.0])</span></div><div><span style="font-size: 10pt;">x = np.sign(x) * np.log(np.abs(x))  </span><span style="font-size: 10pt; font-weight: bold;"># 絶対値の対数をとってから元の符号を付加する</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 次元増やす</span></font></div><div><span style="font-size: 10pt;">x = np.random.rand(10)</span></div><div><span style="font-size: 10pt;">np.expand_dims(x, axis=0).shape  # (1, 10)</span></div><div><span style="font-size: 10pt;">x[:, None].shape # (10, 1)</span></div><div><span style="font-size: 10pt;">x[None, :].shape # (1, 10)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3次元のnumpyを10件ランダムサンプリング</span></div><div><span style="font-size: 10pt;">arr[np.random.randint(arr.shape[0], size=10:, :]</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■List</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストに含まれているか</span></div><div><span style="font-size: 10pt;">&quot;B&quot; in ['A', 'B']</span></div><div><span style="font-size: 10pt;">&quot;B&quot; not in ['A', 'B']  # 含まれていないかの判定はnot in</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># リストを検索（部分一致）</span></font></div><div><span style="font-size: 10pt;">l_in = [s for s in json_load if 'http' in s]</span></div><div><span style="font-size: 10pt;"><br/></span></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト完全一致</span></div><div><span style="font-size: 10pt;">[&quot;sss&quot;, &quot;DDD&quot;] == [&quot;sss&quot;, &quot;DDD&quot;]  # True</span></div><div><span style="font-size: 10pt;">[&quot;sss&quot;, &quot;DDD&quot;] == [&quot;sss&quot;, &quot;aaa&quot;]  # False</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストの要素に差あるか(差集合)</span></div><div><span style="font-size: 10pt;">set(list1) - set(list2)  # 同じなら set(), 違うなら違う要素だけ出す</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># リストから要素削除</span></font></div><div><span style="font-size: 10pt;">cols = df.columns.to_list()</span></div><div><span style="font-size: 10pt;">cols.remove('AAA')  # リスト内の AAA 削除。イコールなしで消される</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">リストからランダムで要素が一つ選択</span></font></div><div><span style="font-size: 10pt;">import random</span></div><div><span style="font-size: 10pt;">print(random.choice([0, 1, 2, 3, 4]))  # 0</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 区切り文字指定してリストの要素をまとめる</span></div><div><span style="font-size: 10pt;">x = ','.join(list_x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストの中身を文字列に変換（リスト→文字）</span></div><div><span style="font-size: 10pt;">hidden_sizes = [10, 23]</span></div><div><span style="font-size: 10pt;">hidden_sizes = map(str, hidden_sizes) # 格納される数値を文字列にする</span></div><div><span style="font-size: 10pt;">hidden_sizes = ', '.join(hidden_sizes) # &quot;10, 23&quot;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストを別変数にコピー</span></div><div><span style="font-size: 10pt;">m = l[:] # m = l は参照コピー</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">同じ値の要素繰り返してリスト作成</span></font></div><div><span style="font-size: 10pt;">lst = [1 for i in range(3)]</span></div><div><span style="font-size: 10pt;">lst = [1] * 3</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト1次元化</span></div><div><span style="font-size: 10pt;">list = [[1, 3, 5], [2, 4]]</span></div><div><span style="font-size: 10pt;">[flatten for inner in list for flatten in inner] # [1, 3, 5, 2, 4]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストの-1の要素をnp.nanに変換</span></div><div><span style="font-size: 10pt;">label_list = [np.nan if y == -1 else y for y in label_list]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストからnan削除</span></div><div><span style="font-size: 10pt;">l_unique = [x for x in l_unique if str(x) != 'nan']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト同士をマージする</span></div><div><span style="font-size: 10pt;">li1 = [1,2]</span></div><div><span style="font-size: 10pt;">lis = [3,4]</span></div><div><span style="font-size: 10pt;">li = [*li1, *li2]</span></div><div><span style="font-size: 10pt;"># [1,2,3,4]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト内でのインデックス検索</span></div><div><span style="font-size: 10pt;">[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;].index(“B”) # 1が出力</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 元のリストを逆順に並べ替え（</span><span style="font-size: 10pt; font-weight: bold;">org_list自体が変更され、</span><span style="font-size: 10pt; font-weight: bold;">返り値はNoneなので注意）</span></font></div><div><span style="font-size: 10pt;">org_list.reverse() # [1, 2, 3, 4, 5]→[5, 4, 3, 2, 1]</span></div><div><span style="font-size: 10pt;">li[::-1]# リストの順番逆にする</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">リストの各要素のデータ型を変換</span></font></div><div><span style="font-size: 10pt;">list(map(str, _list)) # str型に変換</span></div><div><span style="font-size: 10pt;">list(map(int, _list)) # int型に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストの[]を含めてprint</span></div><div><span style="font-size: 10pt;">print(str([1,2,3])) # &quot;[1,2,3]&quot;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストのすべての要素が同じかどうかを確認</span></div><div><span style="font-size: 10pt;">len(set(mylist)) == 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># setでリストの要素一意にする</span></div><div><span style="font-size: 10pt;">image_id = sorted(set(image_id), key=image_id.index)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト降順ソート</span></div><div><span style="font-size: 10pt;">sorted(y_list*len(pre_list), reverse=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># set型なら集合演算できる</span></div><div><span style="font-size: 10pt;">a = {1, 2, 3}</span></div><div><span style="font-size: 10pt;">b = {2, 3, 4}</span></div><div><span style="font-size: 10pt;">a &amp; b</span> <span style="font-size: 10pt; font-weight: bold;"># 積集合</span></div><div><span style="font-size: 10pt;"># {2, 3}</span></div><div><span style="font-size: 10pt;">a | b</span> <span style="font-size: 10pt; font-weight: bold;"># 和集合</span></div><div><span style="font-size: 10pt;"># {1, 2, 3, 4}</span></div><div><span style="font-size: 10pt;">a - b</span> <span style="font-size: 10pt; font-weight: bold;"># 集合同士の演算</span></div><div><span style="font-size: 10pt;"># 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># setで部分集合か判定</span></div><div><span style="font-size: 10pt;">s1 = {0, 1}</span></div><div><span style="font-size: 10pt;">s2 = {0, 1, 2, 3}</span></div><div><span style="font-size: 10pt;">print(s1 &lt;= s2)</span></div><div><span style="font-size: 10pt;"># True</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># リストの一致（</span><span style="font-size: 10pt; font-weight: bold;">'==' や '!=' を使って比較</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">test_data = [[1,2,3],[4,5,6]]</span></div><div><span style="font-size: 10pt;">test_data1 = [[0,2,3],[4,5,6]]</span></div><div><span style="font-size: 10pt;">actual = [[1,2,3],[4,5,6]]</span></div><div><span style="font-size: 10pt;">print(test_data == actual)</span></div><div><span style="font-size: 10pt;"># [out] &gt;&gt; True</span></div><div><span style="font-size: 10pt;">print(test_data1 == actual)</span></div><div><span style="font-size: 10pt;"># [out] &gt;&gt; False</span></div><div><span style="font-size: 10pt;">if set(df.columns) == set(['決算期', '売上高', '営業益', '経常益', '最終益', '修正1株益', '売上営業損益率', '発表日'])  # setにしてから比較</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストや辞書に関数を適用する場合はmap()</span></div><div><span style="font-size: 10pt; font-weight: bold;"># リストのデータを2乗する</span></div><div><span style="font-size: 10pt;">nums = [1, 2, 3, 4, 5]</span></div><div><span style="font-size: 10pt;">def square_num(x):</span></div><div><span style="font-size: 10pt;">    return x**2 # リスト内の数値を2乗</span></div><div><span style="font-size: 10pt;">x = map(square_num, nums)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">x = [x**2 for x in nums]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リストの要素がTrueのデータだけ取る場合はfilter().filter()はmap()のif版</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 偶数のデータだけ取る</span></div><div><span style="font-size: 10pt;">nums = [1, 2, 3, 4, 5]</span></div><div><span style="font-size: 10pt;">def even(x):</span></div><div><span style="font-size: 10pt;">    return x % 2 == 0 # 余り0かで偶数判定</span></div><div><span style="font-size: 10pt;">x = map(even, nums)</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">x = [x for x in nums　if x % 2 == 0]</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Jupyter Notebook</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># マジックコマンド一覧表示</span></div><div><span style="font-size: 10pt;">%lsmagic</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterでカレントディレクトリ表示</span></div><div><span style="font-size: 10pt;">!pwd</span></div><div><span style="font-size: 10pt;">import sys</span></div><div><span style="font-size: 10pt;">sys.executable # pythonのpath表示</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterlabでコードを自動補完</span></div><div><span style="font-size: 10pt;">%config IPCompleter.greedy=True </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterでbashつかう</span></div><div><span style="font-size: 10pt;">%%bash</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyter内でtensorboard起動（tensorflow2.0以上である必要がありそう）。指定portにtensorboar起動する。本来はnoteboo内kにtensorboardが表示されるはずだができなかった。</span></div><div><span style="font-size: 10pt;">%load_ext tensorboard</span></div><div><span style="font-size: 10pt;">%tensorboard --logdir /runs --port 6055</span></div><div><a href="https://towardsdatascience.com/jupyter-notebooks-tips-and-tricks-4e995e7b1fd0" style="font-size: 10pt;">https://towardsdatascience.com/jupyter-notebooks-tips-and-tricks-4e995e7b1fd0</a></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pythonモジュール実行</span></div><div><span style="font-size: 10pt;">%run tmp.py</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">%%bash</span></div><div><span style="font-size: 10pt;">python tmp.py</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># notebook内でグラフ描画</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;"># %matplotlib notebook # 3次元グラフ書く場合とかはこっち</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterでグラフ高解像度で表示</span></div><div><span style="font-size: 10pt;">%config InlineBackend.figure_formats = {'png', 'retina'}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">jupyter </span><span style="font-size: 10pt; font-weight: bold;">notebook内で</span><span style="font-size: 10pt; font-weight: bold;">importしているモジュールを自動でリロード</span></div><div><span style="font-size: 10pt;">%reload_ext autoreload</span></div><div><span style="font-size: 10pt;">%autoreload 2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Jupyter のセル幅広げる</span></div><div><span style="font-size: 10pt;">from IPython.core.display import display, HTML</span></div><div><span style="font-size: 10pt;">display(HTML(&quot;&lt;style&gt;.container { width:96% !important; }&lt;/style&gt;&quot;))# デフォルトは75%</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># notebook版のtqdm</span></div><div><span style="font-size: 10pt;">#from tqdm import tqdm_notebook as tqdm # notebook以外でtqdm使う場合は from tqdm import tqdm</span></div><div><span style="font-size: 10pt;">from tqdm.notebook import tqdm # tqdmのバージョンが5以上の場合はこっち</span></div><div><span style="font-size: 10pt;">for i in tqdm(range(1000)):</span></div><div><span style="font-size: 10pt;">    i * i - i</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyter notebook で画像を貼り付け</span></div><div><span style="font-size: 10pt;">* マークダウンで以下のコマンド入れる  </span></div><div><span style="font-size: 10pt;">&lt;img src=”p5.png”&gt;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 画像表示</span></font></div><div><span style="font-size: 10pt;">from PIL import Image</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">im = Image.open(&quot;./achan.jpg&quot;)</span></div><div><span style="font-size: 10pt;">im_list = np.asarray(im)</span></div><div><span style="font-size: 10pt;">plt.imshow(im_list)</span></div><div><span style="font-size: 10pt;">plt.show()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># エラー出たセルの後で、%debug 実行するとデバックモード起動</span></div><div><span style="font-size: 10pt;">* p &lt;変数名&gt; で変数の中身確認</span></div><div><span style="font-size: 10pt;">* q で終了</span></div><div><span style="font-size: 10pt;">%debug</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 新たにカーネル追加</span></div><div><span style="font-size: 10pt;">envs/&lt;仮想環境名&gt;/share/jupyter/kernels/python3/ に追加したいカーネルの .json ファイルを作成すればいい</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Jupyter のプロントをpowershelに変更する</span></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">os.environ['comspec']='powershell.exe'</span></div><div><span style="font-size: 10pt;">!Get-Process</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 入力セルの表示/非表示を切り替えるjavascriptのボタン</span></div><div><span style="font-size: 10pt;">#</span> <a href="https://qiita.com/simonritchie/items/d7dccb798f0b9c8b1ec5" style="font-size: 10pt;">https://qiita.com/simonritchie/items/d7dccb798f0b9c8b1ec5</a></div><div><span style="font-size: 10pt;">from IPython.display import HTML</span></div><div><span style="font-size: 10pt;">HTML(&quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">&lt;button id=&quot;code-show-switch-btn&quot;&gt;スクリプトを非表示にする&lt;/button&gt;</span></div><div><span style="font-size: 10pt;">&lt;script&gt;</span></div><div><span style="font-size: 10pt;">var code_show = true;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">function switch_display_setting() {</span></div><div><span style="font-size: 10pt;">    var switch_btn = $(&quot;#code-show-switch-btn&quot;);</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    if (code_show) {</span></div><div><span style="font-size: 10pt;">        $(&quot;div.input&quot;).hide();</span></div><div><span style="font-size: 10pt;">        code_show = false;</span></div><div><span style="font-size: 10pt;">        switch_btn.text(&quot;スクリプトを表示する&quot;);</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    }else {</span></div><div><span style="font-size: 10pt;">        $(&quot;div.input&quot;).show();</span></div><div><span style="font-size: 10pt;">        code_show = true;</span></div><div><span style="font-size: 10pt;">        switch_btn.text(&quot;スクリプトを非表示にする&quot;);</span></div><div><span style="font-size: 10pt;">    }</span></div><div><span style="font-size: 10pt;">}</span></div><div><span style="font-size: 10pt;">$(&quot;#code-show-switch-btn&quot;).click(switch_display_setting);</span></div><div><span style="font-size: 10pt;">&lt;/script&gt;</span></div><div><span style="font-size: 10pt;">&quot;&quot;&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ipywidgetsでインタラクティブに画像表示</span></div><div><span style="font-size: 10pt;">#</span> <a href="https://github.com/pfnet-research/chainer-chemistry/blob/master/examples/tox21/tox21_dataset_exploration.ipynb" style="font-size: 10pt;">https://github.com/pfnet-research/chainer-chemistry/blob/master/examples/tox21/tox21_dataset_exploration.ipynb</a></div><div><span style="font-size: 10pt;">def ipywidgets_show_img(img_path_list):</span></div><div><span style="font-size: 10pt;">    %matplotlib inline</span></div><div><span style="font-size: 10pt;">    from ipywidgets import interact</span></div><div><span style="font-size: 10pt;">    import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">    from PIL import Image</span></div><div><span style="font-size: 10pt;">    import numpy as np</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def view_image(index):</span></div><div><span style="font-size: 10pt;">        img_path = img_path_list[index]</span></div><div><span style="font-size: 10pt;">        print('index={}, img_path={}'.format(index, img_path))</span></div><div><span style="font-size: 10pt;">        img = Image.open(img_path)</span></div><div><span style="font-size: 10pt;">        img_array = np.asarray(img)</span></div><div><span style="font-size: 10pt;">        plt.figure(figsize=(9, 9))</span></div><div><span style="font-size: 10pt;">        plt.imshow(img_array)</span></div><div><span style="font-size: 10pt;">        #if is_grayscale == True:</span></div><div><span style="font-size: 10pt;">        #    plt.gray()</span></div><div><span style="font-size: 10pt;">        plt.show()</span></div><div><span style="font-size: 10pt;">    interact(view_image, index=(0, len(img_path_list) - 1))</span></div><div><span style="font-size: 10pt;">import glob</span></div><div><span style="font-size: 10pt;">img_path_list = glob.glob(r'D:\iPhone_pictures\2018-06\*JPG')</span></div><div><span style="font-size: 10pt;">print(len(img_path_list))</span></div><div><span style="font-size: 10pt;">print(img_path_list[201])</span></div><div><span style="font-size: 10pt;">ipywidgets_show_img(img_path_list)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterの設定ファイル作成</span></div><div><span style="font-size: 10pt;">$ ipython profile create</span></div><div><span style="font-size: 10pt;">→/Users/&lt;your_profile&gt;/.ipython\\profile_default に</span></div><div><span style="font-size: 10pt;">　ipython_config.py,</span></div><div><span style="font-size: 10pt;">　 ipython_kernel_config.py</span></div><div><span style="font-size: 10pt;">　ができる。</span></div><div><span style="font-size: 10pt;">　おそらく</span><span style="font-size: 10pt; color: rgb(0, 0, 0); line-height: 20px;">$ jupyter notebook --generate-config でできる</span><span style="font-size: 10pt; color: rgb(0, 0, 0); line-height: 20px;">jupyter_notebook_config.py とおなじもの</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; color: rgb(0, 0, 0); font-weight: bold; line-height: 20px;">jupyter_notebook_config.py</span><span style="font-size: 10pt; font-weight: bold;">はデフォルトでマジックコマンドとか入れれる。</span><span style="font-size: 10pt; font-weight: bold; line-height: 20px;">jupyter_notebook_config.pyは反映されるが</span><span style="font-size: 10pt; font-weight: bold;">ipython_config.pyはうまくいかず。。。</span></div><div><span style="font-size: 10pt;">c = get_config() # これはいらんかも</span></div><div><span style="font-size: 10pt;">c.IPKernelApp.pylab = 'inline' # 常に %matplotlib inline</span></div><div><span style="font-size: 10pt;">c.InteractiveShellApp.exec_lines = ['%autoreload 2'] # %reload_ext autoreload</span></div><div><span style="font-size: 10pt;">c.InteractiveShellApp.extensions = ['autoreload'] # %autoreload 2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">c.NotebookApp.ip = '*' # 誰でもログインするokに</span></div><div><span style="font-size: 10pt;">c.NotebookApp.open_browser = False #</span></div><div><span style="font-size: 10pt;">c.NotebookApp.port = 6053 # 開けたポート番号</span></div><div><span style="font-size: 10pt;">c.NotebookApp.iopub_data_rate_limit = 100000000 # 出力データの上限サイズを上げる</span> <a href="https://github.com/jupyterhub/jupyterhub/issues/1152" style="font-size: 10pt;">https://github.com/jupyterhub/jupyterhub/issues/1152</a></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■jupyterthemes</span></div><div><span style="font-size: 10pt;">jupyterthemes: jupyterのフォントとか変えれるパッケージ</span></div><div><span style="font-size: 10pt;">condaからインストールできる</span></div><div><span style="font-size: 10pt;">$ conda install -c conda-forge jupyterthemes</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">インストール後customフォルダを自分で作らないと使えない</span></div><div><span style="font-size: 10pt;">jupyterthemes のコマンドをコマンドラインで叩くことでcustomフォルダにcustom.cssとか作られる</span></div><div><span style="font-size: 10pt;">C:\Users\shingo\.jupyter\custom\custom.css</span></div><div><span style="font-size: 10pt;">できた後jupyter起動するとみばえが変わってる</span></div><div><span style="font-size: 10pt; font-weight: bold;">注:クロームのキャッシュが残ってるとcssが反映されない。css変更したらキャッシュ消すこと</span></div><div><span style="font-size: 10pt; font-weight: bold;">クロームのキャッシュ削除は「履歴」→「閲覧履歴データの削除」→「キャッシュされた画像とファイル」にチェック入れてデータ削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">jupyterthemes はjupyterをダークテーマとかにもできる。見にくいからおすすめしないが</span></div><div><span style="font-size: 10pt;">以下、jupyterthemesのコマンド</span></div><div><span style="font-size: 10pt;">参考:</span></div><div><a href="https://github.com/dunovank/jupyter-themes" style="font-size: 10pt;">https://github.com/dunovank/jupyter-themes</a></div><div><a href="https://qiita.com/koikoi_jam/items/29d9ef4e16a42038325c" style="font-size: 10pt;">https://qiita.com/koikoi_jam/items/29d9ef4e16a42038325c</a></div><div><a href="https://www.pynote.info/entry/jupyter-themes" style="font-size: 10pt;">https://www.pynote.info/entry/jupyter-themes</a></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">デフォルトに戻す</span><span style="font-size: 10pt; font-weight: bold;">（jupyterthemesの設定をすべて消す）</span></div><div><span style="font-size: 10pt;">$ jt -r # テーマをデフォルトに戻す</span></div><div><span style="font-size: 10pt;">$ jt -dfonts # フォントをすべてデフォルトに戻す</span></div><div><span style="font-size: 10pt;">$ jupyter notebook</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># -t:テーマはmonokai(ダークテーマっぽいの)、-tfs:マークダウンのフォントサイズは9、-nfs:ツールバーのフォントサイズは9、-lineh:1行の高さは120%、-cellw:セル幅は130%、-T:ツールバーを表示</span></div><div><span style="font-size: 10pt;">$ jt -t monokai -tfs 9 -nfs 9 -lineh 120 -cellw 130% -T</span></div><div><span style="font-size: 10pt;">$ jupyter notebook</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># おすすめ設定。-t:テーマはgrade3(ライトテーマっぽいの)、-f:Code Fontはhack、コード,マークダウン,</span><span style="font-size: 10pt; font-weight: bold;">ツールバー,</span><span style="font-size: 10pt; font-weight: bold;">出力のフォントサイズ全て9、-cellw:セル幅は90%、-T:ツールバーを表示、-N:notebook名表示 -kl:カーネルのロゴ表示</span></font></div><div><span style="font-size: 10pt;">$ jt -t grade3 -f hack -fs 9 -nfs 12 -tfs 9 -ofs 9 -cellw 90% -T -N -kl</span></div><div><span style="font-size: 10pt;">$ jupyter notebook</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># フォントサイズだけ変える</span><span style="font-size: 10pt; font-weight: bold;">custom.css</span><span style="font-size: 10pt; font-weight: bold;">（テーマ無いほうが慣れてて見やすい場合）</span></font></div><div><span style="font-size: 10pt;"># jupyterthemesでフォント変更</span></div><div><span style="font-size: 10pt;">#</span> <a href="https://qiita.com/uratatsu/items/cdc83308ce85a32d0512" style="font-size: 10pt;">https://qiita.com/uratatsu/items/cdc83308ce85a32d0512</a></div><div><span style="font-size: 10pt;"># ソースコードセル</span></div><div><span style="font-size: 10pt;">div.CodeMirror,</span></div><div><span style="font-size: 10pt;">div.CodeMirror pre {</span></div><div><span style="font-size: 10pt;">font-family: &quot;Ricty Diminished&quot;;</span></div><div><span style="font-size: 10pt;">font-size: 9pt;</span></div><div><span style="font-size: 10pt;">}</span></div><div><span style="font-size: 10pt;"># 結果出力セル</span></div><div><span style="font-size: 10pt;">div.output_subarea.output_text.output_stream.output_stdout,</span></div><div><span style="font-size: 10pt;">div.output_subarea.output_text {</span></div><div><span style="font-size: 10pt;">font-family: &quot;Ricty Diminished&quot;;</span></div><div><span style="font-size: 10pt;">font-size: 9pt;</span></div><div><span style="font-size: 10pt;">}</span></div><div><span style="font-size: 10pt;">div.output_area pre {</span></div><div><span style="font-size: 10pt;">font-family: &quot;Ricty Diminished&quot;;</span></div><div><span style="font-size: 10pt;">font-size: 9pt;</span></div><div><span style="font-size: 10pt;">}</span></div><div><span style="font-size: 10pt;"># テキスト、MarkDownセル</span></div><div><span style="font-size: 10pt;">div.text_cell,</span></div><div><span style="font-size: 10pt;">div.text_cell_render pre,</span></div><div><span style="font-size: 10pt;">div.text_cell_render {</span></div><div><span style="font-size: 10pt;">font-family: &quot;Ricty Diminished&quot;;</span></div><div><span style="font-size: 10pt;">font-size: 9pt;</span></div><div><span style="font-size: 10pt;">}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; text-decoration: underline;">■</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">リスト内表記</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ラムダ式（その場限りの関数）</span></div><div style="z-index: 200; position: relative;"><span style="z-index: 200; position: relative;"><span style="font-size: 10pt;">list(map(lambda x: x * 2, range(1,5)))</span></span></div><div style="z-index: 200; position: relative;"><div><font style="font-size: 10pt;"><br/></font></div></div><div style="z-index: 200; position: relative;"><span style="z-index: 200; position: relative;"><span style="font-size: 10pt; font-weight: bold;"># リスト内表記（ラムダ式と同じ結果出す。リスト内表記の方が短くて済むからこっちを使うべき）</span></span></div><div><span style="font-size: 10pt;">print([random.randint(0, 10) for i in range(5)])</span></div><div style="z-index: 200; position: relative;"><span style="z-index: 200; position: relative;"><span style="font-size: 10pt;"># [8, 5, 7, 10, 7]</span></span></div><div style="z-index: 200; position: relative;"><span style="z-index: 200; position: relative;"><span style="font-size: 10pt;">[x*2 for i in range(10) if i % 2 == 0]</span></span></div><div><span style="font-size: 10pt;"># [0, 4, 8, 12, 16]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 辞書型のリスト内表記</span></div><div><span style="font-size: 10pt;">dict = {num: num*2 for num in range(100)} </span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ジェネレータ型のリスト内表記</span></div><div><span style="font-size: 10pt;">gen = (x**2 for i in range(10) if i % 2 == 0)</span></div><div><span style="font-size: 10pt;">for g in gen:</span></div><div><span style="font-size: 10pt;">    print(g)</span></div><div><span style="font-size: 10pt;"># 0, 4, 16, 36, 64</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト内包表記でif文</span></div><div><span style="font-size: 10pt;">even_list = [i for i in range(10) if i % 2 == 0]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># if elseを使うリスト内表記</span></div><div><span style="font-size: 10pt;">xx = [&quot;even&quot; if i%2==0 else &quot;odd&quot; for i in range(10)]# ['even', 'odd', 'even', 'odd', 'even', 'odd', 'even', 'odd', 'even', 'odd']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># zipを使うリスト内表記</span></div><div><span style="font-size: 10pt;">xx = [i+j for i,j in zip(mylist_i,mylist_j)] # (0,0),(1,1),(2,2),...と並べる。</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ifを使う場合は絶対改行する</span></div><div><span style="font-size: 10pt;">xx = [&quot;even&quot; if i % 2 == 0 else &quot;odd&quot; \</span></div><div><span style="font-size: 10pt;">    for i in range(10)]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 表現が長くなるなら、長くなる所で改行を入れる</span></div><div><span style="font-size: 10pt;">zz = [np.sin(xx) + np.random.rand(xx.shape) \</span></div><div><span style="font-size: 10pt;">    for xx in list_xx]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■文字列操作</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">（区切り文字指定して）</span><span style="font-size: 10pt; font-weight: bold;">文字列分割</span></div><div><span style="font-size: 10pt;">c.split(&quot;_&quot;)[1]</span></div><div><span style="font-size: 10pt;">print('one,two,three,four,five'.split(',')) # ['one', 'two', 'three', 'four', 'five']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># </span><span style="font-size: 10pt; font-weight: bold;">文字列置換</span></div><div><span style="font-size: 10pt;">c.replace('&lt;=', '')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 列の値置換は辞書型で置換するペア用意しておくとよい</span></div><div><span style="font-size: 10pt;">variants = {'Cat':0, 'Dog':1}</span></div><div><span style="font-size: 10pt;">df['class'] = df['class'].replace(variants)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 文字列の</span><span style="font-size: 10pt; font-weight: bold;">先頭と末尾に含まれるタブや改行空白文字削除</span></font></div><div><span style="font-size: 10pt;">str.strip()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 小文字化</span></div><div><span style="font-size: 10pt;">&quot;DDD&quot;.lower() # ddd</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 大文字化</span></div><div><span style="font-size: 10pt;">&quot;ddd&quot;.upper() # DDD</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 文字列を改行コードで分割</span></div><div><span style="font-size: 10pt;">'a\nb'.splitlines() # ['a', 'b']</span></div><div><span style="font-size: 10pt;">'a\r\n'.splitlines() # ['a']</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■桁数</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 3桁に丸める</span></div><div><span style="font-size: 10pt;">round(0.10252, 3) # 0.103</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 桁多いfloatを1e-5とかの表記にする</span></div><div><span style="font-size: 10pt;">print(f&quot;_wd{args.weight_decay:.2e})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ゼロ埋め、0埋め</span></div><div><span style="font-size: 10pt;">print(format(1234, '08'))</span></div><div><span style="font-size: 10pt;"># 00001234</span></div><div><span style="font-size: 10pt;">str(1).zfill(3)</span></div><div><span style="font-size: 10pt;"># 001</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># formatは{引数の番号:.nf}で小数点n桁まで表示とできる</span></div><div><span style="font-size: 10pt;">line = &quot;{0}さんの身長は{1:.1f}cm、体重は{2:.1f}kgです。&quot;.format(&quot;山田&quot;, 190, 105.3)</span></div><div><span style="font-size: 10pt;">print(line)  # 山田さんの身長は190.0cm、体重は105.3kgです。</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■型変換</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 型判定</span></div><div><span style="font-size: 10pt;">if isinstance(img_list, np.ndarray):</span></div><div><span style="font-size: 10pt;">if isinstance(img_list, list):</span></div><div><span style="font-size: 10pt;">if isinstance(y[0], np.integer):</span></div><div><span style="font-size: 10pt;">if isinstance(x, float):</span></div><div><span style="font-size: 10pt;">if isinstance(100, (int, str)):  # True</span></div><div><span style="font-size: 10pt;">if df[col].dtype.name not in ['object', 'category']:</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ディレクトリか判定</span></div><div><span style="font-size: 10pt;">if os.path.isdir(dirpath):</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ディレクトリなら中身全部取得する</span></div><div><span style="font-size: 10pt;">args = {'images': ./tmp/}</span></div><div><span style="font-size: 10pt;">image_paths = glob.glob(os.path.join(args['images'][0], '*')) if os.path.isdir(args['images'][0]) else args['images']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 数値列の列名取得</span></div><div><span style="font-size: 10pt;">integer_cols = [col for col in df.columns if df[col].dtype.name not in ['object', 'category', 'bool']]</span></div><div><span style="font-size: 10pt;">integer_cols_nonnan = [col for col in df.columns if df[col].dtype.name not in ['object', 'category', 'bool'] and df[col].isnull().any() == False]  # 欠損列も除く場合</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">String値をBool値に変換する関数</span></font></div><div><span style="font-size: 10pt;">def cbool( value ):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; String値をBool値に変換 &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    if isinstance( value, str ) and value.lower() == &quot;false&quot;:</span></div><div><span style="font-size: 10pt;">        return False</span></div><div><span style="font-size: 10pt;">    if isinstance( value, str ) and value.lower() == &quot;true&quot;:</span></div><div><span style="font-size: 10pt;">        return True</span></div><div><span style="font-size: 10pt;">    return bool( value )</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 日付datetime→文字列</span></div><div><span style="font-size: 10pt;">import datetime</span></div><div><span style="font-size: 10pt;">now = datetime.datetime.now()  # date型にする場合は datetime.date.today()</span></div><div><span style="font-size: 10pt; font-weight: bold;">now.strftime('%Y-%m-%d %H:%M:%S') # =&gt; '2019-08-02 02:20:43'</span></div><div><span style="font-size: 10pt; font-weight: bold;">now.strftime('%Y年%m月%d日') # =&gt; '2019年08月02日'</span></div><div><span style="font-size: 10pt; font-weight: bold;">now.strftime('%A, %B %d, %Y') # =&gt; 'Friday, August 02, 2019'</span></div><div><span style="font-size: 10pt;">today = datetime.datetime.today().strftime(&quot;%Y-%m-%d&quot;) # '2020-03-07'</span></div><div><span style="font-size: 10pt;">df['yyyy-mm-dd'] = pd.to_datetime('2020/' + df['col']).dt.strftime(&quot;%Y-%m-%d&quot;)  # dt.strftime()で列を一括で任意のフォーマット（年-月-日）の文字列に変換</span></div><div><span style="font-size: 10pt;">df['yyyymm'] = pd.to_datetime('2020/' + df['col']).dt.strftime(&quot;%Y/%m&quot;)  # dt.strftime()で列を一括で任意のフォーマット（年月）の文字列に変換</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetime</span><span style="font-size: 10pt; font-weight: bold;">.datetime</span><span style="font-size: 10pt; font-weight: bold;">→int</span></font></div><div><span style="font-size: 10pt;">df['Date'] = df['Date'].astype(str).str.replace('-', '').astype(int)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># str→datetime.datetime</span></div><div><span style="font-size: 10pt;">import datetime</span></div><div><span style="font-size: 10pt;">_s = datetime.datetime.strptime('1988-12-8', '%Y-%m-%d')</span></div><div><span style="font-size: 10pt;">d = pd.to_datetime('1900/01/01')  # Timestamp('1900-01-01 00:00:00')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># str→datetime.date</span></div><div><span style="font-size: 10pt;">d = datetime.datetime.strptime('1988-12-8', '%Y-%m-%d')</span><span style="font-size: 10pt; font-weight: bold;">.date()</span></div><div><span style="font-size: 10pt;">d = datetime.datetime.strptime(('1988/12/8', '%Y/%m/%d')</span><span style="font-size: 10pt; font-weight: bold;">.date()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># datetime.datetime→datetime.date</span></div><div><span style="font-size: 10pt;">import datetime</span></div><div><span style="font-size: 10pt;">_s = datetime.datetime.now()</span></div><div><span style="font-size: 10pt;">_s = datetime.date(_s.year, _s.month, _s.day)</span></div><div><span style="font-size: 10pt;">sd = '20200401'</span></div><div><span style="font-size: 10pt;">datetime.date(int(sd[:4]), int(sd[4:6]), int(sd[6:]))  # </span><span style="box-sizing: unset; border: none; overflow: auto; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: var(--jp-content-font-color1); font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;">datetime.date(2020, 4, 1)</span></div><div><span style="font-size: 10pt;">df['col'] = pd.to_datetime('2020/' + df['col'])</span><span style="font-size: 10pt; font-weight: bold;">.dt.date</span><span style="font-size: 10pt;">  # dt.dateで列をdate型にできる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="box-sizing: unset; border: none; overflow: auto; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: var(--jp-content-font-color1); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: normal;">#</span> <span style="font-size: 10pt; font-weight: bold;">datetimeオブジェクトはdate()メソッドでdateオブジェクトに変換可能</span></div><div><span style="font-size: 10pt;">dt2 = datetime.datetime(year=2019, month=1, day=1, hour=12)  # 2019-01-01 12:00:00</span></div><div><span style="font-size: 10pt;">dt2</span><span style="font-size: 10pt; font-weight: bold;">.date()</span><span style="font-size: 10pt;">  # </span><span style="box-sizing: unset; border: none; overflow: auto; word-break: break-all; overflow-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: var(--jp-content-font-color1); font-variant-caps: normal; font-variant-ligatures: normal; line-height: normal;">datetime.date(2019, 1, 1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># numpyの要素をfloatに型変換</span></div><div><span style="font-size: 10pt;">np.array([1, 2, 3]).astype(np.float32) # [1. 2. 3.]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト→Numpy配列</span></div><div><span style="font-size: 10pt;">HP_arr = np.array(HP)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Numpy配列→リスト</span></div><div><span style="font-size: 10pt;">HP_arr.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リスト→Series</span></div><div><span style="font-size: 10pt;">HP_s = pd.Series(HP)</span></div><div><span style="font-size: 10pt;">HP_s = pd.Series(HP, index = ['戦士', '勇者', '僧侶', '魔法使い']) # indexを指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Numpy配列→Series</span></div><div><span style="font-size: 10pt;">HP_s = pd.Series(HP_arr)</span></div><div><span style="font-size: 10pt;">HP_s = pd.Series(HP_arr, index = ['戦士', '勇者', '僧侶', '魔法使い']) # indexを指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># Series→</span><span style="font-size: 10pt; font-weight: bold;">リスト</span></font></div><div><span style="font-size: 10pt;">HP_s.values.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Series→Numpy配列</span></div><div><span style="font-size: 10pt;">HP_s.values</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Series→DataFrame</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame([series])</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame(HP_s)</span></div><div><span style="font-size: 10pt;">df = pd.DataFrame(HP_s, columns = ['HP']) # カラムを指定</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># DataFrame→Series</span></div><div><span style="font-size: 10pt;">df['HP']</span></div><div><span style="font-size: 10pt;">df.HP</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># DataFrame→リスト（</span><span style="font-size: 10pt; font-weight: bold;">値のみをリスト型変換</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df.values.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># DataFrame→リスト（</span><span style="font-size: 10pt; font-weight: bold;">行ラベルも含めてリスト型に変換</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df.reset_index().values.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># DataFrame→リスト（列名と</span><span style="font-size: 10pt; font-weight: bold;">行ラベルも含めてリスト型に変換</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">df.reset_index().T.reset_index().T.values.tolist()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームの型を数値に変えたいけど例外レコードがあってastypeできない時の対処法</span></div><div><span style="font-size: 10pt;"># coerce：例外データ部分をNaNで返し、他の行は数値変換する</span></div><div><span style="font-size: 10pt;">df[&quot;数値変更したい列&quot;] = pd.to_numeric(df[&quot;数値変更したい列&quot;], errors='coerce')</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■datetime</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 現在の年</span></div><div><span style="font-size: 10pt;">now_year = str(datetime.date.today().year)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># datetimeの比較</span></div><div><span style="font-size: 10pt;">import datetime</span></div><div><span style="font-size: 10pt;">now = datetime.date.today()</span></div><div><span style="font-size: 10pt;">if _s &lt;= now &lt;= _e:</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># datetimeの引き算</span></div><div><span style="font-size: 10pt;">signal_day -</span> <span style="font-size: 10pt; font-weight: bold;">datetime.timedelta(days=1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># datetimeの足し算・引き算は</span><span style="font-size: 10pt; font-weight: bold;">datetime.timedelta()を使う</span></font></div><div><span style="font-size: 10pt;">dt1 = datetime.datetime(year=2019, month=1, day=1, hour=12)  # 2019-01-01 12:00:00</span></div><div><span style="font-size: 10pt;">dt2 = dt1.date()  # 2019-01-01</span></div><div><span style="font-size: 10pt; font-weight: bold;">td = datetime.timedelta(weeks=1, hours=20)</span><span style="font-size: 10pt;">  # 7 days, 20:00:00  # </span><span style="font-size: 10pt; font-weight: bold;">datetime.timedelta(days=1) でもいける</span></div><div><span style="font-size: 10pt;">print(dt1 + td)  # 2019-01-09 08:00:00</span></div><div><span style="font-size: 10pt;">print(dt2 + td)  # 2019-01-08</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">dateutil.relativedelta でも</span><span style="font-size: 10pt; font-weight: bold;">足し算・引き算できる。</span><span style="font-size: 10pt; font-weight: bold;">relativedeltaは月単位での加算に使う</span></font></div><div><span style="font-size: 10pt;">from dateutil.relativedelta import relativedelta</span></div><div><span style="font-size: 10pt;">date_list = [(datetime.date(2017, 1, 1) + relativedelta(months=x)).strftime(&quot;%Y%m&quot;) for x in range(0, 3)]  # ['201701', '201702', '201703']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">dateutil.relativedeltaで</span><span style="font-size: 10pt; font-weight: bold;">月の差計算して列に追加</span></div><div><span style="font-size: 10pt;">def _period(row):</span></div><div><span style="font-size: 10pt;">    from dateutil.relativedelta import relativedelta  </span></div><div><span style="font-size: 10pt;">    delta = relativedelta(row[&quot;now_date&quot;], row[&quot;start_date&quot;])</span></div><div><span style="font-size: 10pt;">    row[&quot;period&quot;] = delta.years*12 + delta.months</span></div><div><span style="font-size: 10pt;">    return row</span></div><div><span style="font-size: 10pt;">df = df.apply(_period, axis=1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■例外</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># すべての例外をcatch</span></div><div><span style="font-size: 10pt;">try:</span></div><div><span style="font-size: 10pt;">    print(a / b)</span></div><div><span style="font-size: 10pt; font-weight: bold;">except Exception as e:</span></div><div><span style="font-size: 10pt;">    print(e)</span></div><div><span style="font-size: 10pt;">finally:</span></div><div><span style="font-size: 10pt;">    print('end')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># すべての例外をキャッチし、詳細を表示</span></div><div><span style="font-size: 10pt;">try:</span></div><div><span style="font-size: 10pt;">    f1(1.0, 0.0)</span></div><div><span style="font-size: 10pt;">except:</span></div><div><span style="font-size: 10pt;">    import traceback</span></div><div><span style="font-size: 10pt;">    traceback.print_exc()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 例外発生させる</span></div><div><span style="font-size: 10pt;">try</span></div><div><span style="font-size: 10pt;">    </span><span style="font-size: 10pt; font-weight: bold;">raise Exception</span></div><div><span style="font-size: 10pt;">except Exception as e:</span></div><div><span style="font-size: 10pt;">    pass</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 呼び出し元に例外を送信する</span></div><div><span style="font-size: 10pt;">def huga():</span></div><div><span style="font-size: 10pt;">    try:</span></div><div><span style="font-size: 10pt;">        raise TypeError('TYPE ERROR!')</span></div><div><span style="font-size: 10pt;">    except Exception as e:</span></div><div><span style="font-size: 10pt;">        </span><span style="font-size: 10pt; font-weight: bold;">raise           # 呼び出し元に送信</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># assert文</span></div><div><span style="font-size: 10pt;">条件式がTrueではない時に、例外を投げる</span></div><div><span style="font-size: 10pt; font-weight: bold;">構文: assert 条件式, 条件式がFalseの場合に出力するメッセージ</span></div><div><span style="font-size: 10pt;">→条件式が False の場合、AssertionError の例外が発生します。</span></div><div><span style="font-size: 10pt;">→条件式が True の場合は何も起こりません。</span></div><div><span style="font-size: 10pt;">例.</span></div><div><span style="font-size: 10pt;">kitai = 100</span></div><div><span style="font-size: 10pt;">input = 1</span></div><div><span style="font-size: 10pt;">assert kitai == input, '期待する値[{0}], 入力値[{1}]'.format(kitai, input)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 年齢は 0 歳から 120 歳までのはず</span></div><div><span style="font-size: 10pt;">assert df[’age’].min() &gt;= 0 and df[’age’].max() &lt;= 120</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 年収の欠損は 1 割未満のはず</span></div><div><span style="font-size: 10pt;">assert df[’income’].isnull().mean() &lt; 0.1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 16 歳未満に既婚者はいないはず</span></div><div><span style="font-size: 10pt;">assert not ((df[’age’] &lt; 16) &amp; df[’is_married’]).any()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 数値列だけ取る</span></font></div><div><span style="font-size: 10pt;">assert df[col].dtype.name not in ['object', 'category', 'bool'], 'colが数値型の列でない'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># assertのエラーtryでキャッチ</span></font></div><div><span style="font-size: 10pt;">try:</span></div><div><span style="font-size: 10pt;">    assert small &gt; big, &quot;smallはbigより小さくないといけません&quot;</span></div><div><span style="font-size: 10pt;">#↑small&gt;bigの場合、メッセージが表示されます</span></div><div><span style="font-size: 10pt; font-weight: bold;">except AssertionError</span> <span style="font-size: 10pt;">as e:</span></div><div><span style="font-size: 10pt;">    print(&quot;テスト終了&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■argparse</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># argparseの関数例</span></div><div><span style="font-size: 10pt;">def get_args() -&gt; argparse.Namespace:</span></div><div><span style="font-size: 10pt;">    parser = argparse.ArgumentParser()</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;-o&quot;, &quot;--output_dir&quot;, type=str, default='output/tSNE', help=&quot;t-SNE results output dir path.&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;-m&quot;, &quot;--model_path&quot;, type=str, default='/home/imageinfo/H3-052/Submit/deep_metric.h5', help=&quot;keras model path.&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--cluster_info_xlsx&quot;, type=str, default='/home/imageinfo/H3-052/Submit/t-SNE_Cluster3/t-SNE_Cluster3.xlsx', help=&quot;cluster info xlsx path.&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--img_dir&quot;, type=str, default='/home/imageinfo/H3-052/Submit/Analysis/Images', help=&quot;jpg image dir.&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--gpu_id&quot;, type=str, default='0', help=&quot;use gpu id. ex) 0&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--perplexity&quot;, type=float, default=30.0, help=&quot;tsne param perplexity. ex) 30&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--group_key&quot;, type=str, default='sample_type', help=&quot;df column name to group. ex) sample_type&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--fitc_dapi&quot;, type=str, default='fitc', help=&quot;dye type. ex) fitc or dapi&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;--same_well_num&quot;, type=int, default=4, help=&quot;same well number(=visual field number). ex) 4&quot;)</span></div><div><span style="font-size: 10pt;">    parser.add_argument('--select', choices=['hoge', 'huga', 'piyo'])</span></div><div><span style="font-size: 10pt;">    parser.add_argument('--foo', required=True)</span></div><div><span style="font-size: 10pt;">    parser.add_argument('bar', nargs='+', help='one of the bars to be frobbled') # --bar 1 2 3とすると[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]になる nargs='*' でも同じ結果になる</span></div><div><span style="font-size: 10pt;">    parser.add_argument(&quot;-gp&quot;, &quot;--is_gradcam_plus&quot;, action='store_const', const=True, default=False, help=&quot;Grad-Cam++ flag.&quot;)</span></div><div><span style="font-size: 10pt;">    args = parser.parse_args() </span></div><div><span style="font-size: 10pt;">    #args = vars(ap.parse_args()) # 辞書型でほしいとき</span></div><div><span style="font-size: 10pt;">    #args = vars(ap.parse_args(args=[])) # notebookで argparseそのままで実行する場合はこっち</span></div><div><span style="font-size: 10pt;">    return args</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ymlファイルから引数ロード</span></div><div><span style="font-size: 10pt;">&lt;config.yml&gt;</span></div><div><span style="font-size: 10pt;">data:</span></div><div><span style="font-size: 10pt;">train: input/train.csv</span></div><div><span style="font-size: 10pt;">test: input/test.csv</span></div><div><span style="font-size: 10pt;">feature:</span></div><div><span style="font-size: 10pt;">- basic</span></div><div><span style="font-size: 10pt;">- aggregate</span></div><div><span style="font-size: 10pt;">model:</span></div><div><span style="font-size: 10pt;">n_estimators: 10000</span></div><div><span style="font-size: 10pt;">early_stopping_rounds: 100</span></div><div><span style="font-size: 10pt;">colsample_bytree: 0.8</span></div><div><span style="font-size: 10pt;">subsample: 0.8</span></div><div><span style="font-size: 10pt;">comment: aggregate 特徴量を追加</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">&lt;main.py&gt;</span></div><div><span style="font-size: 10pt;">import argparse</span></div><div><span style="font-size: 10pt;">import yaml</span></div><div><span style="font-size: 10pt;"># コマンドライン引数の設定</span></div><div><span style="font-size: 10pt;">parser = argparse.ArgumentParser()</span></div><div><span style="font-size: 10pt;">parser.add_argument(’-c’, ’--config’, type=str)</span></div><div><span style="font-size: 10pt;">args = parser.parse_args()</span></div><div><span style="font-size: 10pt;"># 設定ファイルのロード</span></div><div><span style="font-size: 10pt;">with open(args.config) as f:</span></div><div><span style="font-size: 10pt;">config = yaml.load(f)</span></div><div><span style="font-size: 10pt;">print(config[’comment’])</span></div><div><span style="font-size: 10pt;">print(’subsample:’, config[’model’][’subsample’])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">$ python main.py -c config.yml</span></div><div><span style="font-size: 10pt;">aggregate 特徴量を追加</span></div><div><span style="font-size: 10pt;">subsample: 0.8</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Jupyter lab / notebookで argparseそのままで実行する方法</span></div><div><span style="font-size: 10pt;">args = parser.parse_args() を以下に変更する</span></div><div><span style="font-size: 10pt;">→args = parser.parse_args(args=[]) # 引数指定がない場合</span></div><div><span style="font-size: 10pt;">→args = parser.parse_args(args=['--batchsize','200','--epoch','100','-g']) # 引数指定する場合</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■pathlib</span></div></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># パスの生成</span></div><div><span style="font-size: 10pt;">pathlib.Path.cwd() # 現在のパス</span></div><div><span style="font-size: 10pt;">pathlib.Path.home() # ホームディレクトリのパス</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># パスの操作</span></div><div><span style="font-size: 10pt;">p = pathlib.Path('tmp/hoge.csv')</span></div><div><span style="font-size: 10pt;">p.suffix # 拡張子</span></div><div><span style="font-size: 10pt;">p.parent # 親ディレクトリ</span></div><div><span style="font-size: 10pt;">p.name # 末尾の名前を取得</span></div><div><span style="font-size: 10pt;">p.parents # 親要素の配列</span></div><div><span style="font-size: 10pt;">p.exists() # パスの存在確認</span></div><div><span style="font-size: 10pt;">p.is_dir() # ディレクトリだったらTrue</span></div><div><span style="font-size: 10pt;">p.is_file() # ファイルだったらTrue</span></div><div><span style="font-size: 10pt;">p.rmdir() # 空のディレクトリなら削除</span></div><div><span style="font-size: 10pt;">p.mkdir(parents=False, exist_ok=False) # ディレクトリの作成. parents=Trueなら親フォルダも作る，exist_ok=Trueならすでにディレクトリが存在していてもNo Error</span></div><div><span style="font-size: 10pt;">p.glob(pattern) # patternにマッチする要素を検索</span></div><div><span style="font-size: 10pt;">p.resolve() # 絶対パスに変換</span></div><div><span style="font-size: 10pt;">p.open() # ファイルを開く</span></div><div><span style="font-size: 10pt;">str(p) # テキスト表示</span></div><div><span style="font-size: 10pt;">list(p.glob(pattern)) # glob検索結果を取得</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定ディレクトリ直下のディレクトリだけを取得</span></div><div><span style="font-size: 10pt;">dir_path = './tmp/'</span></div><div><span style="font-size: 10pt;">cla_dir_paths = sorted(glob.glob(str(pathlib.Path(dir_path) / '*')))</span></div><div><span style="font-size: 10pt;">classes = [pathlib.Path(cla_dir_path).name for cla_dir_path in cla_dir_paths]</span></div><div><span style="font-size: 10pt;">classes = [f for f in classes if os.path.isdir(os.path.join(dir_path, f))]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pathlib でモジュールの絶対パスを取得</span> <a href="https://chaika.hatenablog.com/entry/2018/08/24/090000" style="font-size: 10pt;">https://chaika.hatenablog.com/entry/2018/08/24/090000</a></div><div><span style="font-size: 10pt;">import pathlib</span></div><div><span style="font-size: 10pt;">current_dir = pathlib.Path(__file__).resolve().parent</span></div><div><span style="font-size: 10pt;">sys.path.append(str(current_dir) + '/../')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Xlsxwriter</span></div><div><span style="font-size: 10pt;">公式ドキュメントが一番わかりやすい: </span><a href="https://xlsxwriter.readthedocs.io/#" style="font-size: 10pt;">https://xlsxwriter.readthedocs.io/#</a></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># インストール</span></div><div><span style="font-size: 10pt;">$ conda install -c conda-forge  openpyxl  xlsxwriter</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># インポート</span></div><div><span style="font-size: 10pt;">import xlsxwriter</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 作成するエクセルのファイル</span></div><div><span style="font-size: 10pt;">wb = xlsxwriter.Workbook(’tmp.xlsx')</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 作成するエクセルシート</span></div><div><span style="font-size: 10pt;">ws = wb.add_worksheet('GradCam++')</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># データフレームからシート作成</span></div><div><span style="font-size: 10pt;">writer = pd.ExcelWriter(Path(args['smiles_path']).stem+'_predict.xlsx', engine='xlsxwriter')</span></div><div><span style="font-size: 10pt;">df_pred_score.to_excel(writer, sheet_name='predict') # MultiIndexでは index=False 使えない</span></div><div><span style="font-size: 10pt;">workbook  = writer.book</span></div><div><span style="font-size: 10pt;">worksheet = writer.sheets['predict']</span></div><div><span style="font-size: 10pt;">…</span></div><div><span style="font-size: 10pt;">workbook.close() # 保存</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 太字+セルの色グレーにするフォーマット</span></div><div><span style="font-size: 10pt;">title_format = wb.add_format({'bold': True, 'fg_color': '#BFBFBF'})</span></div><div><span style="font-size: 10pt; font-weight: bold;"># フォントサイズ11にするフォーマット</span></div><div><span style="font-size: 10pt;">text_format=wb.add_format({'bold': False, 'font_size':'11'})</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 作成するエクセルの列幅、列名設定</span></div><div><span style="font-size: 10pt;">ws.set_column(0, 0, 17.75) # ID column</span></div><div><span style="font-size: 10pt;">ws.write_string(1, 0, id_col_name, title_format) # A2 cell に id_col_name文字列記入</span></div><div><span style="font-size: 10pt;">ws.write_number(i+3, col_num+1, 1, int_format) # 数値記入</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 列名指定</span></div><div><span style="font-size: 10pt;">ws.set_column(col_num, col_num, 20) # Structure column</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># B1セルに文字列書き込み</span></div><div><span style="font-size: 10pt;">ws.write_string(0, 1, 'task'+str(task_id), title_format)</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># B1セルに1(数値)書き込み</span></div><div><span style="font-size: 10pt;">ws.write_number(0, 1, 1, int_format)</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt;">#</span> <span style="font-size: 10pt; font-weight: bold;">B1セルに</span><span style="font-size: 10pt; font-weight: bold;">画像貼り付け</span></div><div><span style="font-size: 10pt;">ws.insert_image(0, 1, 'tmp.jpg', {'positioning': 1, 'x_scale': 0.4, 'y_scale': 0.4})</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 結果保存</span></div><div><span style="font-size: 10pt;">wb.close()</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># オートフィルタ</span></div><div><span style="font-size: 10pt;">worksheet.autofilter('A3:'+max_col+str(df_pred_score.shape[1]+header_num))</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># ハイパーリンク</span></div><div><span style="font-size: 10pt;">worksheet.write_url('C'+str(i+header_num+1), dir)</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 条件付き書式のデータバー</span></div><div><span style="font-size: 10pt;">worksheet.conditional_format('D4:'+max_col+str(df_pred_score.shape[0]+header_num), {'type': 'data_bar'})</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 条件付き書式で数値セルの文字色変更</span></div><div><span style="font-size: 10pt;">worksheet.conditional_format('D4:'+max_col+str(df_pred_score.shape[0]+header_num),</span></div><div><span style="font-size: 10pt;">                                {'type':'cell',</span></div><div><span style="font-size: 10pt;">                                 'criteria':'&gt;=','value':0.5, # 0.5以上なら条件適用</span></div><div><span style="font-size: 10pt;">                                 'format':workbook.add_format({'font_color':'red'}) # 文字色赤にする</span></div><div><span style="font-size: 10pt;">                                 }</span></div><div><span style="font-size: 10pt;">                            )</span></div><div><span style="font-size: 10pt;"> </span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">スパークラインの棒グラフ</span></font></div><div><span style="font-size: 10pt;">worksheet.add_sparkline(max_col_plus+str(i+5), {'range':'predict!'+score_col+str(i+4)+':'+max_col+str(i+4),'type':'column'})</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># 最終列のアルファベット取得</span></div><div><span style="font-size: 10pt;">wb = openpyxl.Workbook()</span></div><div><span style="font-size: 10pt;">ws = wb.active</span></div><div><span style="font-size: 10pt;">coordinate = ws.cell(row=1,column=len(task_name_list)+index_col_num).coordinate</span></div><div><span style="font-size: 10pt;">max_col = coordinate.replace(&quot;1&quot;, &quot;&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">エクセルの</span><span style="font-size: 10pt; font-weight: bold;">シート名をすべて取得</span></div><div><span style="font-size: 10pt;">import openpyxl</span></div><div><span style="font-size: 10pt;">openpyxl.load_workbook(('A.xlsx')</span></div><div><span style="font-size: 10pt;">sheets = book.sheetnames</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># エクセルの列インデックスを列文字に変換 (3 -&gt; ‘C’)</span></div><div><span style="font-size: 10pt;">import openpyxl</span></div><div><span style="font-size: 10pt;">openpyxl.utils.cell.get_column_letter(3) # C</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;">import xlsxwriter</span></div><div><span style="font-size: 10pt;">column = xlsxwriter.utility.xl_col_to_name(2) # C</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># エクセルを作成して編集する例</span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal;">import xlsxwriter</span></span></div><div><span style="font-size: 10pt;">wb = xlsxwriter.Workbook('AmesTest_060degreeTTA.xlsx') # 作成するエクセル名</span></div><div><span style="font-size: 10pt;">ws = wb.add_worksheet('AmesTest_060degreeTTA') # 編集するシート追加</span></div><div><span style="font-size: 10pt;">title_format = wb.add_format({'bold': True, 'fg_color': '#BFBFBF'}) # 特定のセルの文字を太字にしてセルの色を灰色にするフォーマット</span></div><div><span style="font-size: 10pt;">ws.write_string(0, 0, 'ID', title_format) # A1 cell</span></div><div><span style="font-size: 10pt;">ws.write_string(0, 1, 'Structure（GradCam CV1 model）', title_format) # B1 cell</span></div><div><span style="font-size: 10pt;">ws.set_row(1, 123.75) # 1行目のセルの高さを123.75にする</span></div><div><span style="font-size: 10pt;">ws.write_number(1, 0, 1) # 1行目の0列(A列)の値を1にする</span></div><div><span style="font-size: 10pt;">ws.insert_image(1, 1, 'tmp.png', {'positioning': 1, 'x_scale': 0.3, 'y_scale': 0.3}) # 1行目の1列(B列)に画像ファイル貼り付ける</span></div><div><span style="font-size: 10pt;">wb.close() # closeしないと保存されない</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">データフレームをエクセルの1シートにして保存する関数</span></font></div><div><span style="font-size: 10pt;">def make_xlsx_from_df(df, output_xlsx:str, sheet_name='sheet'):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    xlsxwriterを使ってデータフレームをエクセルの1シートにして保存.</span></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        df: dataframe</span></div><div><span style="font-size: 10pt;">        output_xlsx: output xlsx path</span></div><div><span style="font-size: 10pt;">        sheet_name: output xlsx sheet name</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    writer = pd.ExcelWriter(output_xlsx, engine='xlsxwriter')</span></div><div><span style="font-size: 10pt;">    df.to_excel(writer, sheet_name=sheet_name, index=False) # データフレームのindexは含めずにエクセルにする</span></div><div><span style="font-size: 10pt;">    worksheet = writer.sheets[sheet_name] # エクセルのシート名を指定</span></div><div><span style="font-size: 10pt;">    # header のフォーマット指定.</span></div><div><span style="font-size: 10pt;">    header_format = writer.book.add_format({</span></div><div><span style="font-size: 10pt;">        'bold': True,</span></div><div><span style="font-size: 10pt;">        'valign': 'top',</span></div><div><span style="font-size: 10pt;">        'font_size':'10',</span></div><div><span style="font-size: 10pt;">        'font_name': 'Arial',</span></div><div><span style="font-size: 10pt;">        'border': 0})</span></div><div><span style="font-size: 10pt;">    for col_num, value in enumerate(df.columns.values):</span></div><div><span style="font-size: 10pt;">        worksheet.write(0, col_num, value, header_format)</span></div><div><span style="font-size: 10pt;">    # データ行のフォーマット指定.</span></div><div><span style="font-size: 10pt;">    num_fmt_a = writer.book.add_format({'font_name':'Arial', 'font_size':'10', 'num_format':'0.0000'}) # フォントをArial, 文字サイズを10, セルの書式で数値は0.0000までしか表示させないようにする</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('A:A', 11, num_fmt_a) # A列の幅を14にして、num_fmt_aのフォーマット指定</span></div><div><span style="font-size: 10pt;">    num_fmt_b = writer.book.add_format({'font_name':'Arial', 'font_size':'10', 'num_format':'0.00'}) # フォントをArial, 文字サイズを10, セルの書式で数値は0.00までしか表示させないようにする</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('B:B', 14, num_fmt_b) # B列の幅を14にして、num_fmt_bのフォーマット指定</span></div><div><span style="font-size: 10pt;">    fmt = writer.book.add_format({'font_name':'Arial', 'font_size':'10'}) # フォントをArial, 文字サイズを10にする</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('C:C', 13, fmt) # C列の幅を13にして、fmtのフォーマット指定</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('D:D', 9, fmt) # D列の幅を9にして、fmtのフォーマット指定</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('E:E', 8, fmt) # E列の幅を8にして、fmtのフォーマット指定</span></div><div><span style="font-size: 10pt;">    worksheet.set_column('F:F', 18, fmt) # F列の幅を18にして、fmtのフォーマット指定</span></div><div><span style="font-size: 10pt;">    # Autofilter</span></div><div><span style="font-size: 10pt;">    worksheet.autofilter('A1:F1') # A-F列にフィルターつける</span></div><div><span style="font-size: 10pt;">    # 条件付き書式.0.5以上を赤文字にする</span></div><div><span style="font-size: 10pt;">    worksheet.conditional_format(col+'4:'+col+str(df_pred_score.shape[0]+header_num),</span></div><div><span style="font-size: 10pt;">                                        {'type':'cell',</span></div><div><span style="font-size: 10pt;">                                        'criteria':'&gt;=','value':grad_threshold[i], # grad_threshold[i]以上なら条件適用</span></div><div><span style="font-size: 10pt;">                                        'format':workbook.add_format({'font_color':'red'}) # 文字色赤にする</span></div><div><span style="font-size: 10pt;">                                        })</span></div><div><span style="font-size: 10pt;">    # 条件付き書式のデータバー</span></div><div><span style="font-size: 10pt;">    worksheet.conditional_format('D4:'+max_col+str(df_pred_score.shape[0]+header_num), {'type': 'data_bar'</span></div><div><span style="font-size: 10pt;">                                                                                            , 'min_type': 'num'</span></div><div><span style="font-size: 10pt;">                                                                                            , 'max_type': 'num'</span></div><div><span style="font-size: 10pt;">                                                                                            , 'min_value': 0.0</span></div><div><span style="font-size: 10pt;">                                                                                            , 'max_value': 1.0})</span></div><div><span style="font-size: 10pt;">    # ハイパーリンク</span></div><div><span style="font-size: 10pt;">    worksheet.write_url('C'+str(i+header_num+1), str(pathlib.Path(dir).stem))</span></div><div><span style="font-size: 10pt;">    # 画像つける</span></div><div><span style="font-size: 10pt;">    worksheet2.insert_image('A1', args['output_dir']+'/predict_hist.jpg')</span></div><div><span style="font-size: 10pt;">    # save</span></div><div><span style="font-size: 10pt;">    writer.save() # エクセル保存</span></div><div><span style="font-size: 10pt;">    return</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■TensorflowGPU</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># TensorflowGPU 動作確認用スクリプト（Tensorflow ver1.40+以降で確認済み）</span></div><div><span style="font-size: 10pt;">from tensorflow.python.client import device_lib</span></div><div><span style="font-size: 10pt;">device_lib.list_local_devices()</span></div><div><span style="font-size: 10pt;">or</span></div><div><span style="font-size: 10pt;"># デフォルトGPU (device:0)を指名で行列計算を行う</span></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><span style="font-size: 10pt;">with tf.device('/gpu:0'):</span></div><div><span style="font-size: 10pt;">    a = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[2, 3], name='a')</span></div><div><span style="font-size: 10pt;">    b = tf.constant([1.0, 2.0, 3.0, 4.0, 5.0, 6.0], shape=[3, 2], name='b')</span></div><div><span style="font-size: 10pt;">    c = tf.matmul(a, b)</span></div><div><span style="font-size: 10pt;">with tf.Session() as sess:</span></div><div><span style="font-size: 10pt;">    print(sess.run(c))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># tensorflowのメモリ開放（</span><span style="font-size: 10pt; font-weight: bold;">モデルの構築を始める前に書く</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(36, 41, 46); font-variant-caps: normal; font-variant-ligatures: normal;">tf.reset_default_graph()</span></span></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(36, 41, 46); font-variant-caps: normal; font-variant-ligatures: normal;">※kerasのクリアは </span><span style="font-size: 10pt; color: rgb(36, 41, 46); font-variant-caps: normal; font-variant-ligatures: normal;">keras.backend.clear_session()</span></font></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(36, 41, 46); font-weight: bold;"># </span><span style="font-size: 10pt; color: rgb(36, 41, 46); font-weight: bold;">tensorflowのkerasのimport</span></font></div><div><span style="font-size: 10pt; color: rgb(36, 41, 46);">import tensorflow.keras.backend as K</span></div><div><span style="font-size: 10pt; color: rgb(36, 41, 46);">or</span></div><div><span style="font-size: 10pt; color: rgb(36, 41, 46);">import tensorflow as tf</span></div><div><span style="font-size: 10pt; color: rgb(36, 41, 46);">K = tf.keras.backend</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tensorflowのINFOレベルのログを出さないようにする</span></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'</span></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">tensorflowの乱数固定</span></font></div><div><span style="font-size: 10pt;">def set_tf_random_seed(seed=0):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    tensorflow v2.0の乱数固定</span></div><div><span style="font-size: 10pt;">    </span><a href="https://qiita.com/Rin-P/items/acacbb6bd93d88d1ca1b" style="font-size: 10pt;">https://qiita.com/Rin-P/items/acacbb6bd93d88d1ca1b</a></div><div><span style="font-size: 10pt;">    ※tensorflow-determinism が無いとgpuについては固定できないみたい</span></div><div><span style="font-size: 10pt;">    　tensorflow-determinism はpipでしか取れない($ pip install tensorflow-determinism)ので未確認</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    import random</span></div><div><span style="font-size: 10pt;">    import numpy as np</span></div><div><span style="font-size: 10pt;">    import tensorflow as tf</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    ## ソースコード上でGPUの計算順序の固定を記述</span></div><div><span style="font-size: 10pt;">    #from tfdeterminism import patch</span></div><div><span style="font-size: 10pt;">    #patch()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    # 乱数のseed値の固定</span></div><div><span style="font-size: 10pt;">    random.seed(seed)</span></div><div><span style="font-size: 10pt;">    np.random.seed(seed)</span></div><div><span style="font-size: 10pt;">    tf.random.set_seed(seed)  # v1.0系だとtf.set_random_seed(seed)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">ndarray型の</span><span style="font-size: 10pt; font-weight: bold;">画像を指定サイズに</span><span style="font-size: 10pt; font-weight: bold;">keras.preprocessingで</span><span style="font-size: 10pt; font-weight: bold;">リサイズ</span></font></div><div><span style="font-size: 10pt;">def resize_ndarray(x, input_shape=(380,380,3)):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    ndarray型の画像を指定サイズにリサイズする</span></div><div><span style="font-size: 10pt;">    </span><a href="http://pynote.hatenablog.com/entry/keras-image-utils" style="font-size: 10pt;">http://pynote.hatenablog.com/entry/keras-image-utils</a></div><div><span style="font-size: 10pt;">    </span><a href="http://pynote.hatenablog.com/entry/pillow-resize" style="font-size: 10pt;">http://pynote.hatenablog.com/entry/pillow-resize</a></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    # ndarray から PIL 形式に変換する</span></div><div><span style="font-size: 10pt;">    img = tensorflow.keras.preprocessing.image.array_to_img(x)</span></div><div><span style="font-size: 10pt;">    # 指定した大きさにリサイズする</span></div><div><span style="font-size: 10pt;">    img = img.resize((input_shape[0], input_shape[1]), resample=0)</span></div><div><span style="font-size: 10pt;">    # PIL 形式から ndarray に変換する</span></div><div><span style="font-size: 10pt;">    x = tensorflow.keras.preprocessing.image.img_to_array(img)</span></div><div><span style="font-size: 10pt;">    return x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">ImageDataGenerator の呼び出し</span></font></div><div><span style="font-size: 10pt;">from tensorflow.keras.preprocessing.image import ImageDataGenerator</span></div><div><span style="font-size: 10pt;">train_image_generator = ImageDataGenerator(rescale=1./255)</span></div><div><span style="font-size: 10pt;">batch_size = 128</span></div><div><span style="font-size: 10pt;">IMG_HEIGHT = 150</span></div><div><span style="font-size: 10pt;">IMG_WIDTH = 150</span></div><div><span style="font-size: 10pt;">train_data_gen = train_image_generator.flow_from_directory(batch_size=batch_size,</span></div><div><span style="font-size: 10pt;">                                                           directory=TRAIN_DIR,</span></div><div><span style="font-size: 10pt;">                                                           shuffle=True,</span></div><div><span style="font-size: 10pt;">                                                           target_size=(IMG_HEIGHT, IMG_WIDTH),</span></div><div><span style="font-size: 10pt;">                                                           class_mode='binary')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">dict_class_name = train_data_gen.class_indices  # {'Cat': 0, 'Dog': 1} みたいにラベル名見れる</span></div><div><span style="font-size: 10pt;">y_true = [&quot;cat&quot; if y &lt; 0.5 else &quot;dog&quot; for y in train_data_gen.classes]  # 正解ラベルリストで取得</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># Modelクラスのサブクラス化（</span><span style="font-size: 10pt; font-weight: bold;">tensorflow2.0から使える</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><span style="font-size: 10pt;">from tensorflow.keras.layers import Input, Dense, Conv2D, Flatten, Dropout, MaxPooling2D</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">class MyModel(tf.keras.Model):</span></div><div><span style="font-size: 10pt;">    def __init__(self):</span></div><div><span style="font-size: 10pt;">        super(MyModel, self).__init__()</span></div><div><span style="font-size: 10pt;">        self.conv1 = Conv2D(16, 3, padding='same', activation='relu')</span></div><div><span style="font-size: 10pt;">        self.conv2 = Conv2D(32, 3, padding='same', activation='relu')</span></div><div><span style="font-size: 10pt;">        self.conv3 = Conv2D(64, 3, padding='same', activation='relu')</span></div><div><span style="font-size: 10pt;">        self.pooling = MaxPooling2D()</span></div><div><span style="font-size: 10pt;">        self.flatten = Flatten()</span></div><div><span style="font-size: 10pt;">        self.dense1 = Dense(512, activation='relu')</span></div><div><span style="font-size: 10pt;">        self.dense_out = Dense(1, activation='sigmoid')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def call(self, x):</span></div><div><span style="font-size: 10pt;">        x = self.conv1(x)</span></div><div><span style="font-size: 10pt;">        x = self.pooling(x)</span></div><div><span style="font-size: 10pt;">        x = self.conv2(x)</span></div><div><span style="font-size: 10pt;">        x = self.pooling(x)</span></div><div><span style="font-size: 10pt;">        x = self.conv3(x)</span></div><div><span style="font-size: 10pt;">        x = self.pooling(x)</span></div><div><span style="font-size: 10pt;">        x = self.flatten(x)</span></div><div><span style="font-size: 10pt;">        x = self.dense1(x)</span></div><div><span style="font-size: 10pt;">        return self.dense_out(x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># モデルのインスタンスを作成</span></div><div><span style="font-size: 10pt;">model = MyModel()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">def get_functional_model(model, input_shape=(IMG_HEIGHT, IMG_WIDTH ,3)):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    model.summary()でエラー避けるため、インスタンス化した「仮のモデル」をFunctional APIで生成する独自関数</span></div><div><span style="font-size: 10pt;">    </span><a href="https://www.atmarkit.co.jp/ait/articles/2003/10/news016.html" style="font-size: 10pt;">https://www.atmarkit.co.jp/ait/articles/2003/10/news016.html</a></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    以下の書き方でもmodel.summary()出せるが、Output Shapeが表示されない</span></div><div><span style="font-size: 10pt;">    model = MyModel()</span></div><div><span style="font-size: 10pt;">    model.build(input_shape=(None, IMG_HEIGHT, IMG_WIDTH ,3))  # モデルのビルド</span></div><div><span style="font-size: 10pt;">    model.summary()</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    x = tf.keras.layers.Input(shape=input_shape, name='layer_in')</span></div><div><span style="font-size: 10pt;">    temp_model = tf.keras.Model(</span></div><div><span style="font-size: 10pt;">        inputs=[x],</span></div><div><span style="font-size: 10pt;">        outputs=model.call(x),  # ※サブクラス化したモデルの`call`メソッドを指定</span></div><div><span style="font-size: 10pt;">        name='temp_model')  # 仮モデルにも名前付け</span></div><div><span style="font-size: 10pt;">    return temp_model</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">f_model = get_functional_model(model)</span></div><div><span style="font-size: 10pt;">f_model.summary()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tensorflow2.1からfit_generatorはfitに統合された</span></div><div><a href="https://stackoverflow.com/questions/59380430/how-to-use-model-fit-which-supports-generators-after-fit-generator-deprecation" style="font-size: 10pt;">https://stackoverflow.com/questions/59380430/how-to-use-model-fit-which-supports-generators-after-fit-generator-deprecation</a></div><div><span style="font-size: 10pt;">model.compile(optimizer='adam',loss='binary_crossentropy',metrics=['accuracy'])</span></div><div><span style="font-size: 10pt;">history = model.fit(</span></div><div><span style="font-size: 10pt;">    train_data_gen,  # generatorもfitでいける</span></div><div><span style="font-size: 10pt;">    steps_per_epoch=1000 // batch_size,  # ImageDataGeneratorならsteps_per_epoch指定しなくてもいける。</span><span style="font-size: 10pt; color: rgb(255, 0, 0);">自作のImageDataGeneratorの場合は指定必要</span></div><div><span style="font-size: 10pt;">    epochs=epochs,</span></div><div><span style="font-size: 10pt;">    validation_data=valid_data_gen,</span></div><div><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># モデル予測</span></div><div><span style="font-size: 10pt;">model.predict(&lt;4次元のnumpy画像&gt;)  # 画像1件予測</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">model.predict(valid_data_gen).reshape(-1)  # ImageDataGenerator でもいける。[n,1]次元で出力されからreshapeで次元下げてる</span></div><div><span style="font-size: 10pt;">pred_labels = [&quot;cat&quot; if pb &lt; 0.5 else &quot;dog&quot; for pb in model.predict(test_data_gen).reshape(-1)]  # 2値分類ならこんな感じでラベルにする</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">model.evaluate(x_test, y_test, batch_size=128)  # lossも計算する。model.compile()済みである必要あり</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tensorflow2.0でjpg画像ロード</span></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><span style="font-size: 10pt;">img_path = 'flower.jpg'</span></div><div><span style="font-size: 10pt;">img = tf.io.decode_jpeg(tf.io.read_file())</span></div><div><span style="font-size: 10pt;">print(img.shape)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># uint8 -&gt; floatへのキャスト、[0, 255] -&gt; [0, 1]への変換</span></div><div><span style="font-size: 10pt;">float_img = tf.cast(img, tf.float32) / 255.0</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tensorflow2.0で次元上げる（4次元テンソル化）</span></div><div><span style="font-size: 10pt;">img = tf.expand_dims(img, axis=0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tensorflow2.0の畳み込み</span></div><div><span style="font-size: 10pt;">tf.nn.conv2d(画像のテンソル, カーネルのテンソル, strides, padding)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># VGG16ライクなNN構築</span></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><span style="font-size: 10pt;">import tensorflow.keras.layers as layers</span></div><div><span style="font-size: 10pt;">def create_vgg(input_shape=(32, 32, 3), n_class=10, activation=&quot;softmax&quot;):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    </span><a href="https://colab.research.google.com/drive/1SvxY7UvNVEadg1Nsuips0_GehmprxaCv" style="font-size: 10pt;">https://colab.research.google.com/drive/1SvxY7UvNVEadg1Nsuips0_GehmprxaCv</a></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    inputs = layers.Input(input_shape)</span></div><div><span style="font-size: 10pt;">    x = inputs</span></div><div><span style="font-size: 10pt;">    for ch in [64, 128, 256]:</span></div><div><span style="font-size: 10pt;">        x = layers.Conv2D(ch, 3, padding='same')(x)</span></div><div><span style="font-size: 10pt;">        x = layers.BatchNormalization()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.ReLU()(x)</span></div><div><span style="font-size: 10pt;">        if ch != 256:</span></div><div><span style="font-size: 10pt;">            x = layers.AveragePooling2D(2)(x)</span></div><div><span style="font-size: 10pt;">    x = layers.GlobalAveragePooling2D()(x)</span></div><div><span style="font-size: 10pt;">    x = layers.Dense(n_class, activation=activation)(x)</span></div><div><span style="font-size: 10pt;">    return tf.keras.models.Model(inputs, x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">model = create_vgg()</span></div><div><span style="font-size: 10pt;">model.summary()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># CIFAR10用のResNet構築</span></div><div><span style="font-size: 10pt;">import tensorflow as tf</span></div><div><span style="font-size: 10pt;">import tensorflow.keras.layers as layers</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">def create_resnet(input_shape=(32, 32, 3), n_class=10, activation=&quot;softmax&quot;):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    </span><a href="https://colab.research.google.com/drive/1oJFpFdenvPGpREze5JzObasEB8xwku_0#scrollTo=nWgh1RMn640N" style="font-size: 10pt;">https://colab.research.google.com/drive/1oJFpFdenvPGpREze5JzObasEB8xwku_0#scrollTo=nWgh1RMn640N</a></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    def residual_block(inputs, ch, strides):</span></div><div><span style="font-size: 10pt;">        # main path</span></div><div><span style="font-size: 10pt;">        x = layers.BatchNormalization()(inputs)</span></div><div><span style="font-size: 10pt;">        x = layers.ReLU()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.Conv2D(ch, 3, strides=strides, padding=&quot;same&quot;,</span></div><div><span style="font-size: 10pt;">                          kernel_regularizer=tf.keras.regularizers.l2(1e-4))(x)</span></div><div><span style="font-size: 10pt;">        x = layers.BatchNormalization()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.ReLU()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.Conv2D(ch, 3, padding=&quot;same&quot;,</span></div><div><span style="font-size: 10pt;">                          kernel_regularizer=tf.keras.regularizers.l2(1e-4))(x)</span></div><div><span style="font-size: 10pt;">        # shortcut path</span></div><div><span style="font-size: 10pt;">        if inputs.shape[-1] != ch or strides &gt; 1:</span></div><div><span style="font-size: 10pt;">            s = layers.Conv2D(ch, 3, strides=strides, padding=&quot;same&quot;,</span></div><div><span style="font-size: 10pt;">                          kernel_regularizer=tf.keras.regularizers.l2(1e-4))(inputs)</span></div><div><span style="font-size: 10pt;">        else:</span></div><div><span style="font-size: 10pt;">            s = inputs</span></div><div><span style="font-size: 10pt;">        # add</span></div><div><span style="font-size: 10pt;">        x = layers.Add()([x, s])</span></div><div><span style="font-size: 10pt;">        return x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def main():</span></div><div><span style="font-size: 10pt;">        inputs = layers.Input(input_shape)</span></div><div><span style="font-size: 10pt;">        x = layers.Conv2D(16, 3, padding=&quot;same&quot;)(inputs)</span></div><div><span style="font-size: 10pt;">        for ch in [16, 32, 64]:</span></div><div><span style="font-size: 10pt;">            for i in range(7):</span></div><div><span style="font-size: 10pt;">                strides = 2 if i == 0 else 1</span></div><div><span style="font-size: 10pt;">                if ch == 16:</span></div><div><span style="font-size: 10pt;">                    strides = 1</span></div><div><span style="font-size: 10pt;">                x = residual_block(x, ch, strides)</span></div><div><span style="font-size: 10pt;">        x = layers.BatchNormalization()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.ReLU()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.GlobalAveragePooling2D()(x)</span></div><div><span style="font-size: 10pt;">        x = layers.Dense(n_class, activation=activation)(x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        return tf.keras.models.Model(inputs, x)</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    return main()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">model = create_resnet()</span></div><div><span style="font-size: 10pt;">model.summary()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Pytorch</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pytorch_optimizer 取得関数</span></div><div><span style="font-size: 10pt;">import torch</span></div><div><span style="font-size: 10pt;">import torch.optim as optim</span></div><div><span style="font-size: 10pt;">def get_pytorch_optimizer(self, trial, net,</span></div><div><span style="font-size: 10pt;">                    lr, weight_decay, optimizer_name,</span></div><div><span style="font-size: 10pt;">                    is_nesterovs=[False],</span></div><div><span style="font-size: 10pt;">                    is_amsgrads=[False]):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    pytorch_optimizer 取得</span></div><div><span style="font-size: 10pt;">    参考:</span> <a href="https://qiita.com/eduidl/items/9c684a6467a63acd28f2" style="font-size: 10pt;">https://qiita.com/eduidl/items/9c684a6467a63acd28f2</a></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    is_amsgrad, is_nesterov = False, False</span></div><div><span style="font-size: 10pt;">    if optimizer_name == 'Adam':</span></div><div><span style="font-size: 10pt;">        is_amsgrad = cbool(trial.suggest_categorical('adam_amsgrad', is_amsgrads)) # Adamのamsgrad</span></div><div><span style="font-size: 10pt;">        optimizer = optim.Adam(net.parameters(), lr=lr, weight_decay=weight_decay, amsgrad=is_amsgrad) # デフォルトlr=1e-3</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    elif optimizer_name == 'MomentumSGD':</span></div><div><span style="font-size: 10pt;">        is_nesterov = cbool(trial.suggest_categorical('momentum_sgd_nesterov', is_nesterovs)) # MomentumSGDのnesterov</span></div><div><span style="font-size: 10pt;">        optimizer = optim.SGD(net.parameters(), lr=lr, momentum=0.9, weight_decay=weight_decay, nesterov=is_nesterov)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    elif optimizer_name == 'Adadelta':</span></div><div><span style="font-size: 10pt;">        optimizer = optim.Adagrad(net.parameters(), weight_decay=weight_decay)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    elif optimizer_name == 'Adagrad':</span></div><div><span style="font-size: 10pt;">        optimizer = optim.Adagrad(net.parameters(), lr=lr, weight_decay=weight_decay) # Adagrad はデフォルトlr=1e-2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    elif optimizer_name == 'Adamax':</span></div><div><span style="font-size: 10pt;">        optimizer = optim.Adamax(net.parameters(), lr=lr, weight_decay=weight_decay) # Adamax はデフォルトlr=2e-3</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    elif optimizer_name == 'RMSprop':</span></div><div><span style="font-size: 10pt;">        optimizer = optim.RMSprop(net.parameters(), lr=lr, weight_decay=weight_decay) # RMSprop はデフォルトlr=1e-2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    return optimizer, is_amsgrad, is_nesterov</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pytorchでtensorboardファイル作成例</span></div><div><span style="font-size: 10pt;">import tqdm</span></div><div><span style="font-size: 10pt;">from tensorboardX import SummaryWriter</span></div><div><span style="font-size: 10pt;">writer = SummaryWriter(&quot;run/001&quot;) # run/001ディレクトリにtensorboardファイル作られる</span></div><div><span style="font-size: 10pt;">for epoch in tqdm.tqdm(range(args.epochs), leave=False):</span></div><div><span style="font-size: 10pt;">    writer.add_scalar('logloss/va', results_va['logloss'], epoch) # スカラー値追加していく</span></div><div><span style="font-size: 10pt;">writer.close() # tensorboardファイルクローズ. クローズしないとファイル空になることが多々ある</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># pytorchで乱数固定</span></font></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">import random</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import torch</span></div><div><span style="font-size: 10pt;">SEED_VALUE = 1234  # これはなんでも良い</span></div><div><span style="font-size: 10pt;">os.environ['PYTHONHASHSEED'] = str(SEED_VALUE)</span></div><div><span style="font-size: 10pt;">random.seed(SEED_VALUE)</span></div><div><span style="font-size: 10pt;">np.random.seed(SEED_VALUE)</span></div><div><span style="font-size: 10pt;">torch.manual_seed(SEED_VALUE)  # PyTorchを使う場合</span></div><div><span style="font-size: 10pt;"># PyTorchでGPUを使用する場合は以下も必要だが処理速度遅くなる</span></div><div><span style="font-size: 10pt;">torch.backends.cudnn.deterministic = True</span></div><div><span style="font-size: 10pt;">torch.backends.cudnn.benchmark = False</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■sklearn</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sklearnでモデル名表示</span></font></div><div>from sklearn.linear_model import LogisticRegression</div><div># ロジスティック回帰</div><div>model = LogisticRegression()</div><div>clf = model.fit(X_train,y_train)</div><div>print(<span style="font-weight: bold;">clf.__class__.__name__</span>)  # 文字列型で&quot;LogisticRegression&quot;が返る</div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># skleranで正規化（標準化）</span></font></div><div><span style="font-size: 10pt;">from sklearn.preprocessing import</span> <span style="font-size: 10pt; font-weight: bold;">StandardScaler </span> <span style="font-size: 10pt;"># 平均0、分散1に変換する正規化（標準化）。最小値0、最大値1にする正規化はMinMaxScaler</span></div><div><span style="font-size: 10pt;">df['value'] = df['value'].astype(float)  # 少数点以下を扱えるようにするためfloat型に変換</span></div><div><span style="font-size: 10pt; font-weight: bold;">ss = StandardScaler()</span><span style="font-size: 10pt;">  # 正規化を行うオブジェクトを生成</span></div><div><span style="font-size: 10pt;"># fit_transform関数は、fit関数（正規化するための前準備の計算）とtransform関数（準備された情報から正規化の変換処理を行う）の両方を行う</span></div><div><span style="font-size: 10pt;">result =</span> <span style="font-size: 10pt; font-weight: bold;">ss.fit_transform</span><span style="font-size: 10pt;">(df[['value', 'value2']])</span></div><div><span style="font-size: 10pt;">df['value_normalized'] = [x[0] for x in result]</span></div><div><span style="font-size: 10pt;">df['value2_normalized'] = [x[1] for x in result]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># それぞれのカテゴリ変数にlabel encoding(posiみたいなカテゴリ値を1のような数値に変換)を適用する</span></div><div><span style="font-size: 10pt;">from sklearn.preprocessing import</span> <span style="font-size: 10pt; font-weight: bold;">LabelEncoder</span></div><div><span style="font-size: 10pt;">for c in ['Sex', 'Embarked']:</span></div><div><span style="font-size: 10pt;">    # 学習データに基づいてどう変換するかを定める</span></div><div><span style="font-size: 10pt;">   </span><span style="font-size: 10pt; font-weight: bold;"> le = LabelEncoder()</span></div><div><span style="font-size: 10pt; font-weight: bold;">    le.fit(train_x[c].fillna('NA'))</span></div><div><span style="font-size: 10pt;">    # 学習データ、テストデータを変換する</span></div><div><span style="font-size: 10pt;">    train_x[c] =</span> <span style="font-size: 10pt; font-weight: bold;">le.transform</span><span style="font-size: 10pt;">(train_x[c].fillna('NA'))</span></div><div><span style="font-size: 10pt;">    test_x[c] =</span> <span style="font-size: 10pt; font-weight: bold;">le.transform</span><span style="font-size: 10pt;">(test_x[c].fillna('NA'))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">sklearnでnp.ndarrayのラベルをonehot化</span></font></div><div><span style="font-size: 10pt;">def label2onehot(labels: np.ndarray):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    sklearnでnp.ndarrayのラベルをonehot化</span></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        labels:onehot化するラベル名の配列.np.array(['high' 'high' 'low' 'low'])のようなの</span></div><div><span style="font-size: 10pt;">    Returns:</span></div><div><span style="font-size: 10pt;">        enc:ラベル名を0-nの連番にした配列。np.array([[0] [0] [1] [1]])のようなの</span></div><div><span style="font-size: 10pt;">        onehot:ラベル名をonehotにした配列。np.array([[1. 0.] [1. 0.] [0. 1.] [0. 1.]])のようなの</span></div><div><span style="font-size: 10pt;">    Usage:</span></div><div><span style="font-size: 10pt;">        labels = df['aaa'].values</span></div><div><span style="font-size: 10pt;">        enc, onehot = label2onehot(labels)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    from sklearn import preprocessing</span></div><div><span style="font-size: 10pt;">   </span><span style="font-size: 10pt; font-weight: bold;"> from sklearn.preprocessing import OneHotEncoder</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    enc = preprocessing.LabelEncoder().fit_transform(labels).reshape(-1,1)</span></div><div><span style="font-size: 10pt;">    onehot =</span> <span style="font-size: 10pt; font-weight: bold;">OneHotEncoder().fit_transform</span><span style="font-size: 10pt;">(enc).toarray()</span></div><div><span style="font-size: 10pt;">    return enc, onehot</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">LightGBM</span><span style="font-size: 10pt; font-weight: bold;">で</span><span style="font-size: 10pt; font-weight: bold;">グリッドサーチ例</span></font></div><div><span style="font-size: 10pt;">from sklearn.model_selection import GridSearchCV</span></div><div><span style="font-size: 10pt;">import lightgbm as lgb</span></div><div><span style="font-size: 10pt;"># グリッドサーチを行うためのパラメーター</span></div><div><span style="font-size: 10pt;">parameters = [{</span></div><div><span style="font-size: 10pt;">    'learning_rate':[0.1,0.2],</span></div><div><span style="font-size: 10pt;">    'n_estimators':[20,100,200],</span></div><div><span style="font-size: 10pt;">    'max_depth':[3,5,7,9],</span></div><div><span style="font-size: 10pt;">    'min_child_weight':[0.5,1,2],</span></div><div><span style="font-size: 10pt;">    'min_child_samples':[5,10,20],</span></div><div><span style="font-size: 10pt;">    'subsample':[0.8],</span></div><div><span style="font-size: 10pt;">    'colsample_bytree':[0.8],</span></div><div><span style="font-size: 10pt;">    'verbose':[-1],</span></div><div><span style="font-size: 10pt;">    'num_leaves':[80]</span></div><div><span style="font-size: 10pt;">}]</span></div><div><span style="font-size: 10pt;">#グリッドサーチ実行</span></div><div><span style="font-size: 10pt;"># ＜GridSearchCVの主な引数＞</span></div><div><span style="font-size: 10pt;"># estimator: チューニングを行うモデル。fit()などの関数を持ち、sklearn.base.BaseEstimatorを継承したクラスから作られたモデルである必要がある</span></div><div><span style="font-size: 10pt;"># param_grid: パラメタ候補値を「パラメタ名, 候補値リスト」の辞書で与える</span></div><div><span style="font-size: 10pt;"># n_jobs: 同時実行数(-1にするとコア数で同時実行)</span></div><div><span style="font-size: 10pt;"># refit: Trueだと最良だったパラメタを使い学習データ全体で再学習する</span></div><div><span style="font-size: 10pt;"># cv: Cross validationの分割数(default: 3分割)</span></div><div><span style="font-size: 10pt;"># verbose: ログ出力レベル</span></div><div><span style="font-size: 10pt; font-weight: bold;">classifier = GridSearchCV(lgb.LGBMClassifier(), parameters, cv=3, n_jobs=-1)</span></div><div><span style="font-size: 10pt;">classifier.fit(X_train, y_train)</span></div><div><span style="font-size: 10pt;">print(&quot;Accuracy score (train): &quot;, classifier.score(X_train, y_train))</span></div><div><span style="font-size: 10pt;">print(&quot;Accuracy score (test): &quot;, classifier.score(X_test, y_test))</span></div><div><span style="font-size: 10pt;">print(classifier.best_estimator_) # ベストのパラメーター</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># RankGauss(数値変数を順位に変換した後、順位保持したまま無理やり分布を正規分布にする)</span></div><div><span style="font-size: 10pt;">from sklearn.preprocessing import</span> <span style="font-size: 10pt; font-weight: bold;">QuantileTransformer</span></div><div><span style="font-size: 10pt;"># 学習データからRankGaussの変換定義</span></div><div><span style="font-size: 10pt;">transformer = </span><span style="font-size: 10pt; font-weight: bold;">QuantileTransformer</span><span style="font-size: 10pt;">(n_quantiles=100, random_state=0, output_distribution='normal')</span></div><div><span style="font-size: 10pt; font-weight: bold;">transformer.fit(train_x['col'])</span></div><div><span style="font-size: 10pt;"># 変換後のデータで置換</span></div><div><span style="font-size: 10pt;">train_x['col'] = </span><span style="font-size: 10pt; font-weight: bold;">transformer.transform</span><span style="font-size: 10pt;">(train_x['col'])</span></div><div><span style="font-size: 10pt;">test_x['col'] = </span><span style="font-size: 10pt; font-weight: bold;">transformer.transform</span><span style="font-size: 10pt;">(test_x['col'])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 学習データを特徴量と目的変数に分ける</span></div><div><span style="font-size: 10pt;">train_x = train.drop(['Survived'], axis=1)</span></div><div><span style="font-size: 10pt;">train_y = train['Survived']</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 予測値の加重平均をとる</span></div><div><span style="font-size: 10pt;">pred = pred_xgb * 0.8 + pred_lr * 0.2</span></div><div><span style="font-size: 10pt;">pred_label = np.where(pred &gt; 0.5, 1, 0)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># hold-out法でのバリデーションデータの分割</span></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.model_selection import train_test_split</span></div><div><span style="font-size: 10pt;"># train_test_split関数を用いてhold-out法で分割する</span></div><div><span style="font-size: 10pt;">tr_x, va_x, tr_y, va_y =</span> <span style="font-size: 10pt; font-weight: bold;">train_test_split</span><span style="font-size: 10pt;">(train_x, train_y,</span></div><div><span style="font-size: 10pt;">                                          test_size=0.25, random_state=71, shuffle=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># クロスバリデーションを行う</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 学習データを4つに分割し、うち1つをバリデーションデータとすることを、バリデーションデータを変えて繰り返す</span></div><div><span style="font-size: 10pt;">from sklearn.metrics import log_loss, accuracy_score</span></div><div><span style="font-size: 10pt;">from sklearn.model_selection import</span> <span style="font-size: 10pt; font-weight: bold;">KFold</span></div><div><span style="font-size: 10pt;">scores_accuracy = []</span></div><div><span style="font-size: 10pt;">scores_logloss = []</span></div><div><span style="font-size: 10pt; font-weight: bold;">kf = KFold(n_splits=4, shuffle=True, random_state=71)</span></div><div><span style="font-size: 10pt;">for tr_idx, va_idx in kf.split(train_x):</span></div><div><span style="font-size: 10pt;">    # 学習データを学習データとバリデーションデータに分ける</span></div><div><span style="font-size: 10pt;">    tr_x, va_x = train_x.iloc[tr_idx], train_x.iloc[va_idx]</span></div><div><span style="font-size: 10pt;">    tr_y, va_y = train_y.iloc[tr_idx], train_y.iloc[va_idx]</span></div><div><span style="font-size: 10pt;">    # モデルの学習を行う</span></div><div><span style="font-size: 10pt;">    model = XGBClassifier(n_estimators=20, random_state=71)</span></div><div><span style="font-size: 10pt;">    model.fit(tr_x, tr_y)</span></div><div><span style="font-size: 10pt;">    # バリデーションデータの予測値を確率で出力する</span></div><div><span style="font-size: 10pt;">    va_pred = model.predict_proba(va_x)[:, 1]</span></div><div><span style="font-size: 10pt;">    # バリデーションデータでのスコアを計算する</span></div><div><span style="font-size: 10pt;">    logloss = log_loss(va_y, va_pred)</span></div><div><span style="font-size: 10pt;">    accuracy = accuracy_score(va_y, va_pred &gt; 0.5)</span></div><div><span style="font-size: 10pt;">    # そのfoldのスコアを保存する</span></div><div><span style="font-size: 10pt;">    scores_logloss.append(logloss)</span></div><div><span style="font-size: 10pt;">    scores_accuracy.append(accuracy)</span></div><div><span style="font-size: 10pt;"># 各foldのスコアの平均を出力する</span></div><div><span style="font-size: 10pt;">logloss = np.mean(scores_logloss)</span></div><div><span style="font-size: 10pt;">accuracy = np.mean(scores_accuracy)</span></div><div><span style="font-size: 10pt;">print(f'logloss: {logloss:.4f}, accuracy: {accuracy:.4f}')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># StratifiedKFoldクラスでどの各foldもラベルの割合が均一になるように</span><span style="font-size: 10pt; font-weight: bold;">クロスバリデーションを</span><span style="font-size: 10pt; font-weight: bold;">行う</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.model_selection import StratifiedKFold</span></div><div><span style="font-size: 10pt;">kf =</span> <span style="font-size: 10pt; font-weight: bold;">StratifiedKFold</span><span style="font-size: 10pt;">(n_splits=4, shuffle=True, random_state=71)</span></div><div><span style="font-size: 10pt;">for tr_idx, va_idx in kf.split(train_x, train_y):</span></div><div><span style="font-size: 10pt;">    tr_x, va_x = train_x.iloc[tr_idx], train_x.iloc[va_idx]</span></div><div><span style="font-size: 10pt;">    tr_y, va_y = train_y.iloc[tr_idx], train_y.iloc[va_idx]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># leave-one-out(validation set 1件だけにしてそれ以外すべてtrain setにするクロスバリデーション。データ数分foldができる)</span></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.model_selection import LeaveOneOut</span></div><div><span style="font-size: 10pt;">loo =</span> <span style="font-size: 10pt; font-weight: bold;">LeaveOneOut</span><span style="font-size: 10pt;">()</span></div><div><span style="font-size: 10pt;">for tr_idx, va_idx in loo.split(train_x):</span></div><div><span style="font-size: 10pt;">    tr_x, va_x = train_x.iloc[tr_idx], train_x.iloc[va_idx]</span></div><div><span style="font-size: 10pt;">    tr_y, va_y = train_y.iloc[tr_idx], train_y.iloc[va_idx]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 時系列データのhold-out法</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 変数periodを基準に分割することにする（0から3までが学習データ、4がテストデータとする）</span></div><div><span style="font-size: 10pt; font-weight: bold;"># ここでは、学習データのうち、変数periodが3のデータをバリデーションデータとし、0から2までのデータを学習に用いる</span></div><div><span style="font-size: 10pt;">is_tr = train_x['period'] &lt; 3</span></div><div><span style="font-size: 10pt;">is_va = train_x['period'] == 3</span></div><div><span style="font-size: 10pt;">tr_x, va_x = train_x[is_tr], train_x[is_va]</span></div><div><span style="font-size: 10pt;">tr_y, va_y = train_y[is_tr], train_y[is_va]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 時系列データのクロスバリデーション（時系列に沿って行う方法）</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 変数periodを基準に分割することにする（0から3までが学習データ、4がテストデータとする）</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 変数periodが1, 2, 3のデータをそれぞれバリデーションデータとし、それ以前のデータを学習に使う</span></div><div><span style="font-size: 10pt;">va_period_list = [1, 2, 3]</span></div><div><span style="font-size: 10pt;">for va_period in va_period_list:</span></div><div><span style="font-size: 10pt;">    is_tr = train_x['period'] &lt; va_period</span></div><div><span style="font-size: 10pt;">    is_va = train_x['period'] == va_period</span></div><div><span style="font-size: 10pt;">    tr_x, va_x = train_x[is_tr], train_x[is_va]</span></div><div><span style="font-size: 10pt;">    tr_y, va_y = train_y[is_tr], train_y[is_va]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 時系列データのクロスバリデーション（単純に時間で分割する方法）</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 変数periodを基準に分割することにする（0から3までが学習データ、4がテストデータとする）</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 変数periodが0, 1, 2, 3のデータをそれぞれバリデーションデータとし、それ以外の学習データを学習に使う</span></div><div><span style="font-size: 10pt;">va_period_list = [0, 1, 2, 3]</span></div><div><span style="font-size: 10pt;">for va_period in va_period_list:</span></div><div><span style="font-size: 10pt;">    is_tr = train_x['period'] != va_period</span></div><div><span style="font-size: 10pt;">    is_va = train_x['period'] == va_period</span></div><div><span style="font-size: 10pt;">    tr_x, va_x = train_x[is_tr], train_x[is_va]</span></div><div><span style="font-size: 10pt;">    tr_y, va_y = train_y[is_tr], train_y[is_va]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># マルチラベル分類の評価指標</span></div><div><span style="font-size: 10pt; font-weight: bold;"># mean-f1ではレコードごとにF1-scoreを計算して平均をとる</span></div><div><span style="font-size: 10pt; font-weight: bold;"># macro-f1ではクラスごとにF1-scoreを計算して平均をとる</span></div><div><span style="font-size: 10pt; font-weight: bold;"># micro-f1ではレコード×クラスのペアごとにTP/TN/FP/FNを計算し、F1-scoreを求める</span></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.metrics import f1_score</span></div><div><span style="font-size: 10pt;"># 真の値 - [[1,2], [1], [1,2,3], [2,3], [3]]</span></div><div><span style="font-size: 10pt;">y_true = np.array([[1, 1, 0],</span></div><div><span style="font-size: 10pt;">                   [1, 0, 0],</span></div><div><span style="font-size: 10pt;">                   [1, 1, 1],</span></div><div><span style="font-size: 10pt;">                   [0, 1, 1],</span></div><div><span style="font-size: 10pt;">                   [0, 0, 1]])</span></div><div><span style="font-size: 10pt;"># 予測値 - [[1,3], [2], [1,3], [3], [3]]</span></div><div><span style="font-size: 10pt;">y_pred = np.array([[1, 0, 1],</span></div><div><span style="font-size: 10pt;">                   [0, 1, 0],</span></div><div><span style="font-size: 10pt;">                   [1, 0, 1],</span></div><div><span style="font-size: 10pt;">                   [0, 0, 1],</span></div><div><span style="font-size: 10pt;">                   [0, 0, 1]])</span></div><div><span style="font-size: 10pt; font-weight: bold;">mean_f1 = f1_score(y_true, y_pred, average='samples')</span></div><div><span style="font-size: 10pt; font-weight: bold;">macro_f1 = f1_score(y_true, y_pred, average='macro')</span></div><div><span style="font-size: 10pt; font-weight: bold;">micro_f1 = f1_score(y_true, y_pred, average='micro')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># quadratic weighted kappa クラス間に順序関係があるマルチクラス分類 完全な予測を行なった場合は 1</span></div><div><span style="font-size: 10pt; font-weight: bold;">from sklearn.metrics import cohen_kappa_score</span></div><div><span style="font-size: 10pt;">kappa =</span> <span style="font-size: 10pt; font-weight: bold;">cohen_kappa_score</span><span style="font-size: 10pt;">(y_true, y_pred,</span> <span style="font-size: 10pt; font-weight: bold;">weights='quadratic'</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 線形回帰の重み（</span><span style="font-size: 10pt; font-weight: bold;">パラメータの寄与</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt;">from sklearn import linear_model</span></div><div><span style="font-size: 10pt;">import sklearn.model_selection</span></div><div><span style="font-size: 10pt;">X_train, X_test, y_train, y_test = sklearn.model_selection.train_test_split(X, y)</span></div><div><span style="font-size: 10pt;">model = linear_model.LinearRegression()</span></div><div><span style="font-size: 10pt;">model.fit(X_train, y_train)</span></div><div><span style="font-size: 10pt; font-weight: bold;">coef = pd.DataFrame({&quot;feature_names&quot;:X.columns, &quot;coefficient&quot;:model.coef_})</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># ランダムフォレストの特徴量の重要度(</span><span style="font-size: 10pt; font-weight: bold;">feature_importances</span><span style="font-size: 10pt; font-weight: bold;">)</span></font></div><div><span style="font-size: 10pt;">from sklearn.ensemble import RandomForestClassifier</span></div><div><span style="font-size: 10pt;">clf = RandomForestClassifier(n_estimators=10, random_state=71)</span></div><div><span style="font-size: 10pt;">clf.fit(train_x, train_y)</span></div><div><span style="font-size: 10pt;">fi = clf.feature_importances_</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">決定木やランダムフォレストで使用された特徴量を可視化する関数</span></font></div><div><span style="font-size: 10pt;">def plot_feature_importance(model, X):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    決定木やランダムフォレストで使用された特徴量を可視化する</span></div><div><span style="font-size: 10pt;">    </span><a href="https://qiita.com/takapy0210/items/73415599579f2588080e" style="font-size: 10pt;">https://qiita.com/takapy0210/items/73415599579f2588080e</a></div><div><span style="font-size: 10pt;">    Usage:</span></div><div><span style="font-size: 10pt;">        # ランダムフォレスト</span></div><div><span style="font-size: 10pt;">        from sklearn.ensemble import RandomForestClassifier</span></div><div><span style="font-size: 10pt;">        forest = RandomForestClassifier(n_estimators=100, random_state=20181101) # n_estimatorsは構築する決定木の数</span></div><div><span style="font-size: 10pt;">        forest.fit(X_train, y_train)</span></div><div><span style="font-size: 10pt;">        # 表示</span></div><div><span style="font-size: 10pt;">        plot_feature_importance(forest, X_train)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    n_features = X.shape[1]</span></div><div><span style="font-size: 10pt;">    plt.barh(range(n_features), model.feature_importances_, align='center')</span></div><div><span style="font-size: 10pt;">    plt.yticks(np.arange(n_features), X.columns)</span></div><div><span style="font-size: 10pt;">    plt.xlabel('Feature importance')</span></div><div><span style="font-size: 10pt;">    plt.ylabel('Feature')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 分類のランダムフォレストの例</span></div><div><span style="font-size: 10pt;">from sklearn.ensemble import RandomForestClassifier</span></div><div><span style="font-size: 10pt;">import sklearn.model_selection</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">y = df_cate['next_close_oepn_rate']</span></div><div><span style="font-size: 10pt;">X = df_cate.drop('next_close_oepn_rate', axis=1)</span></div><div><span style="font-size: 10pt;">X_train, X_test, y_train, y_test = sklearn.model_selection.train_test_split(X, y)  # train/test setに分ける</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">clf = RandomForestClassifier(n_estimators=10, random_state=71)  # </span><span style="font-size: 10pt; font-weight: bold;">DecisionTreeClassifier(random_state=0) とかでも可能</span></font></div><div><span style="font-size: 10pt;">clf.fit(X_train, y_train)</span></div><div><span style="font-size: 10pt;">y_test_pred = clf.predict(X_test)</span></div><div><span style="font-size: 10pt;">results_test = pd.DataFrame({'y_test': y_test, 'y_pred':y_test_pred})</span></div><div><span style="font-size: 10pt;">display(results_test)</span></div><div><span style="font-size: 10pt;"># 精度評価</span></div><div><span style="font-size: 10pt;">correct = len(results_test[results_test[&quot;y_test&quot;] == results_test[&quot;y_pred&quot;]])</span></div><div><span style="font-size: 10pt;">data_count = len(results_test)</span></div><div><span style="font-size: 10pt;">print('acc:', correct/data_count)</span></div><div><span style="font-size: 10pt;"># feature_importances</span></div><div><span style="font-size: 10pt;">fi = clf.feature_importances_  </span></div><div><span style="font-size: 10pt;">print(fi)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># スタッキングの例</span></font></div><div><a href="https://github.com/ghmagazine/kagglebook/blob/master/ch07/ch07-01-stacking.py" style="font-size: 10pt;">https://github.com/ghmagazine/kagglebook/blob/master/ch07/ch07-01-stacking.py</a></div><div><span style="font-size: 10pt; font-weight: bold;">スタッキングは1段階目のモデルの予測値を次のモデルのtrainデータにして学習する。</span></div><div><span style="font-size: 10pt; font-weight: bold;">1段階目のモデルは必ずCVで複数モデル作成して、予測値の平均を次のモデルのtrainデータにしないとおかしくなるので注意</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 混同行列</span></font></div><div><span style="font-size: 10pt;">from sklearn.metrics import confusion_matrix</span></div><div><span style="font-size: 10pt;">import seaborn as sns</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">y_true = [0, 0, 0, 0, 0, 1, 1, 1, 1, 1]</span></div><div><span style="font-size: 10pt;">y_pred = [0, 1, 1, 1, 1, 0, 0, 0, 1, 1]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">cm = confusion_matrix(y_true, y_pred)</span></div><div><span style="font-size: 10pt;">sns.heatmap(cm, annot=True, cmap='Blues')</span></div><div><span style="font-size: 10pt;">plt.savefig('data/dst/sklearn_confusion_matrix_annot_blues.png')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■Optuna</span></font></div><div><span style="font-size: 10pt;">公式ドキュメントがわかりやすい: </span> <a href="https://optuna.readthedocs.io/en/stable/index.html" style="font-size: 10pt;">https://optuna.readthedocs.io/en/stable/index.html</a></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">objective関数で</span><span style="font-size: 10pt; font-weight: bold;">チューニングする構文例</span></font></div><div><span style="font-size: 10pt;">import optuna</span></div><div><span style="font-size: 10pt;">def f(x):</span></div><div><span style="font-size: 10pt;">    return x**4 - 4 * x ** 3 - 36 * x ** 2</span></div><div><span style="font-size: 10pt;">def objective(trial):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; 1変数の最小化 &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    x = trial.suggest_uniform('x', -10, 10)</span></div><div><span style="font-size: 10pt;">    return f(x)</span></div><div><span style="font-size: 10pt;">study = optuna.create_study(direction='minimize')</span></div><div><span style="font-size: 10pt;">study.optimize(objective, n_trials=100)</span></div><div><span style="font-size: 10pt;">print(f&quot;試行回数: {len(study.trials)}&quot;)</span></div><div><span style="font-size: 10pt;">print(f&quot;目的関数を最小化するbestパラメータ: {study.best_params}&quot;)</span></div><div><span style="font-size: 10pt;">print(f&quot;目的関数の最小値: {study.best_value}&quot;)</span></div><div><span style="font-size: 10pt;">print(f&quot;最小値を得た試行の情報: {study.best_trial}&quot;)</span></div><div><span style="font-size: 10pt;">print(f&quot;試行の履歴: {study.trials}&quot;)</span></div><div><span style="font-size: 10pt;">df_result = study.trials_dataframe()</span></div><div><span style="font-size: 10pt;">display(df_result.sort_values(by='value'))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">Objective</span><span style="font-size: 10pt; font-weight: bold;">クラス定義して、クラス変数に引数を複数渡してチューニングする構文例(</span><span style="font-size: 10pt; font-weight: bold;">objective関数の引数は基本trialだけだから</span><span style="font-size: 10pt; font-weight: bold;">)</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><span style="font-size: 10pt;">print(f&quot;optuna.__version__: {optuna.__version__}&quot;)</span></div><div><span style="font-size: 10pt;">import traceback</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">import argparse</span></div><div><span style="font-size: 10pt;">parser = argparse.ArgumentParser()</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--epochs&quot;, help=&quot;Number of epochs&quot;, type=int, required=True)</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--n_trials&quot;, help=&quot;Optuna num trials&quot;, type=int, default=10)</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--study_name&quot;, help=&quot;Optuna trials study name&quot;, type=str, default='study')</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--hidden_nums&quot;, nargs=&quot;+&quot;, help=&quot;Hidden nums. ex: 1 2 3&quot;, type=int, default=[1])</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--lr_min&quot;, help=&quot;Learning rate min&quot;, type=float, default=None)</span></div><div><span style="font-size: 10pt;">parser.add_argument(&quot;--lr_max&quot;, help=&quot;Learning rate max&quot;, type=float, default=None)</span></div><div><span style="font-size: 10pt;">args = parser.parse_args()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">class Objective(object):</span></div><div><span style="font-size: 10pt;">    def __init__(self):</span></div><div><span style="font-size: 10pt;">        # get dataset</span></div><div><span style="font-size: 10pt;">        self.dataset = get_dataset(args)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def trial_train(self, trial):</span></div><div><span style="font-size: 10pt;">        &quot;&quot;&quot; Train function for optuna &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">        global args</span></div><div><span style="font-size: 10pt;">        ## Hyper parameter setting</span></div><div><span style="font-size: 10pt;">        hidden_num = trial.suggest_categorical('hidden_num', args.hidden_nums) # リストから選択</span></div><div><span style="font-size: 10pt;">        args.lr = trial.suggest_loguniform('lr', args.lr_min, args.lr_max) # 最大最小範囲から10倍刻みで選択</span></div><div><span style="font-size: 10pt;">        trial.set_user_attr('batch_ratio', args.batch_ratio) # study.csvに表示したい属性値追加</span></div><div><span style="font-size: 10pt;">        </span></div><div><span style="font-size: 10pt;">        &quot;&quot;&quot; モデルの学習処理書く &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">        </span></div><div><span style="font-size: 10pt;">        return min(eval_metric) # Minimize metrics.</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def __call__(self, trial):</span></div><div><span style="font-size: 10pt;">        &quot;&quot;&quot; Objective function for optuna &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">        try: # optuna v0.18以上だとtryで囲まないとエラーでtrial落ちる</span></div><div><span style="font-size: 10pt;">            min_eval_metric= self.trial_train(trial)</span></div><div><span style="font-size: 10pt;">            return min_eval_metric</span></div><div><span style="font-size: 10pt;">        except Exception as e:</span></div><div><span style="font-size: 10pt;">            traceback.print_exc() # Exceptionが発生した際に表示される全スタックトレース表示</span></div><div><span style="font-size: 10pt;">            return e # 例外を返さないとstudy.csvにエラー内容が記載されない</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">if __name__ == '__main__':</span></div><div><span style="font-size: 10pt;">    study_name = args.study_name  # Unique identifier of the study.</span></div><div><span style="font-size: 10pt;">    study = optuna.create_study(study_name=study_name, storage=f&quot;sqlite:///{study_name}.db&quot;, load_if_exists=True)</span></div><div><span style="font-size: 10pt;">    study.optimize(Objective(), n_trials=args.n_trials)</span></div><div><span style="font-size: 10pt;">    study.trials_dataframe().to_csv(f&quot;{study_name}_history.csv&quot;, index=False)</span></div><div><span style="font-size: 10pt;">    print(f&quot;\nstudy.best_params:\n{study.best_params}&quot;)</span></div><div><span style="font-size: 10pt;">    print(f&quot;\nstudy.best_trial:\n{study.best_trial}&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># objective関数に引数追加するのは、クラス作る以外に、lambdaで変数渡してもいける</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><span style="font-size: 10pt;"># Objective function that takes three arguments.</span></div><div><span style="font-size: 10pt;">def objective(trial, min_x, max_x):</span></div><div><span style="font-size: 10pt;">    x = trial.suggest_uniform('x', min_x, max_x)</span></div><div><span style="font-size: 10pt;">    return (x - 2) ** 2</span></div><div><span style="font-size: 10pt;"># Extra arguments.</span></div><div><span style="font-size: 10pt;">min_x = -100</span></div><div><span style="font-size: 10pt;">max_x = 100</span></div><div><span style="font-size: 10pt;"># Execute an optimization by using the above objective function wrapped by `lambda`.</span></div><div><span style="font-size: 10pt;">study = optuna.create_study()</span></div><div><span style="font-size: 10pt;">study.optimize(lambda trial: objective(trial, min_x, max_x), n_trials=100)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># LightGBMの分類 + Optuna後、best paramで学習して予測する例</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import lightgbm as lgb</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><span style="font-size: 10pt;"># 目的関数</span></div><div><span style="font-size: 10pt;">def objective(trial):</span></div><div><span style="font-size: 10pt;">    learning_rate = trial.suggest_loguniform('learning_rate', 0.1,0.2),</span></div><div><span style="font-size: 10pt;">    n_estimators, = trial.suggest_int('n_estimators', 20, 200),</span></div><div><span style="font-size: 10pt;">    max_depth, = trial.suggest_int('max_depth', 3, 9),</span></div><div><span style="font-size: 10pt;">    min_child_weight = trial.suggest_loguniform('min_child_weight', 0.5, 2),</span></div><div><span style="font-size: 10pt;">    min_child_samples, = trial.suggest_int('min_child_samples', 5, 20),</span></div><div><span style="font-size: 10pt;">    # 分類</span></div><div><span style="font-size: 10pt;">    classifier = lgb.LGBMClassifier(learning_rate=learning_rate,</span></div><div><span style="font-size: 10pt;">                                    n_estimators=n_estimators,</span></div><div><span style="font-size: 10pt;">                                    max_depth=max_depth,</span></div><div><span style="font-size: 10pt;">                                    min_child_weight=min_child_weight,</span></div><div><span style="font-size: 10pt;">                                    min_child_samples=min_child_samples,</span></div><div><span style="font-size: 10pt;">                                    subsample=0.8, colsample_bytree=0.8,</span></div><div><span style="font-size: 10pt;">                                    verbose=-1, num_leaves=80)</span></div><div><span style="font-size: 10pt;">    classifier.fit(X_train, y_train)</span></div><div><span style="font-size: 10pt;">    #return classifier.score(X_train, y_train) # 正答率（train） の最適化</span></div><div><span style="font-size: 10pt;">    return np.linalg.norm(y_train - classifier.predict_proba(X_train)[:, 1], ord=1) # 尤度の最適化</span></div><div><span style="font-size: 10pt;">#study = optuna.create_study(direction='maximize') # 最大化</span></div><div><span style="font-size: 10pt;">study = optuna.create_study(direction='minimize') # 最小化</span></div><div><span style="font-size: 10pt;">study.optimize(objective, n_trials=100)</span></div><div><span style="font-size: 10pt;"># lightgbmでは得られた最適パラメータを**study.best_params を用いて代入して、チューニング後の分類器を作れる</span></div><div><span style="font-size: 10pt;">classifier = lgb.LGBMClassifier(**study.best_params,</span></div><div><span style="font-size: 10pt;">                                subsample=0.8, colsample_bytree=0.8,</span></div><div><span style="font-size: 10pt;">                                verbose=-1, num_leaves=80)</span></div><div><span style="font-size: 10pt;">classifier.fit(X_train, y_train) #  ベストな分類器で学習</span></div><div><span style="font-size: 10pt;">print(classifier.score(X_test, y_test)) #  そして予測</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># パラメータを生成するような関数だけ切り出して定義して、LightGBMの分類 + Optuna</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import lightgbm as lgb</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Optunaのログメッセージを抑制</span></div><div><span style="font-size: 10pt;">optuna.logging.set_verbosity(optuna.logging.WARNING)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">def get_boosting_parameter_suggestions(trial) -&gt; dict:</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    Get parameter sample for Boosting (like XGBoost, LightGBM)</span></div><div><span style="font-size: 10pt;">    </span><a href="https://nykergoto.hatenablog.jp/entry/2019/03/29/%E5%8B%BE%E9%85%8D%E3%83%96%E3%83%BC%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E5%A4%A7%E4%BA%8B%E3%81%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E6%B0%97%E6%8C%81%E3%81%A1" style="font-size: 10pt;">https://nykergoto.hatenablog.jp/entry/2019/03/29/%E5%8B%BE%E9%85%8D%E3%83%96%E3%83%BC%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%A7%E5%A4%A7%E4%BA%8B%E3%81%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AE%E6%B0%97%E6%8C%81%E3%81%A1</a></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        trial(trial.Trial):</span></div><div><span style="font-size: 10pt;">    Returns:</span></div><div><span style="font-size: 10pt;">        dict: parameter sample generated by trial object</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    return {</span></div><div><span style="font-size: 10pt;">        # 木の最大の深さ</span></div><div><span style="font-size: 10pt;">        # たとえば 5 の時各弱学習木のぶん機は最大でも5に制限される.</span></div><div><span style="font-size: 10pt;">        'max_depth': trial.suggest_int('max_depth', low=3, high=8),</span></div><div><span style="font-size: 10pt;">        # 葉の数</span></div><div><span style="font-size: 10pt;">        # 決定木の複雑度を調整します。num_leavesの値が高すぎると過学習となり、低すぎると未学習</span></div><div><span style="font-size: 10pt;">        'num_leaves': trial.suggest_int('num_leaves', 5, 1000),</span></div><div><span style="font-size: 10pt;">        # 決定木のノード（葉）の最小データ数</span></div><div><span style="font-size: 10pt;">        # 値が高いと決定木が深く育つのを抑えるため過学習防ぎますが、逆に未学習となる場合もあり</span></div><div><span style="font-size: 10pt;">        'min_data_in_leaf': trial.suggest_int('num_leaves', 0, 100000),</span></div><div><span style="font-size: 10pt;">        # L2 正則化</span></div><div><span style="font-size: 10pt;">        'reg_lambda': trial.suggest_loguniform('reg_lambda', 1e-3, 1e3),</span></div><div><span style="font-size: 10pt;">        # L1 正則化</span></div><div><span style="font-size: 10pt;">        'reg_alpha': trial.suggest_loguniform('reg_alpha', 1e-3, 1e3),</span></div><div><span style="font-size: 10pt;">        # 弱学習木ごとに使う特徴量の割合</span></div><div><span style="font-size: 10pt;">        # 0.5 だと全体のうち半分の特徴量を最初に選んで, その範囲内で木を成長させる</span></div><div><span style="font-size: 10pt;">        'colsample_bytree': trial.suggest_loguniform('colsample_bytree', 0.5, 1.0),</span></div><div><span style="font-size: 10pt;">        # 学習データ全体のうち使用する割合</span></div><div><span style="font-size: 10pt;">        # colsample とは反対に row 方向にサンプルする</span></div><div><span style="font-size: 10pt;">        'subsample': trial.suggest_loguniform('subsample', 0.5, 1.0),</span></div><div><span style="font-size: 10pt;">        # 末端ノードに含まれる最小のサンプル数</span></div><div><span style="font-size: 10pt;">        # これを下回るような分割は作れなくなるため, 大きく設定するとより全体の傾向でしか分割ができなくなる</span></div><div><span style="font-size: 10pt;">        # [NOTE]: 数であるのでデータセットの大きさ依存であることに注意</span></div><div><span style="font-size: 10pt;">        # 過最小値である0に設定すると、モデルの制約が緩和され、学習しやすくなる。増加することで過学習を減らす</span></div><div><span style="font-size: 10pt;">        'min_child_samples': trial.suggest_int('min_child_samples', 5, 500),</span></div><div><span style="font-size: 10pt;">        'min_child_weight': trial.suggest_int('min_child_weight', 5, 500),</span></div><div><span style="font-size: 10pt;">        # たくさん作った木を足し合わせるときに使う重み係数</span></div><div><span style="font-size: 10pt;">        'learning_rate': trial.suggest_loguniform('learning_rate', 1e-5, 1.0),</span></div><div><span style="font-size: 10pt;">        # データの特徴量のfeature_fraction * 100 % だけ使用する</span></div><div><span style="font-size: 10pt;">        # 過学習している場合はこの値を下げる</span></div><div><span style="font-size: 10pt;">        'feature_fraction': trial.suggest_uniform('feature_fraction', 0.0, 1.0),</span></div><div><span style="font-size: 10pt;">        # 構築する決定木の数</span></div><div><span style="font-size: 10pt;">        # 「大きい値で精度確認する過程で小さい値の結果も分かる」からパラメータサーチせずEarlyStoppingで制御する</span></div><div><span style="font-size: 10pt;">        'n_estimators': 10000  # 大きめにとっておく</span></div><div><span style="font-size: 10pt;">    }</span></div><div><span style="font-size: 10pt;"># 目的関数</span></div><div><span style="font-size: 10pt;">def objective(trial):</span></div><div><span style="font-size: 10pt;">    params = get_boosting_parameter_suggestions(trial)</span></div><div><span style="font-size: 10pt;">    # 分類</span></div><div><span style="font-size: 10pt;">    classifier = lgb.LGBMClassifier(**params, random_state=42)</span></div><div><span style="font-size: 10pt;">    classifier.fit(X_train, y_train</span></div><div><span style="font-size: 10pt;">                   , eval_set=[(X_test, y_test)], early_stopping_rounds=100, verbose=0)</span></div><div><span style="font-size: 10pt;">    return np.linalg.norm(y_train - classifier.predict_proba(X_train)[:, 1], ord=1) # 尤度の最適化</span></div><div><span style="font-size: 10pt;">study = optuna.create_study(direction='minimize') # 最小化</span></div><div><span style="font-size: 10pt;">study.optimize(objective, n_trials=100)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># jupyterで目的関数の値の履歴可視化</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><span style="font-size: 10pt;">study_name = 'study'</span></div><div><span style="font-size: 10pt;">storage = storage=f&quot;sqlite:///output/study_history.db&quot;</span></div><div><span style="font-size: 10pt;">study = optuna.study.load_study(study_name, storage)</span></div><div><span style="font-size: 10pt;">optuna.visualization.plot_intermediate_values(study)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 目的関数の値の履歴可視化関数</span></div><div><span style="font-size: 10pt;">%matplotlib inline</span></div><div><span style="font-size: 10pt;">import matplotlib.pyplot as plt</span></div><div><span style="font-size: 10pt;">def plot_study_value(study, ylabel='value'):</span></div><div><span style="font-size: 10pt;">    if ylabel == 'value':</span></div><div><span style="font-size: 10pt;">        plt.plot([trial.value for trial in study.trials])</span></div><div><span style="font-size: 10pt;">        plt.ylabel(ylabel)</span></div><div><span style="font-size: 10pt;">    elif ylabel == 'params_x': # パラメータxの履歴可視化する場合</span></div><div><span style="font-size: 10pt;">        plt.plot([trial.params['x'] for trial in study.trials])</span></div><div><span style="font-size: 10pt;">        plt.ylabel(ylabel)</span></div><div><span style="font-size: 10pt;">    plt.grid()</span></div><div><span style="font-size: 10pt;">    plt.xlabel('trial')</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><span style="font-size: 10pt;">    plt.clf()</span></div><div><span style="font-size: 10pt;">plot_study(study)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># optunaのstudy.dbロード</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">study_name = 'study'</span></div><div><span style="font-size: 10pt;">output_dir = 'outdir'</span></div><div><span style="font-size: 10pt;">storage = storage=f&quot;sqlite:///{output_dir}/{study_name}.db&quot;</span></div><div><span style="font-size: 10pt;">study = optuna.study.load_study(study_name, storage)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">study.trials_dataframe().to_csv(f&quot;{output_dir}/{study_name}_history.csv&quot;, index=False)</span></div><div><span style="font-size: 10pt;">print(f&quot;\nstudy.best_params:\n{study.best_params}&quot;)</span></div><div><span style="font-size: 10pt;">print(f&quot;\nstudy.best_trial:\n{study.best_trial}&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■papermill</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># コマンドラインからnotebook実行</span></div><div><span style="font-size: 10pt;"># cudaの環境変数</span></div><div><span style="font-size: 10pt;">export PATH=/usr/local/cuda-8.0/bin:${PATH}</span></div><div><span style="font-size: 10pt;">export LD_LIBRARY_PATH=/usr/local/cuda-8.0/lib64:${LD_LIBRARY_PATH}</span></div><div><span style="font-size: 10pt;">export CUDA_HOME=/usr/local/cuda-8.0</span></div><div><span style="font-size: 10pt;">export KERAS_BACKEND=tensorflow</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"># 絶対パスなら環境切り替えなくてもpapermill実行できる</span></div><div><span style="font-size: 10pt;">PAPERMILL=/gpfsx01/home/bioinfo/.conda/envs/tfgpu_py36/bin/papermill</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">${PAPERMILL} multilabel.ipynb hERG_scaffold_multilabel.ipynb -p num_epoch 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pythonからnotebook実行</span></div><div><span style="font-size: 10pt;">import papermill as pm</span></div><div><span style="font-size: 10pt;">pm.execute_notebook('test.ipynb', 'output/out_test.ipynb', parameters = dict(i=1, j=0.1))</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■condaコマンド</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 環境一覧確認</span></div><div><span style="font-size: 10pt;">$ conda info -e</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 環境移動</span></div><div><span style="font-size: 10pt;">source activate py36</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 環境作成（python3.6もインストール）</span></div><div><span style="font-size: 10pt;">conda create -n py36 python=3.6</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 環境削除</span></div><div><span style="font-size: 10pt;">$ conda remove -n py36 --all</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ymlファイル作成</span></div><div><span style="font-size: 10pt;">$ conda env export --no-builds &gt; ./tfgpu.yml</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ymlから環境構築</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">※</span><span style="font-size: 10pt; font-weight: bold;">ymlの最後の行の</span><span style="font-size: 10pt; font-weight: bold;">prefix…</span><span style="font-size: 10pt; font-weight: bold;">は元環境のpathなので削除すること！！！</span></font></div><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(249, 249, 249);"><span style="background-color: rgb(249, 249, 249);"><span style="background-color: rgb(249, 249, 249);"><span style="background-color: rgb(249, 249, 249);"><span style="background-color: rgb(249, 249, 249);"><span style="background-color: rgb(249, 249, 249); font-size: 10pt; color: rgb(0, 0, 0); font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">※ResolvePackageNotFoundで実行失敗する場合は、エラーのパッケージ行をymlファイルから削除して再実行すること</span></span></span></span></span></span></div><div><span style="font-size: 10pt;">$ conda env create --file ./tfgpu.yml</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■selenium</span></div><div><span style="font-size: 10pt;">※Firefoxでselenium使うのにgeckodriverをダウンロードして、PATHに追加しないと動かない</span></div><div><span style="font-size: 10pt;">　参考:</span><a href="https://qiita.com/hujuu/items/3df7c75fc0297965ceb6" style="font-size: 10pt;">https://qiita.com/hujuu/items/3df7c75fc0297965ceb6</a></div><div><span style="font-size: 10pt;">※Chromeはドライバーダウンロードして、ドライバーを指定しないと動かない</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 実行テスト（FirefoxでGoogle開く）</span></div><div><span style="font-size: 10pt;">from selenium import webdriver</span></div><div><span style="font-size: 10pt;">with webdriver.Firefox() as driver:</span></div><div><span style="font-size: 10pt;">    driver.get(&quot;</span><a href="http://google.com/" style="font-size: 10pt;">http://google.com</a><span style="font-size: 10pt;">&quot;)</span></div><div><span style="font-size: 10pt;">    print(&quot;Page Title is : %s&quot; %driver.title)</span></div><div><span style="font-size: 10pt;">    driver.quit()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 指定urlのtableタグのデータをすべて取得</span></div><div><span style="font-size: 10pt;">def get_html_tables(url, driver=r&quot;C:\userApp\Selenium\chromedriver_win32\chromedriver.exe&quot;):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; seleniumで指定urlのtableタグのデータをすべて取得 &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    from selenium import webdriver</span></div><div><span style="font-size: 10pt;">    from selenium.webdriver.chrome.options import Options</span> <span style="font-size: 10pt; font-weight: bold;"># Chromeでのオプション指定</span></div><div><span style="font-size: 10pt;">    options = Options()</span></div><div><span style="font-size: 10pt;">    options.add_argument('--headless') </span> <span style="font-size: 10pt; font-weight: bold;"># webブラウザ非表示で処理する</span></div><div><span style="font-size: 10pt;">    driver = webdriver.Chrome(driver, options=options)</span> <span style="font-size: 10pt; font-weight: bold;"># クロームはドライバが必要</span></div><div><span style="font-size: 10pt;">    driver.get(url)</span></div><div><span style="font-size: 10pt;">    dfs = pd.read_html(driver.page_source, header = 0) # </span><span style="font-size: 10pt; font-weight: bold;">pd.read_htmlで</span><span style="font-size: 10pt; font-weight: bold;">指定urlのtableタグのデータをすべて取得できる。</span><span style="font-size: 10pt; font-weight: bold;">web画面に行かないと表示できないテーブルもあるため</span><span style="font-size: 10pt; font-weight: bold;">seleniumで指定urlにアクセスしている</span></div><div><span style="font-size: 10pt;">    driver.quit()</span> <span style="font-size: 10pt; font-weight: bold;"># ブラウザのタブ閉じる</span></div><div><span style="font-size: 10pt;">    return dfs</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># リンク名からクリック</span></div><div><span style="font-size: 10pt;">driver.find_element_by_link_text('IPO・PO').click()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># idタグの名前から</span><span style="font-size: 10pt; font-weight: bold;">クリック</span></font></div><div><span style="font-size: 10pt;">driver.find_element_by_name(&quot;ACT_login&quot;).click()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 画面の</span><span style="font-size: 10pt; font-weight: bold;">xpath</span><span style="font-size: 10pt; font-weight: bold;">から</span><span style="font-size: 10pt; font-weight: bold;">クリック</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">## find_element_by_xpathのパスはwebブラウザ→マウス左クリック検証→Copy →Copy Full Xpathでリンク先がわかる！！！</span></div><div><span style="font-size: 10pt;">driver.find_element_by_xpath('/html/body/div[6]/div[2]/div/div[2]/div[1]/ul/li[5]/a').click()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># ボタンクリックでファイルダウンロード自動化する関数参考</span></font></div><div><span style="font-size: 10pt;">def download_stock_csv(code_range: list, save_dir: str):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot; seleniumでYahoo!ファイナンスのCSVファイルダウンロード &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    # CSVファイルを自動で save_dir に保存するための設定</span></div><div><span style="font-size: 10pt;">    # 参考:</span> <a href="https://developer.mozilla.org/ja/docs/Download_Manager_preferences" style="font-size: 10pt;">https://developer.mozilla.org/ja/docs/Download_Manager_preferences</a></div><div><span style="font-size: 10pt;">    # Firefoxでダウンロードのリンクを踏んだとき保存確認ダイアログを出さずに指定のフォルダに保存する</span></div><div><span style="font-size: 10pt;">    profile = webdriver.FirefoxProfile()</span></div><div><span style="font-size: 10pt;">    profile.set_preference(&quot;browser.download.folderList&quot;, 2)  # ファイルをダウンロードする既定のフォルダ管理。2 の場合はbrowser.download.dirでユーザ定義フォルダ指定する</span></div><div><span style="font-size: 10pt;">    profile.set_preference(&quot;browser.download.manager.showWhenStarting&quot;, False)  # 保存確認ダイアログを出さない用にする</span></div><div><span style="font-size: 10pt;">    profile.set_preference(&quot;browser.download.dir&quot;, save_dir)  # 保存先指定</span></div><div><span style="font-size: 10pt;">    profile.set_preference(&quot;browser.helperApps.neverAsk.saveToDisk&quot;, &quot;text/csv&quot;)  # ファイルの種類指定？</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    driver = webdriver.Firefox(firefox_profile=profile)</span></div><div><span style="font-size: 10pt;">    driver.get('</span><a href="https://www.yahoo.co.jp/" style="font-size: 10pt;">https://www.yahoo.co.jp/</a><span style="font-size: 10pt;">')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    # ここで手動でログインを行う（ログイン自動化はむずそうだったかた手打ち）。ログインしたら enter</span></div><div><span style="font-size: 10pt;">    input('After login, press enter: ')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    for code in tqdm(code_range):</span></div><div><span style="font-size: 10pt;">        url = '</span><a href="https://stocks.finance.yahoo.co.jp/stocks/history/?code=" style="font-size: 10pt;">https://stocks.finance.yahoo.co.jp/stocks/history/?code=</a><span style="font-size: 10pt;">{0}.T'.format(code)</span></div><div><span style="font-size: 10pt;">        driver.get(url)</span></div><div><span style="font-size: 10pt;">        try:</span></div><div><span style="font-size: 10pt;">            driver.find_element_by_css_selector('a.stocksCsvBtn').click()</span></div><div><span style="font-size: 10pt;">        except NoSuchElementException:</span></div><div><span style="font-size: 10pt;">            pass</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■OpenCV</span></div><div><span style="font-size: 10pt;">import cv2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># グレースケールで画像ロード</span></div><div><span style="font-size: 10pt;">img = cv2.imread('sample.jpg',0) </span> <span style="font-size: 10pt; font-weight: bold;"># cv2.imread()でロードするとtypeがnumpyのデータになる</span></div><div><span style="font-size: 10pt;"># ※cv2.imreadで画像を読み込む。このとき画像はBGRになっている。</span></div><div><span style="font-size: 10pt;"># 　このままmatplotlibで表示しようとすると色がおかしくなるので注意が必要。</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># BGRとRGBを変換</span></div><div><span style="font-size: 10pt;">im_rgb = cv2.cvtColor(im_cv,</span> <span style="font-size: 10pt; font-weight: bold;">cv2.COLOR_BGR2RGB)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 画像を表示する</span></div><div><span style="font-size: 10pt;">cv2.imshow('image', img)</span></div><div><span style="font-size: 10pt;">cv2.waitKey(0)  # キーボード入力を処理する関数です．引数は入力待ち時間でミリ秒単位で指定</span></div><div><span style="font-size: 10pt;">cv2.destroyAllWindows()  # 現在までに作られた全てのウィンドウを閉じる関数</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 画像を保存する</span></div><div><span style="font-size: 10pt;">img = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)  # BGRに戻す</span></div><div><span style="font-size: 10pt;">cv2.imwrite('test.png', img)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■</span><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">scipy</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">正規分布のパーセント点関数ppf (Percent point function)のqの値を取得</span></font></div><div><span style="font-size: 10pt;">from scipy import stats</span></div><div><span style="font-size: 10pt;">stats.norm.ppf(q=0.84, loc=0, scale=1)  # q=0.84, 平均=0, 標準偏差=1</span></div><div><span style="font-size: 10pt;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/Image [2].png" type="image/png" data-filename="Image.png" width="267"/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Shapiro-Wilk（シャピロ-ウィルク）検定：データが正規分布しているか判断するための検定</span></div><div><span style="font-size: 10pt;"># 出力結果は（W, p値） p値&lt;0.05なら、帰無仮説=「正規分布である」を棄却して、正規分布でないと解釈</span></div><div><span style="font-size: 10pt;">import scipy.stats as stats</span></div><div><span style="font-size: 10pt; font-weight: bold;">stats.shapiro</span><span style="font-size: 10pt;">(df[col].dropna())  # 欠損あるとおなしくなるので、dropnaで欠損を削除</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■tempfile</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 一時ファイル作成して何か処理</span></div><div><span style="font-size: 10pt;">import tempfile</span></div><div><span style="font-size: 10pt;">with tempfile.NamedTemporaryFile(mode='w') as fp:</span> <span style="font-size: 10pt; font-weight: bold;"># with内から出ると一時ファイルfp自動削除 書き込む場合は</span><span style="font-size: 10pt; font-weight: bold;">mode='w' がいるみたい</span> <span style="font-size: 10pt; font-weight: bold;">tempfileは</span><span style="font-size: 10pt; font-weight: bold;">windowsだとエラーになる</span></div><div><a href="https://www.tssol.net/blog/2019/12/14/permission-error-errno-13-permission-denied-in-python-on-windows/" style="font-size: 10pt;">https://www.tssol.net/blog/2019/12/14/permission-error-errno-13-permission-denied-in-python-on-windows/</a></div><div><span style="font-size: 10pt;">    tmpname = str(fp.name)</span> <span style="font-size: 10pt; font-weight: bold;"># 一時ファイルのファイル名</span></div><div><span style="font-size: 10pt;">    print(tmpname)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■tqdm</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tqdm leave=False　このオプションでラベル付けと、処理が終わった時にプログレスバーが非表示になります</span></div><div><span style="font-size: 10pt;">for i in tqdm(range(100),desc='進捗具合',</span> <span style="font-size: 10pt; font-weight: bold;">leave=False</span><span style="font-size: 10pt;">):</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 標準出力にtqdmバー出力</span></div><div><span style="font-size: 10pt;">from tqdm import trange # tqdm(range(2))をtrange(2)で書ける</span></div><div><span style="font-size: 10pt;">for i in trange(2,</span> <span style="font-size: 10pt; font-weight: bold;">file=sys.stdout</span><span style="font-size: 10pt;">, desc='outer loop', leave=False):</span></div><div><span style="font-size: 10pt;">    do_something()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tqdmで説明文出す</span></div><div><span style="font-size: 10pt;">import time</span></div><div><span style="font-size: 10pt;">from tqdm import tqdm</span></div><div><span style="font-size: 10pt;">pbar = tqdm([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;])</span></div><div><span style="font-size: 10pt;">for char in pbar:</span></div><div><span style="font-size: 10pt;">    pbar.set_description(&quot;Processing %s&quot; % char)</span></div><div><span style="font-size: 10pt;">    time.sleep(1)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■sqlite</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Python3 x SQLite でリストをIN句に渡す</span></div><div><span style="font-size: 10pt;">codes = [7267, 2914]</span></div><div><span style="font-size: 10pt;">sql = f&quot;SELECT * FROM table AS P WHERE P.code IN (</span><span style="font-size: 10pt; font-weight: bold;">{', '.join('{}'.format(i) for i in codes)}</span><span style="font-size: 10pt;">)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■ファイル入出力</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイル書き込み</span></div><div><span style="font-size: 10pt;">fstr = 'aaa'</span></div><div><span style="font-size: 10pt;">with open('pdf.txt', mode='w') as f:</span></div><div><span style="font-size: 10pt;">    f.write(fstr, file=f)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ファイル1行ずつロード（データフレームに変換せず処理する）</span></div><div><span style="font-size: 10pt;">ifs = open(args.smi, 'r')</span></div><div><span style="font-size: 10pt;">for i, line in enumerate(ifs):</span></div><div><span style="font-size: 10pt;">    if str(pathlib.Path(args.smi).suffix) == '.csv':</span></div><div><span style="font-size: 10pt;">        words = line.split(',')</span></div><div><span style="font-size: 10pt;">    else:</span></div><div><span style="font-size: 10pt;">        words = line.split()</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold;">■type hint:関数の型に関する注釈(型アノテーション)</span></div><div><span style="font-size: 10pt; font-weight: bold;">※python 3.6から使える</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">def calc_distance(keras_model_path</span><span style="font-size: 10pt; font-weight: bold;">: str</span><span style="font-size: 10pt;">, paths</span><span style="font-size: 10pt; font-weight: bold;">: np.ndarray)</span> <span style="font-size: 10pt; font-weight: bold;">-&gt; np.ndarray:</span></div><div><span style="font-size: 10pt;">def csv_to_df(path</span><span style="font-size: 10pt; font-weight: bold;">: str='10'</span><span style="font-size: 10pt;">)</span> <span style="font-size: 10pt; font-weight: bold;">-&gt; pd.DataFrame:</span></div><div><span style="font-size: 10pt;">def hoge(x</span><span style="font-size: 10pt; font-weight: bold;">: int=10) -&gt; None: </span> <span style="font-size: 10pt;"># return無しの時はNoneでよい</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 型ヒントで、リストや辞書を使う場合や、intでもfloatなど複数の型がOKな場合の書き方</span></div><div><span style="font-size: 10pt; font-weight: bold;">from typing import Dict, List, Union</span></div><div><span style="font-size: 10pt;">def calc_billing_amount(</span></div><div><span style="font-size: 10pt;">    amount_list:</span> <span style="font-size: 10pt; font-weight: bold;">List[int]</span><span style="font-size: 10pt;">, price_dictionary:</span> <span style="font-size: 10pt; font-weight: bold;">Dict[str, Union[int, float]</span><span style="font-size: 10pt;">]</span></div><div><span style="font-size: 10pt;">) -&gt; int:</span></div><div><span style="font-size: 10pt;">    billing_amount = 0</span></div><div><span style="font-size: 10pt;">    for index, (key, value) in enumerate(price_dictionary.items()):</span></div><div><span style="font-size: 10pt;">        billing_amount += amount_list[index] * value</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    return int(billing_amount)</span></div><div><span style="font-size: 10pt;">amount = [3, 10]</span></div><div><span style="font-size: 10pt;">price = {&quot;item1&quot;: 100, &quot;item2&quot;: 30.5}</span></div><div><span style="font-size: 10pt;">calc_billing_amount(amount, price)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 自分で定義したオリジナルのクラスを型ヒントにする場合</span></div><div><span style="font-size: 10pt; font-weight: bold;">class User:</span></div><div><span style="font-size: 10pt;">    def __init__(self, name: str, user_type: str):</span></div><div><span style="font-size: 10pt;">        self.name = name</span></div><div><span style="font-size: 10pt;">        self.user_type = user_type</span></div><div><span style="font-size: 10pt;">def print_user_type(</span><span style="font-size: 10pt; font-weight: bold;">user: &quot;User&quot;</span><span style="font-size: 10pt;">) -&gt; str:</span></div><div><span style="font-size: 10pt;">    print(user.user_type)</span></div><div><span style="font-size: 10pt;">taro = User(&quot;taro&quot;, &quot;admin&quot;)</span></div><div><span style="font-size: 10pt;">print_user_type(taro)</span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■テスト駆動開発での関数のテスト関数</span></div><div><span style="font-size: 10pt;">def test_func():</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    テスト駆動開発での関数のテスト関数</span></div><div><span style="font-size: 10pt;">    test用関数はpythonパッケージの nose で実行するのがおすすめ($ conda install -c conda-forge nose などでインストール必要)</span></div><div><span style="font-size: 10pt;">    →noseは再帰的にディレクトリ探索して「Test」や「test」で始まるクラスとメソッドを実行する</span></div><div><span style="font-size: 10pt;">    $ cd &lt;このモジュールの場所&gt;</span></div><div><span style="font-size: 10pt;">    $ nosetests -v -s &lt;本モジュール&gt;.py  # 再帰的にディレクトリ探索して「Test」や「test」で始まるクラスとメソッドを実行。-s付けるとprint()の内容出してくれる</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    assert _func() == 0 # assertでテストケースチェックしていく. Trueなら何もしない</span></div><div><span style="font-size: 10pt;">    assert _func() == 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold; text-decoration: underline;">■その他</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pythonのpath確認</span></div><div><span style="font-size: 10pt;">import sys</span></div><div><span style="font-size: 10pt;">sys.executable</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pythonライブラリ追加方法（環境変数にいれる方法）</span></div><div><span style="font-size: 10pt;">export PYTHONPATH=&quot;$PYTHONPATH:/path/to/models&quot;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># pythonライブラリ追加方法（importから</span><span style="font-size: 10pt; font-weight: bold;">いれる方法）</span></font></div><div><span style="font-size: 10pt;">import os, sys, pathlib</span></div><div><span style="font-size: 10pt;">current_dir = pathlib.Path(__file__).resolve().parent</span></div><div><span style="font-size: 10pt;">sys.path.append(str(current_dir) + '/optuna-master/')</span></div><div><span style="font-size: 10pt;">import optuna</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 関数の定義確認はinspect.getsource()</span></div><div><span style="font-size: 10pt;">import inspect</span></div><div><span style="font-size: 10pt;">import requests</span></div><div><span style="font-size: 10pt;">inspect.getsource(requests.get) # requests の get 関数を調べる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">#</span><span style="font-size: 10pt; font-weight: bold;"> enumerateでループのindex取得</span></font></div><div><span style="font-size: 10pt;">for i, x in enumerate([1,2]):</span></div><div><span style="font-size: 10pt;">    print(i, x)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">if else文</span><span style="font-size: 10pt; font-weight: bold;">を1行で書く</span></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;">→三項演算子（</span><span style="font-size: 10pt; font-weight: bold;">三項演算子を使うことで代入の条件分岐を一行でスマートに記述することができる</span><span style="font-size: 10pt; font-weight: bold;">）: </span><span style="font-size: 10pt; font-weight: bold;">(変数) = (条件がTrueのときの値) if (条件) else (条件がFalseのときの値)</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">x = &quot;OK&quot; if n == 10 else &quot;NG&quot;</span></div><div><span style="font-size: 10pt;">↓</span></div><div><span style="font-size: 10pt;">if n == 10:</span></div><div><span style="font-size: 10pt;">    x = &quot;OK&quot;</span></div><div><span style="font-size: 10pt;">else :</span></div><div><span style="font-size: 10pt;">    x = &quot;NG&quot;</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">if elif文</span><span style="font-size: 10pt; font-weight: bold;">を1行で書く（</span><span style="font-size: 10pt; font-weight: bold;">三項演算子で書けるが見にくいからよろしくないかも</span><span style="font-size: 10pt; font-weight: bold;">）</span></font></div><div><span style="font-size: 10pt; font-weight: bold;">x = 9</span></div><div><span style="font-size: 10pt; font-weight: bold;">print(&quot;xは10未満です。&quot;) if x &lt; 10 else print(&quot;xは20以上です。&quot;) if x &gt;= 20 else print(&quot;xは20未満です。&quot;)</span></div><div><span style="font-size: 10pt;">↓</span></div><div><span style="font-size: 10pt;">x = 9</span></div><div><span style="font-size: 10pt;">if x &lt; 10:</span></div><div><span style="font-size: 10pt;">   print(&quot;xは10未満です。&quot;)</span></div><div><span style="font-size: 10pt;">elif x &gt;= 20:</span></div><div><span style="font-size: 10pt;">   print(&quot;xは20以上です。&quot;)</span></div><div><span style="font-size: 10pt;">else:</span></div><div><span style="font-size: 10pt;">   print(&quot;xは20未満です。&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">if文（elseなし）を1行で書く（</span><span style="font-size: 10pt; font-weight: bold;">三項演算子ではない。flake8の文法ではだめと言われるからよろしくないかも）</span></div><div><span style="font-size: 10pt;">x = 1</span></div><div><span style="font-size: 10pt; font-weight: bold;">if x == 3: print(&quot;Trueです。&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># スター式で1変数に複数要素詰める</span></div><div><span style="font-size: 10pt;">a, *b, c = 1, 2, 3, 4, 5</span></div><div><span style="font-size: 10pt;"># aは1, bは[2, 3, 4], cは5になる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 文字穴埋め（sqlのwhere句の値とかでよく使う）はformat()</span></div><div><span style="font-size: 10pt;">&quot;ddd_{}_ggg&quot;.format(&quot;aaa&quot;) # ddd_aaa_ggg</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># formatでprint</span></div><div><span style="font-size: 10pt;">print(&quot;INFO: save file. [{}] {}&quot;.format(out_dir+'/df_assay_vstack.csv', df_assay_vstack.shape))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 警告非表示</span></div><div><span style="font-size: 10pt;">import warnings</span></div><div><span style="font-size: 10pt;">warnings.filterwarnings(&quot;ignore&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># GPU確保</span></div><div><span style="font-size: 10pt;">import os</span></div><div><span style="font-size: 10pt;">gpu_num = &quot;3&quot;</span></div><div><span style="font-size: 10pt;">os.environ[&quot;CUDA_VISIBLE_DEVICES&quot;] = str(gpu_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 実行待ち</span></div><div><span style="font-size: 10pt;">from time import sleep</span></div><div><span style="font-size: 10pt;">sleep(3) # 3秒待つ</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">## generaterでファイルパス最後まで渡し続ける ##</span></div><div><span style="font-size: 10pt; font-weight: bold;">def generate_from_csv_dir(csv_dir, generate_func, csv_name=&quot;*.csv&quot;)</span><span style="font-size: 10pt;">:</span></div><div><span style="font-size: 10pt;">    pbar = tqdm(glob.glob(os.path.join(csv_dir, csv_name)))</span></div><div><span style="font-size: 10pt;">    for path in pbar:</span></div><div><span style="font-size: 10pt;">        pbar.set_description(path)</span></div><div><span style="font-size: 10pt;">        file_name = os.path.basename(path)</span></div><div><span style="font-size: 10pt;">        code = file_name.split('.')[0]</span></div><div><span style="font-size: 10pt;">        for d in generate_func(path, code):</span></div><div><span style="font-size: 10pt;">            </span><span style="font-size: 10pt; font-weight: bold;">yield d</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 単純にforでpath表示</span></div><div><span style="font-size: 10pt;">price_generator =</span> <span style="font-size: 10pt; font-weight: bold;">generate_from_csv_dir</span><span style="font-size: 10pt;">(csv_file_dir, generate_price_from_csv_file)</span></div><div><span style="font-size: 10pt;">for path in price_generator:</span></div><div><span style="font-size: 10pt;">    print(path)</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># sqliteの一括インサートで使う場合 </span></font></div><div><span style="font-size: 10pt;">def generate_price_from_csv_file(csv_file_name, code):</span></div><div><span style="font-size: 10pt;">    with open(csv_file_name, encoding=&quot;shift_jis&quot;) as f:</span></div><div><span style="font-size: 10pt;">        reader = csv.reader(f)</span></div><div><span style="font-size: 10pt;">        next(reader)  # 先頭行を飛ばす</span></div><div><span style="font-size: 10pt;">        for row in reader:</span></div><div><span style="font-size: 10pt;">            if '-' in row[0]:</span></div><div><span style="font-size: 10pt;">                d = datetime.datetime.strptime(row[0], '%Y-%m-%d').date()  # 日付</span></div><div><span style="font-size: 10pt;">            else:</span></div><div><span style="font-size: 10pt;">                d = datetime.datetime.strptime(row[0], '%Y/%m/%d').date()  # 日付</span></div><div><span style="font-size: 10pt;">            o = float(row[1])  # 初値</span></div><div><span style="font-size: 10pt;">            h = float(row[2])  # 高値</span></div><div><span style="font-size: 10pt;">            l = float(row[3])  # 安値</span></div><div><span style="font-size: 10pt;">            c = float(row[4])  # 終値</span></div><div><span style="font-size: 10pt;">            v = int(row[5])    # 出来高</span></div><div><span style="font-size: 10pt;">            yield code, d, o, h, l, c, v</span></div><div><span style="font-size: 10pt;">def all_csv_file_to_db(db_file_name, csv_file_dir):</span></div><div><span style="font-size: 10pt;">    price_generator =</span> <span style="font-size: 10pt; font-weight: bold;">generate_from_csv_dir</span><span style="font-size: 10pt;">(csv_file_dir, generate_price_from_csv_file)</span></div><div><span style="font-size: 10pt;">    conn = sqlite3.connect(db_file_name)</span></div><div><span style="font-size: 10pt;">    with conn:</span></div><div><span style="font-size: 10pt;">        sql = &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">        INSERT INTO raw_prices(code,date,open,high,low,close,volume)</span></div><div><span style="font-size: 10pt;">        VALUES(?,?,?,?,?,?,?)</span></div><div><span style="font-size: 10pt;">        &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">        conn.executemany(sql, price_generator)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># deepコピー</span></div><div><span style="font-size: 10pt;">import copy</span></div><div><span style="font-size: 10pt;">nega_posi = copy.deepcopy(series[2:])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 切り捨て</span></div><div><span style="font-size: 10pt;">4 // 3</span></div><div><span style="font-size: 10pt; font-weight: bold;"># 切り上げ</span></div><div><span style="font-size: 10pt;">-(-4 // 3)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># tabulate でlist やnumpy を表形式で標準出力する</span></div><div><span style="font-size: 10pt;">from tabulate import tabulate</span></div><div><span style="font-size: 10pt;">headers = [&quot;header1&quot;, &quot;header2&quot;,&quot;header3&quot;]</span></div><div><span style="font-size: 10pt;">table = [[1,2,3],[4,5,6],[7,8,9]]</span></div><div><span style="font-size: 10pt;">result = tabulate(table, headers, tablefmt=&quot;grid&quot;)</span></div><div><span style="font-size: 10pt;">print(result)</span></div><div><span style="font-size: 10pt;">result = tabulate(np.array(table), headers, tablefmt=&quot;grid&quot;)</span></div><div><span style="font-size: 10pt;">print(result)</span></div><div><span style="font-size: 10pt;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/Image [3].png" type="image/png" data-filename="Image.png" width="216"/></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># 辞書の追加</span></font></div><div><span style="font-size: 10pt;">d = {'k1': 1, 'k2': 2}</span></div><div><span style="font-size: 10pt;">d['k3'] = 3  # {'k1': 1, 'k2': 2, 'k3': 3}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 辞書の連結</span></div><div><span style="font-size: 10pt;">d1 = {'k1': 1, 'k2': 2}</span></div><div><span style="font-size: 10pt;">d2 = {'k1': 100, 'k3': 3, 'k4': 4}</span></div><div><span style="font-size: 10pt;">d1.update(d2)  # {'k1': 100, 'k2': 2, 'k3': 3, 'k4': 4}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 関数の引数可変にする(引数はタプル（変更できない変数）で来る)</span></div><div><span style="font-size: 10pt;">def xxx(*args):</span></div><div><span style="font-size: 10pt;">    print(args)</span></div><div><span style="font-size: 10pt;">xxx(1, 2, 3, 4)</span></div><div><span style="font-size: 10pt;"># (1, 2, 3, 4)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 関数の引数を可変の辞書型にする</span></div><div><span style="font-size: 10pt;">def xxx(**kwargs):</span></div><div><span style="font-size: 10pt;">    print(kwargs)</span></div><div><span style="font-size: 10pt;">xxx(key1=1, key2=2)</span></div><div><span style="font-size: 10pt;"># {'key1':1, 'key2':2}</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-weight: bold;">Graphvizインストール方法</span></div><div>1.<a href="http://ruby.kyoto-wu.ac.jp/info-com/Softwares/Graphviz/">http://ruby.kyoto-wu.ac.jp/info-com/Softwares/Graphviz/</a> からgraphviz-2.38.zipダウンロードして、解凍</div><div>2.解凍した \graphviz\release\bin を環境変数 Path に含める</div><div>3.コマンドプロンプトでインストールできているかをチェック</div><div>$ dot -V</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-weight: bold;"># Graphviz のdotファイルをpngに変換してjupyterで表示</span></div><div>import pydotplus</div><div>from IPython.display import Image, display_png</div><div>graph = pydotplus.graphviz.graph_from_dot_file('tree.dot')</div><div>graph.write_png('tree.png')</div><div>display_png(Image(graph.create_png())</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># イテレーターは__next__(), __iter__()関数を持つただのクラス。ジェネレータとは違い要素の終わりまで来たらnextしても次要素返さない</span></div><div><span style="font-size: 10pt;">[i for i in IterClass(3)] # IterClassは1-3の値を順に返すイテレータとする</span></div><div><span style="font-size: 10pt;"># 1,2,3</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># イテレータの例. イテレータはdef __iter__():とdef __next__():メソッドを持ったクラス. 全要素nextで回したらエラー飛ぶのがジェネレータと大きく違う</span></font></div><div><span style="font-size: 10pt;">class BatchIterator(object):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    入力画像のファイルパスのリストから、</span></div><div><span style="font-size: 10pt;">    入力画像（前処理済み4次元テンソル）をバッチ単位で返すイテレータ</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    def __init__(self, img_file_list, batch_size=100, img_rows=512, img_cols=512):</span></div><div><span style="font-size: 10pt;">        self._img_file_list = img_file_list</span></div><div><span style="font-size: 10pt;">        self._batch_size = batch_size</span></div><div><span style="font-size: 10pt;">        self._img_rows = img_rows</span></div><div><span style="font-size: 10pt;">        self._img_cols = img_cols</span></div><div><span style="font-size: 10pt;">        self._i = 0</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    def __iter__(self):</span></div><div><span style="font-size: 10pt;">        return self</span></div><div><span style="font-size: 10pt;">    </span></div><div><span style="font-size: 10pt;">    def __next__(self):</span></div><div><span style="font-size: 10pt;">        if self._i == len(self._img_file_list):</span></div><div><span style="font-size: 10pt;">            raise StopIteration()</span></div><div><span style="font-size: 10pt;">        x_list = []</span></div><div><span style="font-size: 10pt;">        for img_file_path in self._img_file_list[self._i:self._i+self._batch_size]:</span></div><div><span style="font-size: 10pt;">            x = get_train_valid_test.load_img(img_file_path, self._img_rows, self._img_cols) # 画像を読み込んで4次元テンソルへ変換</span></div><div><span style="font-size: 10pt;">            x_list.append(x[0])</span></div><div><span style="font-size: 10pt;">            self._i += 1</span></div><div><span style="font-size: 10pt;">        return np.array(x_list)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><b># 大量のファイル名をリストで持つとメモリ食う場合にはgenerator使う</b></font></div><div>def gen_file_name(path):</div><div>    &quot;&quot;&quot;ファイル名返すgenerator&quot;&quot;&quot;</div><div>    import glob</div><div>    import pathlib</div><div>    for p in glob.glob(path):</div><div>        yield pathlib.Path(p).stem</div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">#</span> <span style="font-size: 10pt; font-weight: bold;">ジェネレータはfor or while 内でyield x を持つただの関数。nest(generator)でyieldの次要素を無限に返す。メモリには次要素しかロードしない</span></div><div><span style="font-size: 10pt;">def gen():</span></div><div><span style="font-size: 10pt;">    a,b = 1,0</span></div><div><span style="font-size: 10pt;">    while True:</span></div><div><span style="font-size: 10pt;">        yield b</span></div><div><span style="font-size: 10pt;">        b = a+b</span></div><div><span style="font-size: 10pt;">g = gen()</span></div><div><span style="font-size: 10pt;">next(g)</span></div><div><span style="font-size: 10pt;"># 0</span></div><div><span style="font-size: 10pt;">next(g)</span></div><div><span style="font-size: 10pt;"># 1</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># @*** はデコレータ。要するに***関数を読んでる処理（javaのアノテーションとは違う！！！）。引数の型チェックとかで使うみたい</span></div><div><span style="font-size: 10pt;">@somedef # somedefという関数呼び出し</span></div><div><span style="font-size: 10pt;">def somedef():</span></div><div><span style="font-size: 10pt;">    pass</span></div><div><span style="font-size: 10pt;">上記は下記と同じことをしている</span></div><div><span style="font-size: 10pt;">somedef = somedef(somedef)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># for文でbreakしなかったときの処理入れたい場合はelseを使う</span></div><div><span style="font-size: 10pt;">for i in range(10):</span></div><div><span style="font-size: 10pt;">    break</span></div><div><span style="font-size: 10pt;">else:</span></div><div><span style="font-size: 10pt;">    print('not break')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">ガベージコレクション(必要ないメモリの解放)</span></font></div><div><span style="font-size: 10pt;">import gc  # import 必要</span></div><div><span style="font-size: 10pt;">del small_area_mst  # メモリから消す変数</span></div><div><span style="font-size: 10pt;">gc.collect()  # ガ―ベジコレクション実行</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 命名規則(PEP-8)</span></div><div><span style="font-size: 10pt;">クラス/例外: 頭文字と区切りのみ大文字。接頭辞にその型や特性がわかる名前にする。例: ModelTypes</span></div><div><span style="font-size: 10pt;">モジュール/パッケージ/関数: 原則小文字区切りは_入れてもいいが極力いれない。</span></div><div><span style="font-size: 10pt;">定数: 大文字_区切り</span></div><div><span style="font-size: 10pt;">変数: 小文字_区切り</span></div><div><span style="font-size: 10pt;">bool変数: 頭にis_をつける。例: is_show = True</span></div><div><span style="font-size: 10pt;">辞書変数: key_valueのような変数名にする。例: persons_addresses = {'Bill': '8558 Momty Road'}</span></div><div><span style="font-size: 10pt;">スライスの「:」の前後は空白入れる。例r:x[1 : 4]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pythonのクラス例</span></div><div><span style="font-size: 10pt;"># 継承元クラス名は省略する場合は『object』というクラスを継承する。以下の場合「class Orange:」 「class Orange():」 「class Orange(object):」すべて同じ</span></div><div><span style="font-size: 10pt;">class Orange:# クラス名は頭文字が大文字</span></div><div><span style="font-size: 10pt;">    class_var1= {}# クラス変数。クラスのグローバル変数。クラス内のどの関数内でもアクセスできる</span></div><div><span style="font-size: 10pt;">    def __init__(self, w, c):# __init__()はコンストラクタ。引数selfは必ず必要。selfはクラス内の変数（インスタンス変数）。selfにself以外の引数を詰める</span></div><div><span style="font-size: 10pt;">        self.weight = w</span></div><div><span style="font-size: 10pt;">        self.color = c</span></div><div><span style="font-size: 10pt;">        self.mold = 0</span></div><div><span style="font-size: 10pt;">        print('create')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def __repr__(self):# __&lt;関数名&gt;__の関数は特殊関数。__repr__はprint(orange)のときの処理記述する関数</span></div><div><span style="font-size: 10pt;">        return 'orange'</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def rot(self, days, temp):</span></div><div><span style="font-size: 10pt;">        self.class_var1.setdefault(days, temp)</span></div><div><span style="font-size: 10pt;">        self.mold = days*temp</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    def _unsefe(self, _tmp):# 名前の前に_ついてる関数はプライベート関数、変数。インスタンスで呼び出してはいけない関数、変数</span></div><div><span style="font-size: 10pt;">        pass # passは何もしない場合に使う</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">class BigOrange(Orange):# クラスの継承もできる</span></div><div><span style="font-size: 10pt;">        def rot(self):# メソッドのオーバライド（メソッド名同じで処理変わる）</span></div><div><span style="font-size: 10pt;">            return self.mold * 2</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">class Fruits:# コンポジション用クラス。引数にインスタンス入れてアクセス</span></div><div><span style="font-size: 10pt;">    def __init__(self, fruits):</span></div><div><span style="font-size: 10pt;">        self.fruits = fruits</span></div><div><span style="font-size: 10pt;">        print(&quot;create&quot;)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">## Pythonでは、クラス内で定義することの出来るメソッドが三種類用意されている。メソッド・クラスメソッド・スタティックメソッドの3種類. ##</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># メソッド</span></div><div><span style="font-size: 10pt;">class Foo(object):</span></div><div><span style="font-size: 10pt;">    # メソッド</span></div><div><span style="font-size: 10pt;">    def method(self, arg):</span></div><div><span style="font-size: 10pt;">    pass</span></div><div><span style="font-size: 10pt;">Foo().method(&quot;arg&quot;) #OK</span></div><div><span style="font-size: 10pt;">Foo.method(&quot;arg&quot;) #これはエラー</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># クラスメソッド</span></div><div><span style="font-size: 10pt;">クラスメソッドは第一引数としてクラスオブジェクトを受け取り、インスタンスが無くとも呼び出すことが出来る。</span></div><div><span style="font-size: 10pt;">class Foo(object):</span></div><div><span style="font-size: 10pt;">    # クラスメソッド</span></div><div><span style="font-size: 10pt;">    @classmethod</span></div><div><span style="font-size: 10pt;">    def cls_method(cls, arg):</span></div><div><span style="font-size: 10pt;">    pass</span></div><div><span style="font-size: 10pt;">Foo().cls_method(&quot;arg&quot;) #OK</span></div><div><span style="font-size: 10pt;">Foo.cls_method(&quot;arg&quot;) #OK</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># スタティックメソッド</span></div><div><span style="font-size: 10pt;">スタティックメソッドでは引数は特に追加されず、インスタンスが無くとも呼び出すことが出来る。基本使わない</span></div><div><span style="font-size: 10pt;">class Foo(object):</span></div><div><span style="font-size: 10pt; font-weight: bold;">    # スタティックメソッド selfの引数いらない</span></div><div><span style="font-size: 10pt; font-weight: bold;">    @staticmethod</span></div><div><span style="font-size: 10pt; font-weight: bold;">    def statmethod(arg):</span></div><div><span style="font-size: 10pt;">        pass</span></div><div><span style="font-size: 10pt;">Foo().statmethod(&quot;arg&quot;) #OK</span></div><div><span style="font-size: 10pt; font-weight: bold;">Foo.statmethod(&quot;arg&quot;)</span> <span style="font-size: 10pt;">#OK クラスをオブジェクトとして実体化しなくても、そのメソッドを使用可能</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">オブジェクト指向のカプセル化(フィールドを操作するためにgetterメソッドとsetterメソッドを用意する)するためのgetter／setterはプロパティ(=pythonで自分で定義したオブジェクトから値を取得したり更新したり削除したりしたい時の動作を定義することができる機能)をつかう</span></font></div><div><span style="font-size: 10pt;">※C#やRuby、SwiftなどJava以外のオブジェクト指向言語にはgetter／setterを実現するプロパティというしくみが備わってる。</span></div><div><span style="font-size: 10pt;">　呼び出す側からはあたかもフィールドを直接いじってるように見えるが、裏ではgetter／setterのようなメソッドを介してフィールドを変更している。</span></div><div><span style="font-size: 10pt;">class MyProperty(object):</span></div><div><span style="font-size: 10pt;">    def __init__(self, x):</span></div><div><span style="font-size: 10pt;">        self._x = x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"> </span><span style="font-size: 10pt;">   @property # propertyの時は　x.getterと同義</span></div><div><span style="font-size: 10pt;">    def x(self):</span></div><div><span style="font-size: 10pt;">        return self._x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    @x.setter</span></div><div><span style="font-size: 10pt;">    def x(self, v):</span></div><div><span style="font-size: 10pt;">        self._x = abs(v) # 更新前に何らかの処理をはさめる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    @x.deleter</span></div><div><span style="font-size: 10pt;">    def x(self):</span></div><div><span style="font-size: 10pt;">        self._x = None</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">mypro = Myoperty(100)</span></div><div><span style="font-size: 10pt;">print(mypro.x) # 100</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">mypro.x = -200</span></div><div><span style="font-size: 10pt;">print(mypro.x) # 200</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">del mypro.x</span></div><div><span style="font-size: 10pt;">print(mypro.x) # None</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># ビルド済み（=バイナリ）ファイル</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 単体テスト実行関数を作るようにすること</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 辞書は追加されたきーの順番は保持しない</span></div><div><span style="font-size: 10pt;"> </span></div><div><span style="font-size: 10pt; font-weight: bold;"># from __future__important &lt;python3系パッケージ&gt; はpython2系で3系のパッケージ使うためのおまじない</span></div><div><span style="font-size: 10pt;"> </span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># モジュールの1行目に書いている -*- encoding: utf-8 -*- はpython2系でのencodingをutf8にするおまじない。python3系では不必要。モジュールの文字コードがutf8なら自動で</span><span style="font-size: 10pt; font-weight: bold;">encodingをutf8にしてくれる</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Windowsでpython切るのは「Ctrl+Z→Enter」</span></div><div><span style="font-size: 10pt; font-weight: bold;"># Linuxでpython切るのは「Ctrl+D」</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 時系列データでの機械学習モデルのデータサンプリング例</span></div><div><span style="font-size: 10pt; font-weight: bold;">idごとに12か月あるデータから特定の1ヵ月をランダムサンプリングしてtrain setを作る</span></div><div><span style="font-size: 10pt;">→id=1の2月のデータとid=1の3月のデータが同時にtrain setに入らない</span></div><div><span style="font-size: 10pt;">　= リークの危険際避けれる</span></div><div><span style="font-size: 10pt;">　（ただし、別の月の目的変数と相関がある説明変数が存在している場合はカンニングしてしまうから、リークになる）</span></div><div><span style="font-size: 10pt;">→ランダムに月選ぶから、特定の月だけのtrain setになること防ぐ（8月のデータだけでtrain set作ると8月についてのモデルになる）</span></div><div><span style="font-size: 10pt;">　= どの季節でも予測できるモデルになる</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><b># サクラエディタで全角文字検索する正規表現</b></font></div><div>[^\x00\x00-\x7F\x00｡-ﾟ]</div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold;"># H3-058用に作ったしきい値のcsvとデータのcsvロードして、しきい値以下のデータを数えるスクリプト</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/datacount_plotlybar.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/39c32f43ac15e0ada918be9e2e2da285.png" alt="datacount_plotlybar.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold;">githubに入れたいコード</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># pandas_profileでサマリー出す</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/summary_html_pandas_profiling.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/3d5184fa38a183b2635996479ed17c61.png" alt="summary_html_pandas_profiling.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># cx_Oracleの使い方参考</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/matrix.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/b04b960900ecad2be8434cf2e65aa588.png" alt="matrix.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># マルチラベル学習</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/multilabel_test_tfgpu113.ipynb"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/43b1ab18cff4ce0c79893dbec862f9d3.png" alt="multilabel_test_tfgpu113.ipynb"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># マルチラベルでパラメチューニング（チューニングを分散実行できるようにした）</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/multilabel_optuna.200306.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/fd7f7a571c308d69c007900cfba351f4.png" alt="multilabel_optuna.200306.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;">#</span> <span style="font-size: 10pt; font-weight: bold;">ImageDataGenerator継承した</span><span style="font-size: 10pt; font-weight: bold;">クラス作らないmy_generator</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/tf_my_generator.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/7a4d09eaf24880c82ec000716f42796d.png" alt="tf_my_generator.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># papermillでnotebook実行sh</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/papermil.MOE.sh"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/176011ca8cbb62e1957c1f6ed829fcd2.png" alt="papermil.MOE.sh"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># Focal Loss test</span></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/FocalLoss_check.ipynb"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/073905e853be6e8cf3994c0ccb47169f.png" alt="FocalLoss_check.ipynb"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/><div><span style="font-size: 10pt; font-weight: bold;">githubに追加したコード</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 20200217</span></div><div><span style="font-size: 10pt;">import os, sys, glob, pathlib</span></div><div><span style="font-size: 10pt;">import numpy as np</span></div><div><span style="font-size: 10pt;">import pandas as pd</span></div><div><span style="font-size: 10pt;">from sklearn.metrics import confusion_matrix, roc_auc_score, average_precision_score, accuracy_score, f1_score, precision_score, recall_score</span></div><div><span style="font-size: 10pt;">def get_metrics_from_score_dir(score_dir:str, mask_value=-1.0):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    予測結果ディレクトリのtsvファイルからラベルの数と分類の評価指標(accやroc_aucなど)を計算する</span></div><div><span style="font-size: 10pt;">    計算結果のcsvファイル(metrics.csv)を予測結果ディレクトリに出力する</span></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        score_dir:予測結果ディレクトリ</span></div><div><span style="font-size: 10pt;">        mask_value:欠損ラベル</span></div><div><span style="font-size: 10pt;">    Return:</span></div><div><span style="font-size: 10pt;">        df_count_concat:分類の評価指標(accやroc_aucなど)まとめたフレーム</span></div><div><span style="font-size: 10pt;">    Usage:</span></div><div><span style="font-size: 10pt;">        hERG_random_score_dir = '/gpfsx01/home/aaa00162/jupyterhub/notebook/H3-057/Submit/make_hERG_PAMPA_model/make_model/experiment/output/hERG_random_multilabel/predict/test/score'</span></div><div><span style="font-size: 10pt;">        get_metrics_from_score_dir(hERG_random_score_dir)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    score_tsvs = sorted(glob.glob(score_dir+'/*.tsv'))</span></div><div><span style="font-size: 10pt;">    round_num = 3</span></div><div><span style="font-size: 10pt;">    df_count_concat = None</span></div><div><span style="font-size: 10pt;">    for p in score_tsvs:</span></div><div><span style="font-size: 10pt;">        df = pd.read_csv(p, sep='\t')</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        df_count = pd.DataFrame(df['y_true'].value_counts())</span></div><div><span style="font-size: 10pt;">        df_count = df_count.T.reset_index(drop=True)</span></div><div><span style="font-size: 10pt;">        cols = sorted(df_count.columns.to_list())</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        df = df[df['y_true'] != mask_value]# 欠損ラベル=-1.0 以外の行だけにする</span></div><div><span style="font-size: 10pt;">        if df['y_true'].shape[0] == 0:</span></div><div><span style="font-size: 10pt;">            # 欠損ラベルのレコードは削除して正解ラベル0件用対策</span></div><div><span style="font-size: 10pt;">            print('all nan')</span></div><div><span style="font-size: 10pt;">            continue</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        df_count['tsv'] = pathlib.Path(p).name</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        roc_auc = roc_auc_score(df['y_true'], df['y_pred'])</span></div><div><span style="font-size: 10pt;">        df_count['roc_auc'] = round(roc_auc, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        average_precision = average_precision_score(df['y_true'], df['y_pred'])</span></div><div><span style="font-size: 10pt;">        df_count['pr_auc'] = round(average_precision, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        acc = accuracy_score(df['y_true'], df['y_pred'].round())</span></div><div><span style="font-size: 10pt;">        df_count['accuracy'] = round(acc, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        precision = precision_score(df['y_true'], df['y_pred'].round())</span></div><div><span style="font-size: 10pt;">        df_count['precision'] = round(precision, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        recall = recall_score(df['y_true'], df['y_pred'].round())</span></div><div><span style="font-size: 10pt;">        df_count['recall'] = round(recall, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        tn, fp, fn, tp = confusion_matrix(df['y_true'], df['y_pred'].round()).ravel()</span></div><div><span style="font-size: 10pt;">        df_count['specificity'] = round(tn / (tn+fp), round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        f1 = f1_score(df['y_true'], df['y_pred'].round())</span></div><div><span style="font-size: 10pt;">        df_count['f1'] = round(f1, round_num)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">        if df_count_concat is None:</span></div><div><span style="font-size: 10pt;">            df_count_concat = df_count</span></div><div><span style="font-size: 10pt;">        else:</span></div><div><span style="font-size: 10pt;">            df_count_concat = pd.concat([df_count_concat, df_count], ignore_index=True)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    df_count_concat = df_count_concat[['tsv', 'accuracy', 'precision', 'recall', 'specificity', 'f1', 'roc_auc', 'pr_auc', 0.0, 1.0, mask_value]]</span></div><div><span style="font-size: 10pt;">    #display(df_count_concat)</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    out_csv = os.path.join(score_dir, 'metrics.csv')</span></div><div><span style="font-size: 10pt;">    df_count_concat.to_csv(out_csv, index=False)</span></div><div><span style="font-size: 10pt;">    print(&quot;INFO: save file. [{}] {}&quot;.format(out_csv, df_count_concat.shape))</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;">    return df_count_concat</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">PDFファイルを、pdfminerを使ってtextファイルに変換する</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/pdf2txt.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/f25b69ea19c0a34aefb3ca9e69fba111.png" alt="pdf2txt.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># 複数のoptunaの結果のstudy.csvを連結する</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/concat_results_study_csv.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/89f86c8a6451840e0fc61a0e682393b1.png" alt="concat_results_study_csv.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># githubのutil.pyのplot_5imgs更新。全件plotしたらbreakするように変更している</span></div><div><span style="font-size: 10pt;">def plot_5imgs(img_list, plot_num=10, figsize=(10, 8), labels=None, is_gray=False):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    5枚ずつ並べて画像表示。np.ndarrayの画像データでも表示可能</span></div><div><span style="font-size: 10pt;">    Usage:</span></div><div><span style="font-size: 10pt;">        img_list = glob.glob(data_dir+'/*/*.png')</span></div><div><span style="font-size: 10pt;">        plot_5imgs(img_list)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    if isinstance(img_list, np.ndarray):</span></div><div><span style="font-size: 10pt;">        print(&quot;Num_Images: &quot;, img_list.shape[0])</span></div><div><span style="font-size: 10pt;">    else:</span></div><div><span style="font-size: 10pt;">        print(&quot;Num_Images: &quot;, len(img_list))</span></div><div><span style="font-size: 10pt;">    plt.figure(figsize=figsize)</span></div><div><span style="font-size: 10pt;">    # 並べる画像の行数</span></div><div><span style="font-size: 10pt;">    rows = plot_num//5</span></div><div><span style="font-size: 10pt;">    if rows &lt; plot_num/5.0:</span></div><div><span style="font-size: 10pt;">        rows += 1</span></div><div><span style="font-size: 10pt;">    #print(f&quot;rows: {rows}&quot;)</span></div><div><span style="font-size: 10pt;">    for i in range(plot_num):</span></div><div><span style="font-size: 10pt;">        if isinstance(img_list, np.ndarray):</span></div><div><span style="font-size: 10pt;">            img = img_list[i]</span></div><div><span style="font-size: 10pt;">        else:</span></div><div><span style="font-size: 10pt;">            img = plt.imread(img_list[i])</span></div><div><span style="font-size: 10pt;">            # 画像2次元ならグレースケール</span></div><div><span style="font-size: 10pt;">            if len(img.shape) == 2:</span></div><div><span style="font-size: 10pt;">                is_gray = True</span></div><div><span style="font-size: 10pt;">            if is_gray == True:</span></div><div><span style="font-size: 10pt;">                img = plt.imread(img_list[i], 0) # 第二引数0でグレースケール画像として読み込む.</span></div><div><span style="font-size: 10pt;">        plt.subplot(rows, 5, i+1)</span></div><div><span style="font-size: 10pt;">        if is_gray == True:</span></div><div><span style="font-size: 10pt;">            plt.imshow(img, cmap=&quot;gray&quot;) # グレースケールで表示.</span></div><div><span style="font-size: 10pt;">        else:</span></div><div><span style="font-size: 10pt;">            plt.imshow(img)</span></div><div><span style="font-size: 10pt;">        if labels is not None:</span></div><div><span style="font-size: 10pt;">            plt.title(str(labels[i])+'\n'+str(img.shape))</span></div><div><span style="font-size: 10pt;">        else:</span></div><div><span style="font-size: 10pt;">            plt.title(img.shape)</span></div><div><span style="font-size: 10pt;">        plt.xticks([])</span></div><div><span style="font-size: 10pt;">        plt.yticks([])</span></div><div><span style="font-size: 10pt;">        # 全件plotしたらbreak</span></div><div><span style="font-size: 10pt;">        if len(img_list) == i+1:</span></div><div><span style="font-size: 10pt;">            break</span></div><div><span style="font-size: 10pt;">    plt.tight_layout()</span></div><div><span style="font-size: 10pt;">    plt.show()</span></div><div><span style="font-size: 10pt;">    plt.clf()</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># githubの</span><span style="font-size: 10pt; font-weight: bold;">define_model.py</span><span style="font-size: 10pt; font-weight: bold;">の</span><span style="font-size: 10pt; font-weight: bold;">FC_batch_drop</span><span style="font-size: 10pt; font-weight: bold;">更新。</span><span style="font-size: 10pt; font-weight: bold;">BatchNormalizationはDenseと活性化の間にいれる</span></font></div><div><span style="font-size: 10pt;">def FC_batch_drop(x, activation='relu', dence=1024, dropout_rate=0.5, addBatchNorm=None, kernel_initializer='he_normal', l2_rate=1e-4, name=None):</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    中間層の全結合1層（BatchNormalizationとDropout追加可能）</span></div><div><span style="font-size: 10pt;">    Args:</span></div><div><span style="font-size: 10pt;">        x: model.output</span></div><div><span style="font-size: 10pt;">        activation: 活性化関数。デフォルトは'relu'</span></div><div><span style="font-size: 10pt;">        dence, dropout_rate: 各層のニューロンの数。デフォルトは1024としてる</span></div><div><span style="font-size: 10pt;">        dropout_rate: dropout_rate(0&lt;dropout_rate&lt;1 の範囲出ないとエラーになる)。デフォルトは0.5としてる</span></div><div><span style="font-size: 10pt;">        addBatchNorm: BatchNormalization いれるか。デフォルトは入れない</span></div><div><span style="font-size: 10pt;">        kernel_initializer:Denseレイヤーの重みの初期化 デフォルトをHe の正規分布('he_normal')としてる。</span></div><div><span style="font-size: 10pt;">                           Denseのデフォルトglorot_uniform（Glorot（Xavier）の一様分布）にしたい場合は 'glorot_uniform' とすること</span></div><div><span style="font-size: 10pt;">        l2_rate:l2正則化によるWeight decay入れるか。デフォルトは無し(1e-4)。kerasのマニュアルでは0.01とか使ってる。Deeptoxの4層では1e-04, 1e-05, 1e-06, 0にしてる</span></div><div><span style="font-size: 10pt;">        name: 層の名前</span></div><div><span style="font-size: 10pt;">    Returns:</span></div><div><span style="font-size: 10pt;">        全結合1層(x)</span></div><div><span style="font-size: 10pt;">    &quot;&quot;&quot;</span></div><div><span style="font-size: 10pt;">    x = Dense(dence, kernel_initializer=kernel_initializer, kernel_regularizer=regularizers.l2(l2_rate), name=name+'_dence')(x)</span></div><div><span style="font-size: 10pt;">    if addBatchNorm != None:</span></div><div><span style="font-size: 10pt;">        x = BatchNormalization(name=name+'_batchNormalization')(x)</span></div><div><span style="font-size: 10pt;">    x = Activation(activation)(x) # BatchNormalizationはDenseと活性化の間</span></div><div><span style="font-size: 10pt;">    if dropout_rate &gt; 0:</span></div><div><span style="font-size: 10pt;">        x = Dropout(dropout_rate, name=name+'_dropout')(x)</span></div><div><span style="font-size: 10pt;">    print('dence dropout addBatchNorm kernel_initializer l2_rate =', dence, dropout_rate, addBatchNorm, kernel_initializer, l2_rate)</span></div><div><span style="font-size: 10pt;">    return x</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt; font-weight: bold;"># H3-045のコード使ってコマンドラインから画像1枚gradcam実行するコマンドラインスクリプト</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/image2gradcam_H3-045.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/7a86f12b2372dee05ffe1d7a6b103f83.png" alt="image2gradcam_H3-045.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">Oracleの1テーブルについて、各カラムの最大値や最小値などの統計情報をタブ区切りでファイル出力するコマンドラインPythonスクリプト</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/summary_tmp10014.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/66717e42e5299c53c2401d6f5716ed00.png" alt="summary_tmp10014.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; font-weight: bold;"># </span><span style="font-size: 10pt; font-weight: bold;">Oracleのsqlを書いたファイルからsqlを実行するコマンドラインPythonスクリプト</span></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="font-size: 10pt;"><a href="Pandas+Numpy+matplotlib+etc... Tips_files/executer_tmp10014.py"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/02f5351a3c58080990f1c9c88822a6af.png" alt="executer_tmp10014.py"></a></span></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><div><font style="font-size: 10pt;"><br/></font></div><hr/></div><div style="min-width: 100%; position: relative;"><div style="box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: 100%;"><div style="box-sizing: inherit; background-color: rgb(255, 255, 255); overflow-wrap: break-word;"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing: inherit; background-color: rgb(246, 246, 246);"><div style="box-sizing:inherit;"><div style="box-sizing:inherit;"><div style="box-sizing: inherit; background-color: rgb(255, 255, 255);"><div style="box-sizing: inherit; margin-bottom: 40px;"><div style="box-sizing: inherit; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 24px;"><div style="box-sizing: inherit; flex-wrap: wrap; align-items: center; justify-content: flex-start; width: 100%;"><div style="box-sizing: inherit; align-items: center; margin-right: 16px;"><a href="https://qiita.com/tanemaki" style="box-sizing: inherit; background-color: transparent; font-size: 10pt; color: rgb(51, 122, 183); line-height: 1.42857; text-decoration: none;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/assets.github.comimagesgravatarsgravatar-user-420.png" type="image/png" data-filename="assets.github.comimagesgravatarsgravatar-user-420.png" title="Attachment"/></a> <a href="https://qiita.com/tanemaki" style="background-color: transparent; font-size: 10pt; line-height: 1.42857; text-decoration: none;">@tanemaki</a></div><div style="box-sizing: inherit; margin-right: 16px;"><span style="box-sizing: inherit;"><font style="font-size: 10pt;"><span style="box-sizing: inherit; font-size: 10pt; color: rgb(153, 153, 153); line-height: 1.42857;">2018年06月18日</span><span style="font-size: 10pt; color: rgb(153, 153, 153); line-height: 1.42857;">に更新</span></font></span></div><div style="box-sizing: inherit; align-items: center; justify-content: space-between; flex-grow: 1;"><div style="box-sizing: inherit; align-items: center; margin-left: auto;"><div style="box-sizing:inherit;position:relative;cursor:pointer;"><a href="https://qiita.com/tanemaki/items/2ed05e258ef4c9e6caac#" style="background-color: transparent; font-size: 10pt; color: rgb(153, 153, 153); font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: 0.75em; text-decoration: none;"></a></div></div></div></div></div><h1 style="box-sizing: inherit; margin: 0px 0px 16px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.4;">ゆるふわPandasチートシート</span></h1></div><div style="box-sizing: inherit; overflow-wrap: break-word; word-break: break-all;"><div style="box-sizing:inherit;margin-top:0px;"><div style="box-sizing: inherit; margin: 0px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">よく忘れるので、自分用にざっくりとまとめてみました。</span></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">基本モジュールの読み込み</span></h2></div></div><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">import</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">pandas</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(235, 210, 71); line-height: 1.8;">as</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">pd</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">import</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">numpy</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(235, 210, 71); line-height: 1.8;">as</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">np</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">import</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">matplotlib.pyplot</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(235, 210, 71); line-height: 1.8;">as</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">plt</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">%</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">matplotlib</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">inline</span></div></div></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">Pandasの表示に関わる基本設定</span></h2></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 391px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.options.display.max_columns = None</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">常に全ての列（カラム）を表示</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt;"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); font-weight: bold; line-height: 1.42857;">pd.set_option('display.max_columns', None)</span></span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: bold; line-height: 1.42857;">常に全ての列（カラム）を表示</span></span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.options.display.max_rows = 10</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">常に10行だけ表示</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.options.display.precision = 2</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">表示用の有効桁数を2にする</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 391px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.options.display.notebook_repr_html = True</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">データフレームをHTMLで綺麗に表示</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">Pandasのデータオブジェクト</span></h2></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.Series</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス付きの1次元データ（シリーズ）</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.DataFrame</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス付きの2次元データ（データフレーム）</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.Panel</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス付きの3次元データ（パネル）</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">データI/O</span></h2></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.read_csv('foo.csv', header=0)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">CSVファイルからの読み込み</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.to_csv('bar.csv', index=False)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">CSVファイルへの書き出し</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.read_excel('foo.xlsx', sheetname='Sheet1')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">エクセルファイルからの読み込み</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.to_excel('bar.xlsx', sheet_name='Sheet1')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">エクセルファイルへの書き出し</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.read_hdf('foo.h5','df')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">HDF5ファイルからの読み込み</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.to_hdf('bar.h5','df')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">HDF5ファイルへの書き出し</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">データを眺める</span></h2></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">チラ見</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.head()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">最初の5行を表示</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.tail()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">最後の5行を表示</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">インデックス、カラム、値</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.index</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックスを取得</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.columns</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">カラム名を取得</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.values</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">値をnumpy.ndarrayで取得</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">基本情報</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 129px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.info()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">「有効データ数」「データ型」「メモリ使用量」などの総合的な情報を表示</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.shape</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">縦横の形を調べる</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.count()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">各カラムの有効データ数を表示</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.dtypes</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">各カラムのデータ型を表示</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 129px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">len(df) - df.count()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">すべてのカラムに対して、欠損値の数を計算</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">各種統計量</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.describe()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">数値データに対して各種統計量を計算</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.describe(include='all')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">全てのデータに対して各種統計量を計算</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">データの選択</span></h2></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">カラムの選択</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df['Age']</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Ageをシリーズとして取得（キーワードアクセス）</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.Age</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Ageをシリーズとして取得（ドットアクセス）</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">インデックスとカラムの同時選択</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df[['Age', 'Name']][1:3]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">位置番号</span> <span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-radius: 3px; font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">[1, 2]</span><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">のAgeとNameカラムを取得</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.iloc[1:3, [0, 4]]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">位置番号</span> <span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-radius: 3px; font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">[1, 2]</span> <span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">or 真偽値リスト</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.loc[1:3, ['Age', 'Height']]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス名</span> <span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-radius: 3px; font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">[1, 2, 3]</span> <span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">or 真偽値リスト</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.ix[1:3, ['Age', 'Height']]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス名 or 位置番号 or 真偽値リスト</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.iat[0, 1]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">位置番号による高速な要素アクセス</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.at[1, 'Age']</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックス名による高速な要素アクセス</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">真偽値インデックスによる選択</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df[df.Age &gt;= 70]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Ageが70以上の人を選択</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df[df &gt; 0]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">0より上の要素はそのまま返し、それ以外はNaN</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.where(df &gt; 0)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">0より上の要素はそのまま返し、それ以外はNaN</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.mask(df &gt; 0)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">0より上の要素をNaNでマスクし、それ以外はそのまま返す</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.ix[:, df.columns.map(lambda x: x.startswith('A'))]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Aという文字から始まる列を取得</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df[df['Grade'].isin(['A', 'B'])]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Gradeの値がAかBの行だけを返す</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.ix[:, ~df.columns.isin(['Age', 'Height'])]</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">AgeとHeight以外の列を全て返す</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">データの操作</span></h2></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">基本操作</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.T</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">データフレームの転置</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.any()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">ひとつでも真であればTrue</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.all()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">すべて真であればTrue</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.astype('float64')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">データ型の変換</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.map({'Female':0, 'Male':1, })</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">辞書を用いた値の変換</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.value_counts()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">値の頻度を計算</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.get_dummies(df['Club'])</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">カテゴリ変数をone-hotベクトルに変換</span></td></tr></tbody></table><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit;"><span style="font-size: 10pt; color: rgb(157, 171, 174); line-height: 1.8;"># カテゴリ変数をone-hot codingで離散化</span></span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">colname</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'Category'</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df_dummies</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">pd</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">get_dummies</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">colname</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">],</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">prefix</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">colname</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">)</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">drop</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">([</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">colname</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">],</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">axis</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(169, 128, 245); line-height: 1.8;">1</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">inplace</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">True</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">)</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">join</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df_dummies</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">)</span></div></div></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">インデックス関連</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.index = df.pop('UserId')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">'UserId'というカラムをインデックスとして使用</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.reset_index(drop=True)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックスの振り直し</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">並び替え</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 131px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.sort_index(axis=1, ascending=True)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックスによる並び替え</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.sort_values(by='Age', ascending=False)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 131px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">値による並び替え</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">コピー</span></h3></div></div><div style="box-sizing: inherit; margin: 0px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">以下の２つのコードの結果はまったく同じ。</span></div><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit;"><span style="font-size: 10pt; color: rgb(157, 171, 174); line-height: 1.8;"># 変更したデータフレームを代入</span></span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df2</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">sort_values</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">by</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'Age'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">)</span></div></div></div></div><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit;"><span style="font-size: 10pt; color: rgb(157, 171, 174); line-height: 1.8;"># コピーしたデータフレーム自体を変更</span></span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df2</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">copy</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">()</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df2</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">sort_values</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">by</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'Age'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">inplace</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">True</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">)</span></div></div></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">カラムの追加</span></h3></div></div><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit;"><span style="font-size: 10pt; color: rgb(157, 171, 174); line-height: 1.8;"># 方法1</span></span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'AB'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'A'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">+</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'B'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="box-sizing: inherit;"><span style="font-size: 10pt; color: rgb(157, 171, 174); line-height: 1.8;"># 方法2</span></span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">loc</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[:,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'AB'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'A'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">+</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'B'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span></div></div></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">欠損値の処理</span></h3></div></div><ul style="box-sizing: inherit; padding: 0px 0px 0px 1.5em; margin: 1.5em 0px; list-style: disc;"><li style="box-sizing:inherit;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">pandasは通常np.nanで欠損値を表現。これらの欠損値は計算時には基本的に無視される。</span></div></li></ul><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.dropna()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">欠損値がひとつでも含まれていたら、行を落とす</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.dropna(how='all')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">すべての値が欠損していたら、行を落とす</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.fillna(0)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">欠損値を0で埋める</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.fillna(method='ffill')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">前の値で欠損値を埋める</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">削除</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.drop(&quot;Tmp&quot;, axis=1)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">カラムの削除</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.drop_duplicates()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">重複した行の削除</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">文字列メソッド</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.str.lower()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">小文字に変換</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.str.startswith('A')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">Aから始まるか検証</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.str.contains('^[Aa]')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">正規表現を満たすかどうか検証</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">s.str.strip()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">両端の空白文字を取り除く</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">カテゴリー関連</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df['dcodes'] = df['d'].astype('category').cat.codes</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">カテゴリーごとに新規IDを振る</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">データの結合</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.concat([df1, df2], axis=0)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">行方向に結合</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df1.append(df2, ignore_index=True)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">行方向に結合。インデックスは振り直し。</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df1.join(df2)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">列方向に結合</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.merge(df_left, df_right, how='inner', on='key')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">SQLスタイルのマージ</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">グルーピング</span></h3></div></div><div style="box-sizing: inherit; margin: 0px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">Group byという操作は1つ以上の以下のステップを含む</span></div><ul style="box-sizing: inherit; padding: 0px 0px 0px 1.5em; margin: 1.5em 0px; list-style: disc;"><li style="box-sizing:inherit;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">Split: ある指標に基づき、データをグループに分割</span></div></li><li style="box-sizing:inherit;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">Apply: グループごとにある関数を適用</span></div></li><li style="box-sizing:inherit;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">Combine: 結果をまとめてデータ構造体に入れる</span></div></li></ul><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.groupby(['A', 'B']).sum()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">グルーピングした結果を足し合わせる</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.groupby(['A', 'B']).apply(lambda x: (x - x.mean()) / x.std())</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">グルーピングした結果をホワイトニング</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.groupby(['A', 'B']).agg(['mean', 'std'])</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">グルーピングした結果の平均と標準偏差を求める</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.pivot_table(values='D', index=['A', 'B'], columns=['C'], aggfunc=np.mean)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">ピボットテーブルを作成</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">階層インデックス</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.stack()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">カラムからインデックスへ</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df.unstack()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">インデックスからカラムへ</span></td></tr></tbody></table><div style="box-sizing: inherit; margin: 1.5em -32px; padding: 1em 32px; background-color: rgb(54, 69, 73);"><div style="box-sizing: inherit; background-color: rgb(54, 69, 73); padding: 0.5em; overflow-x: auto;"><div style="box-sizing: inherit; padding: 0px; margin: 0px; word-break: break-all; overflow-wrap: break-word; background-color: transparent; border: none; border-radius: 0px;"><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">tuples</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">list</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">zip</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">*</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'bar'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'bar'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'baz'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'baz'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">],</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'one'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'two'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'one'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'two'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]]))</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">index</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">pd</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">MultiIndex</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">from_tuples</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">tuples</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">names</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'first'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'second'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">])</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">pd</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">DataFrame</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">np</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">random</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">randn</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">(</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(169, 128, 245); line-height: 1.8;">4</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(169, 128, 245); line-height: 1.8;">2</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">),</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">index</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">index</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">columns</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'A'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'B'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">])</span></div><div><font style="font-size: 10pt;"><br/></font></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df_stacked</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">stack</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">()</span></div><div><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">df_stacked</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">index</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">.</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">names</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(255, 128, 149); line-height: 1.8;">=</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">[</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'first'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'second'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">,</span> <span style="box-sizing: inherit; font-size: 10pt; color: rgb(65, 183, 215); line-height: 1.8;">'third'</span><span style="box-sizing: inherit; font-size: 10pt; color: rgb(227, 227, 227); line-height: 1.8;">]</span></div></div></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">時系列データ</span></h2></div></div><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">時系列データの基本処理</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.date_range('20170101', periods=7)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">2017年の元旦から7日間のタイムスタンプをインデックスとして取得</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">pd.to_datetime(s)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">sをdatetimeに変換</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.asfreq('5Min')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">一定周期でスポットサンプリング（周期から値を1つだけ選択）</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df[['A', 'B']]['2017-01-01':'2017-01-07']</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">2017年1月1日から2017年1月7日までのAとBに関するデータを取得</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.asfreq('1T').ffill(limit=3)</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">1分ごとにスポットサンプリングし、欠損値は3ステップまで埋める</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.resample('5Min').mean()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">一定周期でリサンプリング（周期間の値をすべて使って演算）</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">df['A'].resample('3T', how=['mean', 'std', 'count'])</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">3分毎にリサンプリングしたデータに対し、各種統計量を求める</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.at_time(datetime.time(18, 30))</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">18時30分のデータのみを取得。</span><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-radius: 3px; font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">import datetime</span><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">を仮定</span></font></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.pct_change()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">変化量検出</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts.rolling(50).mean()</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">移動平均</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h3 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">タイムゾーン</span></h3></div></div><table style="box-sizing: inherit; background-color: transparent; border-spacing: 0px; overflow: auto; border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 130px;"></col></colgroup><tbody style="box-sizing:inherit;"><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">コマンド</span></td><td style="box-sizing: inherit; text-align: left; background-color: rgb(255, 255, 255); border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-weight: 700; line-height: 1.42857;">説明</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts_utc = ts.tz_localize('UTC')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">時刻をUTC（協定世界時）に合わせる</span></td></tr><tr style="box-sizing:inherit;"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts_utc.tz_convert('US/Eastern')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">US/Eastern（アメリカ東部標準時間）にタイムゾーンを変更</span></td></tr><tr style="box-sizing: inherit; background-color: rgb(238, 238, 238);"><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="background-color: rgb(238, 238, 238); box-sizing: inherit; padding: 0.1em 0.4em; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238);"><span style="background-color: rgb(238, 238, 238); font-size: 10pt; color: rgb(74, 74, 74); line-height: 1.42857;">ts_utc.tz_convert('Japan')</span></span></span></span></span></span></td><td style="box-sizing: inherit; text-align: left; border: 1px solid rgb(204, 204, 204); width: 130px; padding: 8px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857;">日本標準時間にタイムゾーンを変更</span></td></tr></tbody></table><div style="box-sizing: inherit; position: relative; top: -1.5em;"><div><h2 style="box-sizing: inherit; margin: 2.2em 0px 24px; cursor: pointer; position: relative; border-bottom: 1px solid rgb(221, 221, 221); padding-bottom: 0.1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-feature-settings: 'palt' 1; font-weight: 700; line-height: 1.5;">参考資料</span></h2></div></div><ul style="box-sizing: inherit; padding: 0px 0px 0px 1.5em; margin: 1.5em 0px; list-style: disc;"><li style="box-sizing:inherit;"><div><a href="http://pandas.pydata.org/pandas-docs/stable/10min.html" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">10 Minutes to pandas</a></div></li><li style="box-sizing:inherit;"><div><a href="https://www.analyticsvidhya.com/blog/2015/07/11-steps-perform-data-analysis-pandas-python/" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">CheatSheet: Data Exploration using Pandas in Python</a></div></li><li style="box-sizing:inherit;"><div><a href="http://www.webpages.uidaho.edu/~stevel/504/Pandas%20DataFrame%20Notes.pdf" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">Pandas DataFrame Notes</a></div></li><li style="box-sizing:inherit;"><div><a href="https://github.com/PyDataOkinawa/meetup018" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">PyData.Okinawa Meetup #18 - Pandasでデータ前処理</a></div></li><li style="box-sizing:inherit;"><div><a href="http://sinhrks.hatenablog.com/archive/category/pandas" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">sinhrksさんのブログ(StatsFragments)のpandas記事</a></div></li><li style="box-sizing:inherit;"><div><a href="https://s3.amazonaws.com/assets.datacamp.com/blog_assets/PandasPythonForDataScience.pdf" rel="nofollow noopener" style="box-sizing: inherit; background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;" target="_blank">Python For Data Science Cheat Sheet</a> <span style="font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.9;">from DataCamp</span></div></li><li style="box-sizing:inherit;"><div><a href="https://github.com/pandas-dev/pandas/blob/master/doc/cheatsheet/Pandas_Cheat_Sheet.pdf" style="background-color: transparent; font-size: 10pt; color: rgb(74, 172, 0); line-height: 1.9; text-decoration: none;">Data Wrangling with Pandas Cheat Sheet</a></div></li></ul></div></div><div style="box-sizing:inherit;"><div style="box-sizing: inherit; flex-wrap: wrap; justify-content: space-between; margin-top: 64px; margin-bottom: 24px;"><div style="box-sizing: inherit; flex-wrap: wrap;"><div style="box-sizing: inherit; margin-right: 8px; margin-bottom: 16px; padding: 0px 16px; background-color: rgb(255, 141, 0); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; align-items: center; flex-shrink: 0; height: 32px;"><font style="font-size: 10pt;"><i style="box-sizing: inherit; text-rendering: auto; -webkit-font-smoothing: antialiased; width: 1.28571em; text-align: center; margin-right: 4px;"><a href="https://qiita.com/tanemaki/items/2ed05e258ef4c9e6caac/edit" style="background-color: transparent; font-size: 10pt; font-style: normal; font-stretch: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal; line-height: 1; text-decoration: none;"></a></i><a href="https://qiita.com/tanemaki/items/2ed05e258ef4c9e6caac/edit" style="background-color: transparent; font-size: 10pt; line-height: 1.42857; text-decoration: none;">編集リクエスト</a></font></div><div style="box-sizing: inherit; align-items: center; flex-shrink: 0; height: 32px; margin-right: 8px; margin-bottom: 16px;"><div style="box-sizing: inherit;"><a href="https://qiita.com/tanemaki/items/2ed05e258ef4c9e6caac/likers" style="background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(51, 51, 51); line-height: 1.42857; text-decoration: none;">409</a></div></div></div><div style="box-sizing: inherit; flex-wrap: wrap;"><div style="box-sizing: inherit; cursor: pointer; margin-top: 0px; margin-right: 0px; margin-left: 8px; width: 32px; height: 32px; border-top-left-radius: 50%; border-top-right-radius: 50%; border-bottom-right-radius: 50%; border-bottom-left-radius: 50%; align-items: center; justify-content: center; background-color: rgb(170, 170, 170);"><div style="box-sizing:inherit;width:32px;height:32px;"><span style="font-size: 10pt; color: rgb(255, 255, 255); line-height: 1.42857;"><img style="box-sizing:inherit;"></img></span></div></div><div style="box-sizing: inherit; cursor: pointer; margin-top: 0px; margin-right: 0px; margin-left: 8px; width: 32px; height: 32px; border-top-left-radius: 50%; border-top-right-radius: 50%; border-bottom-right-radius: 50%; border-bottom-left-radius: 50%; align-items: center; justify-content: center; background-color: rgb(170, 170, 170);"><div style="box-sizing:inherit;width:32px;height:32px;"><span style="font-size: 10pt; color: rgb(255, 255, 255); line-height: 1.42857;"><img style="box-sizing:inherit;"></img></span></div></div></div></div></div><div style="box-sizing: inherit; width: 100%; padding-top: 40px; border-top: 1px solid rgb(221, 221, 221);"><div style="box-sizing: inherit; width: 100%; margin-right: 16px; overflow-wrap: break-word;"><div><a href="https://qiita.com/tanemaki" style="background-color: transparent; font-size: 10pt;"><img src="Pandas+Numpy+matplotlib+etc... Tips_files/assets.github.comimagesgravatarsgravatar-user-420 [1].png" type="image/png" data-filename="assets.github.comimagesgravatarsgravatar-user-420.png" title="Attachment"/></a></div><div style="box-sizing:inherit;flex-grow:1;width:0px;min-width:0px;"><div style="box-sizing: inherit; flex-wrap: wrap; align-items: center; margin-bottom: 8px;"><a href="https://qiita.com/tanemaki" style="background-color: transparent; font-size: 10pt; font-weight: 700; line-height: 1.42857; text-decoration: none;">@tanemaki</a></div></div></div></div></div></div></div></div></div></div></div></div></div><div><br/></div></span>
</div></body></html> 