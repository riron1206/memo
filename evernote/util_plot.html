<html>
<head>
  <title>Evernote Export</title>
  <basefont face="メイリオ" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308919 (ja-JP, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: メイリオ;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="28395"/>

<div><span><div><span style="font-size: 14px;">ScatterPlot &lt;- function(x, y, outputpath, maintxt, subtxt, xlabtxt, ylabtxt, lim.max){</span></div><div><span style="font-size: 14px;">  #</span></div><div><span style="font-size: 14px;">  # 相関プロット図(.png)を出力する</span></div><div><span style="font-size: 14px;">  #</span></div><div><span style="font-size: 14px;">  output.file &lt;- paste0(outputpath, &quot;/ScatterPlot.png&quot;)</span></div><div><span style="font-size: 14px;">  png(output.file)</span></div><div><span style="font-size: 14px;">  plot(x, y, </span></div><div><span style="font-size: 14px;">       main = maintxt, </span></div><div><span style="font-size: 14px;">       sub = subtxt,</span></div><div><span style="font-size: 14px;">       xlab = xlabtxt,</span></div><div><span style="font-size: 14px;">       ylab = ylabtxt,</span></div><div><span style="font-size: 14px;">       xlim=c(0, lim.max), ylim=c(0, lim.max)</span></div><div><span style="font-size: 14px;">  )</span></div><div><span style="font-size: 14px;">  ## 相関係数 ##</span></div><div><span style="font-size: 14px;">  sigcor &lt;- cor(x, y, use=&quot;<a href="http://na.or.complete">na.or.complete</a>&quot;)</span></div><div><span style="font-size: 14px;">  sigcor &lt;- signif(sigcor, digits = 2)</span></div><div><span style="font-size: 14px;">  # 凡例（画像左上にr = &quot;相関係数&quot; と表示）</span></div><div><span style="font-size: 14px;">  legend(&quot;topleft&quot;, legend=paste0(&quot;r = &quot;,sigcor), cex=2)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  dev.off()</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">}</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># H3-035より箱ひげグラフ&lt;/gpfsx01/home/shiny/0.13-MRO/bioinfo/H3-035/tmp/4box/server.R&gt;</span></div><div><span style="font-size: 14px;">OutputBoxplot4Data &lt;- function(umi4.list, main, names, labels){</span></div><div><span style="font-size: 14px;">  # </span></div><div><span style="font-size: 14px;">  # 4つのデータをboxplotで並べる</span></div><div><span style="font-size: 14px;">  # 薬剤投与前後のデータplot</span></div><div><span style="font-size: 14px;">  # </span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  col.red &lt;- &quot;#FF00007F&quot;# 透過色（赤）　透過色は最後の2ケタ7Fにする</span></div><div><span style="font-size: 14px;">  col.blue &lt;- &quot;#0000FF7F&quot;# 透過色（青）</span></div><div><span style="font-size: 14px;">  color &lt;- c(col.red, col.red, col.blue, col.blue)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  boxplot(umi4.list, names=names, col=color, main=main, ylab=&quot;UMI&quot;)</span></div><div><span style="font-size: 14px;">  legend(&quot;topright&quot;, legend=labels, col=color, pch=15) # 凡例</span></div><div><span style="font-size: 14px;">}</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># 赤と青のヒストグラムを2つ重ねる(マイクロアレイH3-014の流用&lt;/gpfsx01/home/tmp10014/Array/Illumina/GSE65391_H3-014/work/tmp/hist_data/signal_detect_hist.R&gt;)</span></div><div><span style="font-size: 14px;">HistPlot &lt;- function(data1, data2, bre.len, xlim.max, xlim.min, ylim.max, logflg, subj, leg.output.path){</span></div><div><span style="font-size: 14px;">    </span></div><div><span style="font-size: 14px;">  col.red &lt;- &quot;#FF00007F&quot;# 透過色（赤）　透過色は最後の2ケタ7Fにする</span></div><div><span style="font-size: 14px;">  col.blue &lt;- &quot;#0000FF7F&quot;# 透過色（青）</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  if(length(bre.len) == 1){</span></div><div><span style="font-size: 14px;">    # bre.len でbrask幅分ける場合 bre.len=100なら100個のbinに分ける</span></div><div><span style="font-size: 14px;">    bre1 &lt;- seq( min(data1), max(data1), length = bre.len) </span></div><div><span style="font-size: 14px;">    bre2 &lt;- seq( min(data2), max(data2), length = bre.len)</span></div><div><span style="font-size: 14px;">  }else{</span></div><div><span style="font-size: 14px;">    # 刻み幅5で固定にする場合</span></div><div><span style="font-size: 14px;">    bre1 &lt;- seq(min(data1)-10, max(data1)+10, 5)</span></div><div><span style="font-size: 14px;">    bre2 &lt;- seq(min(data2)-10, max(data2)+10, 5)</span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  up.hist &lt;- hist(data1</span></div><div><span style="font-size: 14px;">                  #, main = subj#主題</span></div><div><span style="font-size: 14px;">                  , xlab = &quot;Signal&quot;</span></div><div><span style="font-size: 14px;">                  , breaks = bre1# binの幅指定</span></div><div><span style="font-size: 14px;">                  , col = col.blue</span></div><div><span style="font-size: 14px;">                  , ylim = c(0, ylim.max)</span></div><div><span style="font-size: 14px;">                  , xlim = c(xlim.min, xlim.max)</span></div><div><span style="font-size: 14px;">                  #, add = T#グラフ重ねる</span></div><div><span style="font-size: 14px;">  )</span></div><div><span style="font-size: 14px;">  #par(new=T) #グラフ重ねる</span></div><div><span style="font-size: 14px;">  low.hist &lt;- hist(data2</span></div><div><span style="font-size: 14px;">                   , breaks = bre2</span></div><div><span style="font-size: 14px;">                   , col = col.red</span></div><div><span style="font-size: 14px;">                   , ylim = c(0, ylim.max)</span></div><div><span style="font-size: 14px;">                   , xlim = c(xlim.min, xlim.max)</span></div><div><span style="font-size: 14px;">                   , add = T#グラフ重ねる</span></div><div><span style="font-size: 14px;">  )</span></div><div><span style="font-size: 14px;">  legend(&quot;topright&quot;# 凡例を右上にだす</span></div><div><span style="font-size: 14px;">         , legend = c(paste0(&quot;Detection_Pval &lt; &quot;)#,  crite)</span></div><div><span style="font-size: 14px;">                      , paste0(&quot;Detection_Pval &gt;= &quot;)#, crite)</span></div><div><span style="font-size: 14px;">                      #, &quot;all&quot;</span></div><div><span style="font-size: 14px;">         )</span></div><div><span style="font-size: 14px;">         , lty = c(-1</span></div><div><span style="font-size: 14px;">                   , -1</span></div><div><span style="font-size: 14px;">                   #, -1</span></div><div><span style="font-size: 14px;">         )</span></div><div><span style="font-size: 14px;">         , fill = c(col.red</span></div><div><span style="font-size: 14px;">                    , col.blue</span></div><div><span style="font-size: 14px;">                    #, &quot;gray&quot;</span></div><div><span style="font-size: 14px;">         )</span></div><div><span style="font-size: 14px;">         , cex = 0.75</span></div><div><span style="font-size: 14px;">  )</span></div><div><span style="font-size: 14px;">}</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># ヒストグラム&lt;<a href="http://bio-info.biz/tips/r_histogram.html">http://bio-info.biz/tips/r_histogram.html</a>&gt;</span></div><div><span style="font-size: 14px;">hist(A, breaks=seq(0,1,0.05), main=&quot;Histogram&quot;, xlab=&quot;range&quot;, ylim=c(0,30), col=&quot;#993435&quot;)</span></div><div><span style="font-size: 14px;">## ヒストグラムのビン100個になるようにする</span></div><div><span style="font-size: 14px;">hist(raw.normal.h01_1_1$V2, breaks=100)</span></div><div><span style="font-size: 14px;">## ヒストグラム重ねる</span></div><div><span style="font-size: 14px;">hist(raw.normal.h01_1_1$V2, breaks=100)</span></div><div><span style="font-size: 14px;">hist(sf100.normal.h01_1_1$V2, breaks=100, add=T, col=&quot;red&quot;)</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">#頻度グラフ作成&lt;<a href="http://www2.hak.hokkyodai.ac.jp/fukuda/lecture/SocialLinguistics/Rshagen/03averageR.html">http://www2.hak.hokkyodai.ac.jp/fukuda/lecture/SocialLinguistics/Rshagen/03averageR.html</a>&gt;</span></div><div><span style="font-size: 14px;">#頻度は棒グラフで表示します。xtabs( ~ 変数名 )で作成した頻度表をbarplot( )に渡して作る</span></div><div><span style="font-size: 14px;">xtabs( ~onom ) # 擬音語データを回数別に集計</span></div><div><span style="font-size: 14px;">#onom</span></div><div><span style="font-size: 14px;">#0    1    2    3    4    5 </span></div><div><span style="font-size: 14px;">#1252  942  213   50   13    2</span></div><div><span style="font-size: 14px;">barplot( xtabs( ~onom ),　 # 集計表を棒グラフに（onomはベクトルであること）</span></div><div><span style="font-size: 14px;">         xlab=&quot;data&quot;, ylab=&quot;頻度&quot;, main=&quot;頻度の棒グラフ&quot; )</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># プロットエリアの余白領域 &lt;<a href="https://stats.biopapyrus.jp/r/graph/plotarea.html">https://stats.biopapyrus.jp/r/graph/plotarea.html</a>&gt;</span></div><div><span style="font-size: 14px;">par(mar = c(3, 3, 3, 2))   #下、左、上、右の順</span></div><div><span style="font-size: 14px;">par(oma = c(3, 3, 3, 2))   #下、左、上、右の順</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># barplot</span></div><div><span style="font-size: 14px;">par(mar = c(15, 5, 3, 2))</span></div><div><span style="font-size: 14px;">barplot(NCBIGeneExp.RPKM.mx[,],  </span></div><div><span style="font-size: 14px;">        main=paste(&quot;NCBI.GENE_EXPRESSION_SOURCE&quot;,&quot;:&quot;, orga)</span></div><div><span style="font-size: 14px;">        , las = 3       # x軸の項目を縦にする</span></div><div><span style="font-size: 14px;">        , ylab=&quot;EXP_RPKM&quot;</span></div><div><span style="font-size: 14px;">        , cex.lab = 1.0</span></div><div><span style="font-size: 14px;">        , cex.names = 1.0</span></div><div><span style="font-size: 14px;">        , cex.main=2</span></div><div><span style="font-size: 14px;">        , col=plotColor()</span></div><div><span style="font-size: 14px;">        #, horiz=T</span></div><div><span style="font-size: 14px;">        #, xlab=&quot;SOURCE_NAME&quot;</span></div><div><span style="font-size: 14px;">)</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># barplot()関数を使った棒グラフによるデータの視覚化</span></div><div><span style="font-size: 14px;"># <a href="http://monge.tec.fukuoka-u.ac.jp/r_analysis/graphics_barplot01.html">http://monge.tec.fukuoka-u.ac.jp/r_analysis/graphics_barplot01.html</a></span></div><div><span style="font-size: 14px;"># barplot作図のこまかい設定　細かく設定をしなくてもデータ名さえ指定すれば描いてくれる．</span></div><div><span style="font-size: 14px;"># 作図領域をテキスト行数単位で設定</span></div><div><span style="font-size: 14px;"># par (oma = c (1, 1, 1, 1 )) #outer margin (下，左，上，右)</span></div><div><span style="font-size: 14px;"># par (fig = c (1, 1, 1, 1 )) #figur margin (下，左，上，右)</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;">barplot (xd,         # データ名xd</span></div><div><span style="font-size: 14px;">         </span></div><div><span style="font-size: 14px;">         # xlim=c(0,100),       # x軸の目盛の表示範囲を指定する</span></div><div><span style="font-size: 14px;">         # ylim=c(0,100),       # y軸の目盛の表示範囲を指定する</span></div><div><span style="font-size: 14px;">         </span></div><div><span style="font-size: 14px;">         col=grey.colors( nrow( xd)), #　棒の色を指定</span></div><div><span style="font-size: 14px;">         width = c ( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ),  # 棒の幅を指定</span></div><div><span style="font-size: 14px;">         space = c( 0.1, 0.1, 0.1, 0.3, 0.1, 0.1, 0.4,0.1, 0.1,0.3,0.1, 0.1 ), </span></div><div><span style="font-size: 14px;">         # 棒と棒の間隔を指定</span></div><div><span style="font-size: 14px;">         </span></div><div><span style="font-size: 14px;">         cex.names= 1,    # x軸のラベルの文字サイズ</span></div><div><span style="font-size: 14px;">         cex.axis=  1,    # y軸のラベルの文字サイズ</span></div><div><span style="font-size: 14px;">         las = 2,         # x軸・y軸のラベルの文字の向きを変更(4パターンの組み合わせ)</span></div><div><span style="font-size: 14px;">         # las = 0  las = 1  las = 2  las = 3 </span></div><div><span style="font-size: 14px;">         </span></div><div><span style="font-size: 14px;">         # 凡例</span></div><div><span style="font-size: 14px;">         legend = rownames(xd),   # 凡例をデータ行の項目名で指定</span></div><div><span style="font-size: 14px;">         args.legend = list(x = ncol(xd) + 6.5, y = 100), # 凡例の左上の位置を指定</span></div><div><span style="font-size: 14px;">         xlim = c(0, ncol(xd)+5),                         # 凡例を描くx軸方向の範囲を指定</span></div><div><span style="font-size: 14px;">         </span></div><div><span style="font-size: 14px;">         # 表題欄</span></div><div><span style="font-size: 14px;">         main = &quot;(1) 問題の解答内容%&quot; )    # 表題を描く</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># 作成したグラフに軸のラベルの追加コメントを入れる</span></div><div><span style="font-size: 14px;">mtext(&quot;(2) 構成比率 %&quot;, side=2, line=2.5 )  # y軸右側(side=2)の項目</span></div><div><span style="font-size: 14px;">mtext(&quot;(3) 問題の型&quot;, side=1, line=3 )      # x軸下側(side=1)の項目</span></div><div><span style="font-size: 14px;">mtext(&quot;(4) 何かあります&quot;, side=4, line=-1 ) # y軸左側(side=4)の項目</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># Single Cell案件H3-035の流用&lt;/gpfsx01/home/shiny/0.13-MRO/bioinfo/H3-035/16hist/server.R&gt;</span></div><div><span style="font-size: 14px;">OutputHist2Data &lt;- function(b_umi, a_umi, main=&quot;gene_UMI&quot;, labels){</span></div><div><span style="font-size: 14px;">  # </span></div><div><span style="font-size: 14px;">  # 2つのデータのヒストグラムを重ねてplotしてファイル出力</span></div><div><span style="font-size: 14px;">  # 薬剤投与前後のデータplot</span></div><div><span style="font-size: 14px;">  # </span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  col.red &lt;- &quot;#FF00007F&quot;# 透過色（赤）　透過色は最後の2ケタ7Fにする</span></div><div><span style="font-size: 14px;">  col.blue &lt;- &quot;#0000FF7F&quot;# 透過色（青）</span></div><div><span style="font-size: 14px;">  color &lt;- c(col.red, col.blue)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  # 細胞数が1個かつ値が0の時、b_umi, a_umi は integer(0) になっている</span></div><div><span style="font-size: 14px;">  # integer(0)だとmean()などがNanになるので0に変換する</span></div><div><span style="font-size: 14px;">  if( length(b_umi) == 0 ){</span></div><div><span style="font-size: 14px;">    b_umi &lt;- c(0)</span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">  if( length(a_umi) == 0 ){</span></div><div><span style="font-size: 14px;">    a_umi &lt;- c(0)</span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  # 平均値、中央値を有効数字3桁にする</span></div><div><span style="font-size: 14px;">  digits = 3</span></div><div><span style="font-size: 14px;">  median_b = round(median(b_umi), digits = digits)</span></div><div><span style="font-size: 14px;">  mean_b = round(mean(b_umi), digits = digits)</span></div><div><span style="font-size: 14px;">  median_a = round(median(a_umi), digits = digits)</span></div><div><span style="font-size: 14px;">  mean_a = round(mean(a_umi), digits = digits)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  # binの幅はinput$bins で決める</span></div><div><span style="font-size: 14px;">  bins &lt;- seq(0, max(b_umi), length.out = input$bins + 1)</span></div><div><span style="font-size: 14px;">  if(max(b_umi) &lt; max(a_umi)){</span></div><div><span style="font-size: 14px;">    bins &lt;- seq(0, max(a_umi), length.out = input$bins + 1) </span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">  if(sum(bins) == 0){# binが全て0だとエラーになるので</span></div><div><span style="font-size: 14px;">    bins &lt;- seq(0, 1.0, length.out = input$bins + 1)</span></div><div><span style="font-size: 14px;">  }</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  # histogram plot</span></div><div><span style="font-size: 14px;">  hist(b_umi, breaks=bins, col=color[1], main=main, xlab=&quot;UMI&quot;)</span></div><div><span style="font-size: 14px;">  hist(a_umi, breaks=bins, col=color[2], add=T)</span></div><div><span style="font-size: 14px;">  legend(&quot;topright&quot;, legend=labels, col=color, pch=15) # 凡例</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  # median, meanの縦線</span></div><div><span style="font-size: 14px;">  abline(v=median_b, lty=2, col=color[1], lwd=3)</span></div><div><span style="font-size: 14px;">  abline(v=mean_b, lty=3, col=color[1], lwd=3)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  abline(v=median_a, lty=2, col=color[2], lwd=3)</span></div><div><span style="font-size: 14px;">  abline(v=mean_a, lty=3, col=color[2], lwd=3)</span></div><div><span style="font-size: 14px;">  </span></div><div><span style="font-size: 14px;">  legend(&quot;right&quot;,legend=c(paste0(&quot;median = &quot;,median_b) # 凡例</span></div><div><span style="font-size: 14px;">                          , paste0(&quot;mean = &quot;,mean_b)</span></div><div><span style="font-size: 14px;">                          , paste0(&quot;median = &quot;,median_a)</span></div><div><span style="font-size: 14px;">                          , paste0(&quot;mean = &quot;,mean_a))</span></div><div><span style="font-size: 14px;">         , lty=c(2,3,2,3)</span></div><div><span style="font-size: 14px;">         , col=c(color[1], color[1], color[2], color[2])</span></div><div><span style="font-size: 14px;">         , lwd=3</span></div><div><span style="font-size: 14px;">  )  </span></div><div><span style="font-size: 14px;">}</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># グラフの解像度について</span></div><div><span style="font-size: 14px;"># <a href="http://www.proton.jp/main/apps/r/resolution.html">http://www.proton.jp/main/apps/r/resolution.html</a></span></div><div><span style="font-size: 14px;"># 480×480</span></div><div><span style="font-size: 14px;"># resはdpiに対応する解像度</span></div><div><span style="font-size: 14px;">png(&quot;hoge.png&quot;, height=480, width=480, res=72)</span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"># 960×960</span></div><div><span style="font-size: 14px;"># 解像度2倍</span></div><div><span style="font-size: 14px;">png(&quot;hoge.png&quot;,height=960, width=960, res=144)</span></div><div><span style="font-size: 14px;"><br/></span></div></span>
</div></body></html> 